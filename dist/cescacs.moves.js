import{csTypes as csty,csConvert as cscnv}from"./cescacs.types.js";import{PositionHelper}from"./cescacs.positionHelper.js";function isUndoStatus(o){return void 0!==o.n&&"number"==typeof o.n&&void 0!==o.turn&&csty.isTurn(o.turn)&&void 0!==o.move&&("…"==o.move||csMoves.isMoveInfo(o.move)||csMoves.isCastlingInfo(o.move)||csMoves.isPromotionInfo(o.move))&&(void 0===o.iHMClock||"1"==o.iHMClock)&&(void 0===o.castlingStatus||csty.isCastlingStatus(o.castlingStatus))&&(void 0===o.specialPawnCapture||"string"==typeof o.specialPawnCapture&&0<o.specialPawnCapture.indexOf("@"))&&(void 0===o.fixedNumbering||"?"==o.fixedNumbering)}function undoStatusEquals(o,e){return o.n==e.n&&o.turn==e.turn&&("…"==o.move&&"…"==e.move||"…"!=o.move&&"…"!=e.move&&csMoves.equals(o.move,e.move))&&o.iHMClock==e.iHMClock&&o.castlingStatus==e.castlingStatus&&o.specialCapture==e.specialCapture&&o.fixedNumbering==e.fixedNumbering&&o.end==e.end&&o.check==e.check}function undoStatusArrayEquals(o,i){return o.every((o,e)=>undoStatusEquals(o,i[e]))}var csMoves;!function(n){function e(o){return"string"==typeof o&&("K"===o||"D"===o||"R"===o)}function i(o){return void 0!==o.side&&e(o.side)&&void 0!==o.col&&csty.isCastlingColumn(o.col)&&void 0!==o.rPos&&csty.isPosition(o.rPos)&&("D"===o.side||void 0!==o.kRook&&"R"==cscnv.getPieceKeyName(o.kRook))&&("K"===o.side||void 0!==o.qRook&&"R"==cscnv.getPieceKeyName(o.qRook))&&("R"!=o.side||void 0!==o.r2Pos&&csty.isPosition(o.r2Pos))}function r(o){return void 0!==o.piece&&void 0!==o.prPos&&csty.isPosition(o.prPos)&&void 0!==o.promoted}function s(o){return void 0!==o.piece&&void 0!==o.pos&&csty.isPosition(o.pos)&&void 0!==o.moveTo&&csty.isPosition(o.moveTo)}function c(o){return void 0!==o.captured&&(void 0===o.special||csty.isPosition(o.special))}n.promoteUndoStatus=function(o,e,i){return void 0!==e&&(o.end=e),void 0!==i&&(o.check=i),o},n.isCastlingSide=e,n.isCastlingInfo=i,n.isPromotionInfo=r,n.isMoveInfo=s,n.isCaptureInfo=c,n.fullMoveNotation=function(o,e=!0){var i,e=e&&"w"==o.turn?o.n+(void 0===o.fixedNumbering?". ":"? "):"";return"…"==o.move?e+"…":(i=o.check??("mate"==o.end?"#":""),e+n.moveNotation(o.move)+i)},n.endText=function(o,e){if(void 0===o.end)return"";switch(o.end){case"mate":case"resigned":return"b"==e?"3 - 0":"0 - 3";case"stalemate":return"b"==e?"2 - 1":"1 - 2";case"draw":return"1 - 1";default:var i=o.end;throw new Error(i)}},n.undoStatusId=function(o){return"…"==o.move?"":o.turn+o.n},n.moveNotation=function(e){if(n.isCastlingInfo(e))return s=void 0!==e.r2Pos?cscnv.columnFromIndex(e.r2Pos[0]):"K"==e.side&&"H"==e.col&&10==e.rPos[0]?5==e.rPos[1]||23==e.rPos[1]?"O":7==e.rPos[1]||21==e.rPos[1]?"OO":"":"","KR"+e.side+"-"+e.col+cscnv.columnFromIndex(e.rPos[0])+s;if(n.isMoveInfo(e)){var i,s=cscnv.getPieceKeyName(e.piece),s=("P"==s?"":s)+PositionHelper.toString(e.pos),t=r(e)?"="+cscnv.getPieceKeyName(e.promoted):"";let o;return c(e)?(o=void 0!==e.special?PositionHelper.equals(e.moveTo,e.special)||Math.abs(e.special[1]-e.moveTo[1])<=2?"@":"@@":"×","P"!=(i=cscnv.getPieceKeyName(e.captured))&&(o+=i)):o="-",s+o+PositionHelper.toString(e.moveTo)+t}if(n.isPromotionInfo(e))return PositionHelper.toString(e.prPos)+"="+cscnv.getPieceKeyName(e.promoted);throw new TypeError("must be a move notation")},n.equals=function(o,e){return s(o)&&s(e)?o.piece==e.piece&&PositionHelper.equals(o.pos,e.pos)&&PositionHelper.equals(o.moveTo,e.moveTo):r(o)&&r(e)?o.piece==e.piece&&o.promoted==e.promoted&&PositionHelper.equals(o.prPos,e.prPos):!(!i(o)||!i(e))&&o.side==e.side&&o.col==e.col&&PositionHelper.equals(o.rPos,e.rPos)&&o.kRook==e.kRook&&o.qRook==e.qRook}}(csMoves=csMoves||{});export{isUndoStatus,undoStatusEquals,undoStatusArrayEquals,csMoves};