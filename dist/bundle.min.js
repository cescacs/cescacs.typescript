!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).cescacs=e()}(function(){return function s(o,n,r){function a(i,e){if(!n[i]){if(!o[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(l)return l(i,!0);throw(e=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",e}t=n[i]={exports:{}},o[i][0].call(t.exports,function(e){return a(o[i][1][e]||e)},t,t.exports,s,o,n,r)}return n[i].exports}for(var l="function"==typeof require&&require,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.Board=t.EnPassantCapturable=t.ScornfulCapturable=t.PawnSpecialCaptureStatus=t.round2hundredths=t.csmv=t.cspty=t.cscnv=t.PositionHelper=void 0;const y=e("./ts.general"),q=(Object.defineProperty(t,"round2hundredths",{enumerable:!0,get:function(){return y.round2hundredths}}),e("./cescacs.types")),J=(Object.defineProperty(t,"cscnv",{enumerable:!0,get:function(){return q.csConvert}}),e("./cescacs.piece")),V=(Object.defineProperty(t,"cspty",{enumerable:!0,get:function(){return J.csPieceTypes}}),e("./cescacs.positionHelper")),b=(Object.defineProperty(t,"PositionHelper",{enumerable:!0,get:function(){return V.PositionHelper}}),e("./cescacs.piece")),o=e("./cescacs.moves");Object.defineProperty(t,"csmv",{enumerable:!0,get:function(){return o.csMoves}});class n{static parse(e,i){if(null!=i&&0<i.length&&"-"!=i){if(4<=i.length){i=i.split("@");if(2==i.length&&1<=i[0].length&&i[0].length<=3&&2<=i[1].length){if("P"==i[0]){var t=i[1].slice(0,i[1].length-1).split("[");if(i[1].endsWith("]")&&2==t.length){var s=V.PositionHelper.parse(t[1]),o=e.getPiece(s);if(null==o)throw new Error(V.PositionHelper.toString(s)+" doesn't have a pawn nor promoted pawn");s=t[0].split(",");if(1<=s.length&&s.length<=2){t=[];if(t.push(V.PositionHelper.parse(s[0])),2==s.length){s=Number(s[1]);if(isNaN(s)||!q.csTypes.isLine(s))throw new TypeError("Invalid en passant capture line value");t.push(V.PositionHelper.fromBoardPosition(t[0][0],s,!0))}return new u(o,t)}throw new TypeError("Missing or invalid en passant capture positions")}throw new TypeError("Invalid special 'en passant' pawn capture status string")}s=V.PositionHelper.parse(i[0]),o=V.PositionHelper.parse(i[1]),t=e.getPiece(o);if(null!=t)return new h(t,s);throw new Error(V.PositionHelper.toString(o)+" doesn't have a pawn nor promoted pawn")}throw new TypeError("Invalid special pawn capture status string")}throw new TypeError("Too short special pawn capture status string")}return null}isScornfulCapturable(){return"scornful"==this.specialCaptureType}isEnPassantCapturable(){return"enPassant"==this.specialCaptureType}get capturablePiece(){return this._capturablePiece}get capturablePawn(){return J.csPieceTypes.isPawn(this._capturablePiece)?this._capturablePiece:null}constructor(e){this._capturablePiece=e}}class h extends(t.PawnSpecialCaptureStatus=n){static promoteCapturablePawn(e,i){return new h(i,e._capturerPawnPos)}constructor(e,i){super(e),this.specialCaptureType="scornful",this._capturerPawnPos=i}isScorned(e,i){e=null!=e.position&&V.PositionHelper.equals(e.position,this._capturerPawnPos);return null==i?e:e&&V.PositionHelper.equals(i,this.capturablePiece.position)}get scornfulCaptureDirection(){var e=this._capturerPawnPos[0],i=this.capturablePiece.position,t=i[0];return i[1]>this._capturerPawnPos[1]?e<t?"FileUp":"FileInvUp":e<t?"FileDown":"FileInvDown"}toString(){return V.PositionHelper.toString(this._capturerPawnPos)+"@"+V.PositionHelper.toString(this.capturablePiece.position)}}t.ScornfulCapturable=h;class u extends n{static promoteCapturablePawn(e,i){return new u(i,e._captureTo)}constructor(e,i){super(e),this.specialCaptureType="enPassant",this._captureTo=i}isEnPassantCapture(i,e){var t=this._captureTo.some(e=>V.PositionHelper.equals(e,i));return null==e?t:!(!t||null==e.position)&&(t=e.position,J.csPieceTypes.isPawn(e)?1==Math.abs(i[0]-t[0])&&("w"==e.color?i[1]-t[1]==3:t[1]-i[1]==3):null!=V.PositionHelper.isDiagonally(i,t,J.csPieceTypes.isElephant(e)))}toString(){var e=this._captureTo;let i=V.PositionHelper.toString(e[0]);return 2==e.length&&(i+=","+e[1][1].toString()),"P@"+i+"["+V.PositionHelper.toString(this.capturablePiece.position)+"]"}}t.EnPassantCapturable=u;class p{static newHeuristic(){return{pieces:[0,0],space:[0,0],positioning:0,mobility:0,king:0}}static splitCastlingStatus(s){if(null!=s&&0<s.length){let e,i,t=0;for(;t<s.length&&s[t].toUpperCase()==s[t];)t++;if(i=(i=0==t?(e="-",s):t==s.length?(e=s,"-"):(e=s.slice(0,t),s.slice(t))).toUpperCase(),q.csTypes.isCastlingStatus(e)&&q.csTypes.isCastlingStatus(i))return[e,i];throw new TypeError("Invalid TLPD issued castling status "+s)}return["RKR","RKR"]}static lineMask(e){return 1<<e}constructor(e,i="w"){this.isGrand=e,this.wPositions=[0,0,0,0,0,0,0,0],this.bPositions=[0,0,0,0,0,0,0,0],this.wThreats=[0,0,0,0,0,0,0,0],this.bThreats=[0,0,0,0,0,0,0,0],this.pieces=new Map,this.wPieces=new Map,this.bPieces=new Map,this._regainablePieces=[],this.wKing=new b.King("w"),this.bKing=new b.King("b"),this._specialPawnCapture=null,this._currentHeuristic=p.newHeuristic(),this._wAwaitingPromotion=!1,this._bAwaitingPromotion=!1,this._turn=i??"w",this.pieces.set(this.wKing.key,this.wKing),this.pieces.set(this.bKing.key,this.bKing)}get turn(){return this._turn}get turnKing(){return"w"===this.turn?this.wKing:this.bKing}get checked(){return this.turnKing.checked}get isKnightOrCloseCheck(){return this.turnKing.isKnightOrCloseCheck()}get isSingleCheck(){return this.turnKing.isSingleCheck()}get isDoubleCheck(){return this.turnKing.isDoubleCheck()}pieceByKey(e){e=this.pieces.get(e);return(0,y.assertNonNullish)(e,"piece from unique key"),e}get specialPawnCapture(){return this._specialPawnCapture}set specialPawnCapture(e){this._specialPawnCapture=e}get isAwaitingPromotion(){return"w"==this._turn?this._wAwaitingPromotion:this._bAwaitingPromotion}setAwaitingPromotion(e){"w"==e?this._wAwaitingPromotion=!0:this._bAwaitingPromotion=!0}computeAwaitingPromotion(e){let i=!1;for(const t of("w"==e?this.wPieces:this.bPieces).values())if(J.csPieceTypes.isPawn(t)&&t.awaitingPromotion){i=!0;break}"w"==e?this._wAwaitingPromotion=i:this._bAwaitingPromotion=i}get currentHeuristic(){return this._currentHeuristic}getHeuristicValue(e){return(0,y.round2hundredths)(e.pieces[0]-e.pieces[1]+e.space[0]-e.space[1]+e.positioning+e.mobility+e.king)}createPiece(e,i,t,s){let o;switch(e){case"K":throw new Error("King must be created before setting it on the board");case"D":o=new b.Queen(i,t,s);break;case"V":o=new b.Wyvern(i,t,s);break;case"R":o=new b.Rook(i,this.isGrand,t,s);break;case"G":o=new b.Pegasus(i,t,s);break;case"N":o=new b.Knight(i,t,s);break;case"J":o=new b.Bishop(i,t,s);break;case"E":o=new b.Elephant(i,t,s);break;case"M":o=new b.Almogaver(i,t,s);break;case"P":o=new b.Pawn(i,t,s);break;default:throw new Error(e)}if(null!=this.hasPiece(o.position))throw new Error(`You cannot put a ${i} ${o.symbol} there`+", because the hex is already in use; There may be a repeated line in the TLPD");return this.pieces.set(o.key,o),this.addPiece(o),o}addPiece(e){(0,y.assertNonNullish)(e.position,e.symbol+" position");var i=e.position,t=(("w"==e.color?this.wPieces:this.bPieces).set(V.PositionHelper.positionKey(i),e),i[0]+1>>>1),i=p.lineMask(i[1]);("w"==e.color?this.wPositions:this.bPositions)[t]|=i}hasPiece(e){var i=e[0]+1>>>1,e=p.lineMask(e[1]);return 0!=(this.wPositions[i]&e)?"w":0!=(this.bPositions[i]&e)?"b":null}getPiece(e){var i=this.hasPiece(e);return null==i?null:("w"==i?this.wPieces:this.bPieces).get(V.PositionHelper.positionKey(e))}hasThreat(e,i){var t=e[0]+1>>>1;return 0!=(("w"==i?this.wThreats:this.bThreats)[t]&p.lineMask(e[1]))}isThreatened(e,i){var t=e[0]+1>>>1;return 0!=(("w"==i?this.bThreats:this.wThreats)[t]&p.lineMask(e[1]))}setThreat(e,i){var t=e[0]+1>>>1;("w"==i?this.wThreats:this.bThreats)[t]|=p.lineMask(e[1])}addRegainablePiece(e){null==e.position&&(this._regainablePieces.push(e),this.pieces.set(e.key,e))}hasRegainablePieces(t){const s=this._turn;return this._regainablePieces.reduce((e,i)=>e||i.color==s&&(!J.csPieceTypes.isBishop(i)||i.hexesColor==t),!1)}hasAwaitingRegainablePieces(){const t=this._turn;if(this._regainablePieces.reduce((e,i)=>e||i.color==t&&"J"!=i.symbol,!1))return!0;var e=this._regainablePieces.filter(e=>e.color==t&&"J"==e.symbol);if(0!=e.length)for(const i of("w"==this._turn?this.wPieces:this.bPieces).values())if(J.csPieceTypes.isPawn(i)){const s=i.awaitingPromotion;if(null!=s&&e.some(e=>e.hexesColor==s))return!0}return!1}currentRegainablePieceNames(t){const s=this._turn;return this._regainablePieces.reduce((e,i)=>i.color!=s||J.csPieceTypes.isBishop(i)&&i.hexesColor!=t?e:e.add(i.symbol),new Set)}maxRegainablePiecesValue(t){const s=this._turn;return this._regainablePieces.reduce((e,i)=>i.value>e&&i.color==s&&(!J.csPieceTypes.isBishop(i)||i.hexesColor==t)?i.value:e,0)}findRegeinablePiece(i,t,s){var e=this._regainablePieces.find(e=>e.color==i&&e.symbol==t&&(!J.csPieceTypes.isBishop(e)||e.hexesColor==s));return(0,y.assertNonNullish)(e,"retrieve the promoted piece"),e}*whitePieces(){for(const e of this.wPieces.values())yield e}*blackPieces(){for(const e of this.bPieces.values())yield e}*whitePiecePositions(){for(const e of this.wPieces.values())yield e.position}*blackPiecePositions(){for(const e of this.bPieces.values())yield e.position}*pieceMoves(e){var i,t=this.turnKing;!t.checked||"K"==e.symbol?yield*e.moves(this):(null!=(i=t.checkThreat)&&e.canCaptureOn(this,i)&&(yield i),t.isSingleCheck()&&(yield*e.blockThreat(this,t.getSingleCheckBlockingPositions(this))))}movePiece(e,i,t){(0,y.assertNonNullish)(e.position,e.symbol+" position");var s=e.position,o=s[0]+1>>>1,n=p.lineMask(s[1]),r="w"==e.color?this.wPieces:this.bPieces;if(J.csPieceTypes.isPawn(e))e.position[0]!=i?(c=this.getPiece([e.position[0],t>e.position[1]?e.position[1]+2:e.position[1]-2]),this._specialPawnCapture=null!=c&&J.csPieceTypes.isPawn(c)?new h(e,c.position):null):2<Math.abs(t-e.position[1])?(c=[],t>e.position[1]?(c.push([i,e.position[1]+2]),t>e.position[1]+4&&c.push([i,e.position[1]+4])):(c.push([i,e.position[1]-2]),t<e.position[1]-4&&c.push([i,e.position[1]-4])),this._specialPawnCapture=new u(e,c)):this._specialPawnCapture=null,V.PositionHelper.isPromotionPos(i,t,e.color)&&("w"==e.color?this._wAwaitingPromotion=!0:this._bAwaitingPromotion=!0);else if(J.csPieceTypes.isElephant(e))e.position[0]==i&&2<Math.abs(t-e.position[1])?(c=[[i,t>e.position[1]?e.position[1]+2:e.position[1]-2]],this._specialPawnCapture=new u(e,c)):this._specialPawnCapture=null;else if(J.csPieceTypes.isAlmogaver(e)){var a=V.PositionHelper.isOrthogonally(s,[i,t]);if(null!=a){var l=[];switch(a){case"ColumnUp":l.push([s[0],s[1]+2]);break;case"ColumnDown":l.push([s[0],s[1]-2]);break;case"FileUp":l.push([s[0]+1,s[1]+1]);break;case"FileDown":l.push([s[0]+1,s[1]-1]);break;case"FileInvUp":l.push([s[0]-1,s[1]+1]);break;case"FileInvDown":l.push([s[0]-1,s[1]-1]);break;default:throw new Error(a)}this._specialPawnCapture=new u(e,l)}else this._specialPawnCapture=null}else this._specialPawnCapture=null;r.delete(V.PositionHelper.positionKey(s)),e.moveTo(i,t),r.set(V.PositionHelper.positionKey(s),e);var c=s[0]+1>>>1,i=p.lineMask(s[1]),t="w"==e.color?this.wPositions:this.bPositions;t[o]&=~n,t[c]|=i}undoPieceMove(e,i,t){var s="w"==e.color?this.wPieces:this.bPieces,o=e.position,n=o[0]+1>>>1,r=p.lineMask(o[1]),i=(s.delete(V.PositionHelper.positionKey(o)),e.moveTo(i,t),s.set(V.PositionHelper.positionKey(o),e),o[0]+1>>>1),t=p.lineMask(o[1]),s="w"==e.color?this.wPositions:this.bPositions;s[n]&=~r,s[i]|=t}capturePiece(e){(0,y.assertNonNullish)(e.position,e.symbol+" position");var i=e.position,t=i[0]+1>>>1,s=p.lineMask(i[1]);("w"==e.color?this.wPositions:this.bPositions)[t]&=~s,("w"==e.color?this.wPieces:this.bPieces).delete(V.PositionHelper.positionKey(i)),e.captured(),e.isRegainable&&this._regainablePieces.push(e)}undoCapturePiece(e,i,t){var s;b.Piece.isRegainablePiece(e.symbol)&&(s=this._regainablePieces.indexOf(e),(0,y.assertCondition)(0<=s,"Captured piece found in the regainable pieces bag"),this._regainablePieces.splice(s,1)),e.setPositionTo([i,t]),this.addPiece(e)}promotePawn(e,i){var t;this._regainablePieces.includes(i)&&((t="w"==i.color?this.wPieces:this.bPieces).delete(V.PositionHelper.positionKey(e.position)),e.promoteTo(i),t.set(V.PositionHelper.positionKey(i.position),i),null!=this._specialPawnCapture&&this._specialPawnCapture.capturablePawn==e&&(this._specialPawnCapture.isScornfulCapturable()?this._specialPawnCapture=h.promoteCapturablePawn(this._specialPawnCapture,i):this._specialPawnCapture.isEnPassantCapturable()&&(this._specialPawnCapture=u.promoteCapturablePawn(this._specialPawnCapture,i))),t=this._regainablePieces.indexOf(i),this._regainablePieces.splice(t,1),"w"==i.color?this._wAwaitingPromotion=!1:this._bAwaitingPromotion=!1)}undoPromotePawn(e,i){var t="w"==i.color?this.wPieces:this.bPieces;t.delete(V.PositionHelper.positionKey(i.position)),e.setPositionTo([i.position[0],i.position[1]]),i.captured(),this._regainablePieces.push(i),t.set(V.PositionHelper.positionKey(e.position),e)}insuficientMaterial(){var e=e=>{for(const i of e)if(J.csPieceTypes.isPawn(i))return!0;return!1},i=e=>{for(const i of e)if(J.csPieceTypes.isMajorPiece(i))return!0;return!1},t=e=>{for(const i of e)if(J.csPieceTypes.isMinorPiece(i))return!0;return!1},s=e=>{let i=0;for(const t of e)J.csPieceTypes.isMediumPiece(t)&&i++;return i};if(this.wPieces.size<=3&&this.bPieces.size<=3&&!e(this.wPieces.values())&&!e(this.bPieces.values()))return!i(this.wPieces.values())&&!i(this.bPieces.values())&&2!=(e=s(this.wPieces.values()))&&!(1==e&&t(this.wPieces.values())||2==(i=s(this.bPieces.values()))||1==i&&t(this.bPieces.values()))}nextTurn(){this._turn="w"===this._turn?"b":"w"}prepareTurn(e){var i=e.color,t="w"==i?this.bThreats:this.wThreats;for(let e=0;e<=7;e++)t[e]=0;for(const s of("w"==i?this.bPieces:this.wPieces).values())s.markThreats(this);for(const o of("w"==i?this.wPieces:this.bPieces).values())o.pin=null;e.computeCheckAndPins(this)}prepareCurrentTurn(){this.prepareTurn(this.turnKing)}isMoveableTurn(){for(const e of("w"===this.turn?this.wPieces:this.bPieces).values())if(!this.pieceMoves(e).next().done)return!0;return!1}prepareGame(){"w"==this._turn?this.prepareTurn(this.bKing):this.prepareTurn(this.wKing),this.prepareCurrentTurn()}resetGame(e){for(let e=0;e<8;e++)this.wPositions[e]=0,this.bPositions[e]=0,this.wThreats[e]=0,this.bThreats[e]=0;this.pieces.clear(),this.wPieces.clear(),this.bPieces.clear(),null!=this.wKing.position&&this.wKing.captured(),null!=this.bKing.position&&this.bKing.captured(),this._regainablePieces.length=0,this._specialPawnCapture=null,this._turn=e,this.pieces.set(this.wKing.key,this.wKing),this.pieces.set(this.bKing.key,this.bKing)}computeHeuristic(d,g,v,m){function w(e){let i=0;for(;0<e;)i+=1&e,e>>>=1;return i}function f(e){let i=0;for(e>>>=1;0<e;)i+=1&e,e>>>=2;return i}var C=this.turnKing;if(m.pieces[0]=0,m.pieces[1]=0,m.positioning=0,m.mobility=0,v){var y=d;C.checked?C.isDoubleCheck()?m.king=-15:C.isKnightOrCloseCheck()?m.king=-12:m.king=-10:C.moved?m.king=0:m.king=.1;for(const L of C.attemptMoves(this,!0)){var b=this.hasPiece(L);C.checked?this.isThreatened(L,y)?m.king-=2:null==b?m.king+=.5:b==y&&(m.king-=.5):this.isThreatened(L,y)?m.king-=this.hasThreat(L,y)?.25:.5:null==b?m.king-=.01:b==y&&(m.king+=.05)}var v="w"==d?this.wPieces:this.bPieces,k="w"==d?this.bPieces:this.wPieces,T="w"==d?this.wThreats:this.bThreats,K="w"==d?this.bThreats:this.wThreats,_="w"==d?31:31<<24,D="w"==d?31<<24:31,S="w"==d?this.bPositions:this.wPositions;let s=0,o=0,i=0,t=0,e=0,n=0,r=0,a=0,l=0;var M="w"==y?this.wThreats:this.bThreats;for(let e=0;e<=7;e++)M[e]=0;for(const A of v.values())A.markThreats(this);let c=0,h=0,u=0,p=0,P=0;var H,I=(e,i)=>"w"==i?8<e[1]:e[1]<20,R=(e,i)=>"w"==i?e[1]>(7==e[0]?6:3):e[1]<(7==e[0]?22:25);for(const G of v.values())if(null!=G.position){var N=this.hasThreat(G.position,y);if(m.pieces[0]+=G.value,"J"===G.symbol&&e++,this.isThreatened(G.position,y)?a-=N?.75*G.value:G.value:N&&(a+=1-.0625*G.value),null==G.pin){for(const U of this.pieceMoves(G))m.mobility+=.01;if(G.hasOrthogonalAttack){for(var[O,E]of function*(t,e,s){for(const l of q.csConvert.orthogonalDirections()){var o=V.PositionHelper.orthogonalRide(e,l);let i=o.next();for(;0==i.done;){var n=t.getPiece(i.value);if(null==n)i=o.next();else{var r=V.PositionHelper.orthogonalRide(i.value,l);let e=r.next();for(;0==e.done;){var a=t.getPiece(e.value);e=null==a?o.next():(a.color!=s&&(yield[n,a]),r.return())}i=o.return()}}}}(this,G.position,y))O.color==y?O.value<=G.value&&G.value<E.value&&(O.hasOrthogonalAttack?a+=.25*(E.value-O.value):!N&&E.hasOrthogonalAttack||(a+=.0625*E.value)):O.value>G.value?a+=.25*(O.value-G.value):O.value<E.value&&!O.hasOrthogonalAttack&&E.value>G.value&&(a+=.25*O.value);R(G.position,y)&&(p+=G.value)}if(G.hasDiagonalAttack){for(var[x,F]of function*(t,e,s){for(const l of q.csConvert.diagonalDirections()){var o=V.PositionHelper.diagonalRide(e,l);let i=o.next();for(;0==i.done;){var n=t.getPiece(i.value);if(null==n)i=o.next();else{var r=V.PositionHelper.diagonalRide(i.value,l);let e=r.next();for(;0==e.done;){var a=t.getPiece(e.value);e=null==a?o.next():(a.color!=s&&(yield[n,a]),r.return())}i=o.return()}}}}(this,G.position,y))x.color==y?x.value<=G.value&&G.value<F.value&&(x.hasDiagonalAttack?a+=.25*(F.value-x.value):!N&&F.hasDiagonalAttack||(a+=.0625*F.value)):x.value>G.value?a+=.25*(x.value-G.value):x.value<F.value&&!x.hasDiagonalAttack&&F.value>G.value&&(a+=.25*x.value);R(G.position,y)&&(p+=G.value)}else J.csPieceTypes.isElephant(G)||J.csPieceTypes.isAlmogaver(G)?(h+=G.value,I(G.position,y)&&(u+=G.value)):J.csPieceTypes.isPawn(G)&&(h+=G.value,G.hasTripleStep(this.isGrand)?m.mobility+=.01:I(G.position,y)&&(u++,N)&&(u++,V.PositionHelper.promotionDistance(G.position,y)<14)&&(P+=14-V.PositionHelper.promotionDistance(G.position,y)<<1))}else l-=G.value,m.king-=N?.2:.4}g<=12&&h-u>>1>u&&(c=u-p);for(const B of k.values())null!=B.position&&(m.pieces[1]+=B.value,"J"===B.symbol&&n++,this.hasThreat(B.position,y)&&(a+=B.value),null!=B.pin)&&(l+=B.value);for(let t=0;t<=7;t++){let e=S[t]&T[t]&~K[t],i=0;for(;0!=e;)1==(1&e)&&(H=(t<<1)-(i+1)%2,H=this.getPiece([H,i]),r+=H.value),e>>>=1,i++;s+=w(T[t]),o+=w(K[t])}i+=f(T[2]&~K[2]&_),t+=f(K[2]&~T[2]&D);for(let e=3;e<=5;e++)i+=w(T[e]&~K[e]&_),t+=w(K[e]&~T[e]&D);2<=e&&(m.pieces[0]+=3==e?1:.5),2<=n&&(m.pieces[1]+=3==n?1:.5),m.space[0]=.01*s,m.space[1]=.01*o,m.positioning=.01*(i-t+a+l+c+P)+.125*r}else C.checked?m.king=-120:m.king=-6,m.space[0]=0,m.space[0]=0;return m}}class k extends(t.Board=p){static movesToString(t){var s=[];if(0<t.length){let e;for(let i=e="b"==t[0].turn?(s.push(t[0].n+". …, "+o.csMoves.fullMoveNotation(t[0])),1):0;i<t.length;i+=2){let e=o.csMoves.fullMoveNotation(t[i]);i+1<t.length&&(e+=", "+o.csMoves.fullMoveNotation(t[i+1])),s.push(e)}}return s.join("\n")}static kingCastlingPosition(e,i){var t="w"==e?V.PositionHelper.whiteKingInitPosition:V.PositionHelper.blackKingInitPosition,e=("w"==e?k.whiteKingCastlingMove:k.blackKingCastlingMove)[i];return V.PositionHelper.knightJump(t,e)}static convertPieceAliases(e){switch(e){case"Q":return"D";case"W":return"V";case"T":return"R";case"C":case"S":return"N";case"A":case"B":case"F":case"L":return"J";default:if(q.csTypes.isPieceName(e))return e;throw new TypeError("Invalid piece symbol "+e)}}static rookCastleMove(e,i,t,s,o){return"K"==s?"K"==i?o?"w"==t?"ColumnUp":"ColumnDown":"w"==t?"FileUp":"FileDown":"I"==i?o?"w"==t?"FileInvDown":"FileInvUp":"w"==t?"ColumnUp":"ColumnDown":"w"==t?"FileInvUp":"FileInvDown":"E"==i&&"D"==e?"w"==t?"FileDown":"FileUp":"w"==t?"FileUp":"FileDown"}constructor(e=!1,i){var t=i?.split(" ");if(super(e,null==t?.[1]||"w"!=t[1]&&"b"!=t[1]?"w":t[1]),this._moves=[],this._top=-1,this.fixedNumbering=!0,this._mate=!1,this._stalemate=!1,this._draw=!1,this._resigned=!1,this._enpassantCaptureCoordString=null,void 0===i)this.fillDefaultPositions(),this.halfmoveClock=0,this._moveNumber=1,this.fixedNumbering=!0;else{if(!(null!=t&&2<=t.length&&q.csTypes.isTurn(t[1])))throw new Error("Piece positions and turn are mandatory parts of the TLPD string");var[e,i]=p.splitCastlingStatus(t[2]);if(this.restoreTLPDPositions(t[0],e,i),this.halfmoveClock=q.csTypes.isNumber(Number(t[4]))?Number(t[4]):0,isNaN(Number(t[4]))&&null!=t[4]&&"-"!==t[4])throw new TypeError("Invalid halfmove clock value");if(this._moveNumber=q.csTypes.isNumber(Number(t[5]))?Number(t[5]):1,isNaN(Number(t[5]))){if(null!=t[5]&&"-"!=t[5])throw new TypeError("Invalid move number");this.fixedNumbering=!1}else this.fixedNumbering=!0;super.specialPawnCapture=n.parse(this,t[3])}this.initGame()}get moveNumber(){return this._moveNumber}get gameEnd(){return this._mate||this._stalemate||this._draw||this._resigned}get mate(){return this._mate}get stalemate(){return this._stalemate}set draw(e){this._draw=e}get draw(){return this._draw}set resign(e){this._resigned=e}get resigned(){return this._resigned}getHexPiece(e){e=V.PositionHelper.parse(e);return null!=e&&V.PositionHelper.isValidPosition(e)?this.getPiece(e):null}get lastMove(){return 0<this._moves.length?this._moves[this._moves.length-1]:null}get strLastMove(){return 0<=this._top?o.csMoves.fullMoveNotation(this._moves[this._top],!1):null}get resultString(){if(this.gameEnd){if(this._mate||this._resigned)return"w"==this.turn?"0 - 3":"3 - 0";if(this._stalemate)return"w"==this.turn?"1 - 2":"2 - 1";if(this._draw)return"1 - 1";throw new Error("End game exhaustiveCheck fail")}return null}set resultString(e){if(null!=e&&0<e.length)if(this.gameEnd){if(e!=this.resultString)throw new Error(`Incorrect end game value issued: ${e} correct value `+this.resultString)}else switch(e){case"0 - 3":if("w"!=this.turn)throw new Error("Incorrect resign turn: "+e);this.resign=!0;break;case"3 - 0":if("b"!=this.turn)throw new Error("Incorrect resign turn: "+e);this.resign=!0;break;case"1 - 1":this.draw=!0;break;case"null":break;default:throw new Error("Incorrect end game value issued: "+e)}}get enPassantCaptureCoordString(){return this._enpassantCaptureCoordString}get preMoveHeuristic(){return this.currentHeuristic}*pieceList(){for(const e of this.whitePieces())yield e.uncapitalizedSymbolPositionString;for(const i of this.blackPieces())yield i.uncapitalizedSymbolPositionString}*threatenedPieceStringPositions(){var e="w"==this.turn?this.whitePiecePositions():this.blackPiecePositions(),i=this.turn;for(const t of e)this.isThreatened(t,i)&&(yield V.PositionHelper.toString(t))}*threatsPieceStringPositions(){var e="w"==this.turn?this.blackPiecePositions():this.whitePiecePositions(),i=this.turn;for(const t of e)this.hasThreat(t,i)&&(yield V.PositionHelper.toString(t));var e=this.specialPawnCapture;null!=e&&(e.isScornfulCapturable()?yield V.PositionHelper.toString(e.capturablePiece.position):e.isEnPassantCapturable()&&(e=e.capturablePiece.position,this.isThreatened(e,i))&&(yield V.PositionHelper.toString(e)))}doMove(e,i,t){try{(0,y.assertCondition)(this._top==this._moves.length-1,"push the moves over the last one");var s,o,n=V.PositionHelper.parse(e),r=V.PositionHelper.parse(i),a=this.getPiece(n),l=((0,y.assertCondition)(null!=a,`piece on ${e} position`),(0,y.assertCondition)(null==t||a.symbol==t,t+" is the piece on "+n),(0,y.assertCondition)(a.canMoveTo(this,r),`Piece ${a.symbol} at ${a.position?.toString()} move to `+r.toString()),{piece:a.key,pos:n,moveTo:r}),c=this.getPiece(r);null!=c?((0,y.assertCondition)(a.color!=c.color&&a.canCaptureOn(this,r),`Piece ${a.symbol} at ${a.position?.toString()} capture on `+r.toString()),s=J.csPieceTypes.isPawn(a)&&null!=this.specialPawnCapture&&this.specialPawnCapture.isScornfulCapturable()&&this.specialPawnCapture.isScorned(a,r),l.captured=c.key,l.special=s?r:void 0,this._enpassantCaptureCoordString=null):null!=this.specialPawnCapture&&(J.csPieceTypes.isPawn(a)||J.csPieceTypes.isElephant(a)||J.csPieceTypes.isAlmogaver(a))&&this.specialPawnCapture.isEnPassantCapturable()&&this.specialPawnCapture.isEnPassantCapture(r,a)?(o=this.specialPawnCapture.capturablePiece,l.captured=o.key,l.special=[o.position[0],o.position[1]],this._enpassantCaptureCoordString=V.PositionHelper.toString(l.special)):this._enpassantCaptureCoordString=null,this.pushMove(l)}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="DoMove"),e}}doPromotePawn(e,i,t){try{(0,y.assertCondition)(this._top==this._moves.length-1,"push the moves over the last one");var s,o,n,r=V.PositionHelper.parse(e),a=V.PositionHelper.parse(i),l=this.getPiece(r),c=((0,y.assertCondition)(null!=l&&J.csPieceTypes.isPawn(l),`pawn on ${e} position`),(0,y.assertCondition)(V.PositionHelper.isPromotionHex(a,l.color),"Promotion hex"),V.PositionHelper.hexColor(a)),h=super.findRegeinablePiece(l.color,t,c),u={piece:l.key,prPos:a,promoted:h};V.PositionHelper.equals(r,a)||(u.pos=r,u.moveTo=a,null!=(s=this.getPiece(a))?((0,y.assertCondition)(l.color!=s.color&&l.canCaptureOn(this,a),`Pawn at ${h.position?.toString()} capture on `+a.toString()),o=J.csPieceTypes.isPawn(h)&&null!=this.specialPawnCapture&&this.specialPawnCapture.isScornfulCapturable()&&this.specialPawnCapture.isScorned(h,a),u.captured=s.key,u.special=o?a:void 0,this._enpassantCaptureCoordString=null):null!=this.specialPawnCapture&&this.specialPawnCapture.isEnPassantCapturable()&&this.specialPawnCapture.isEnPassantCapture(a,l)?(n=this.specialPawnCapture.capturablePiece,u.captured=n.key,u.special=[n.position[0],n.position[1]],this._enpassantCaptureCoordString=V.PositionHelper.toString(u.special)):this._enpassantCaptureCoordString=null),this.pushMove(u)}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="DoPromotePawn"),e}}doCastling(e){try{this.isGrand?(0,y.assertCondition)(q.csTypes.isGrandCastlingString(e),"castling move string"):(0,y.assertCondition)(q.csTypes.isCastlingString(e),"castling move string");var i,t,s=super.turnKing,o=this.turn,n=e.split("-"),r="R"==n[0][2]?"K":n[0][2],a=n[1][0],l=n[1][1],c=3==n[1].length&&"O"!=n[1][2]?n[1][2]:void 0,h=!(3<n[1].length)&&(3==n[1].length&&"O"==n[1][2]||void 0),u=k.kingCastlingPosition(s.color,a),p=((0,y.assertCondition)("K"==r||"D"==r,r+" must be King (K) side or Queen (D) side"),this.castlingRookPosition(a,l,r,h)),P=this.getPiece("K"==r?V.PositionHelper.initialKingSideRookPosition(o,this.isGrand):V.PositionHelper.initialQueenSideRookPosition(o,this.isGrand)),d=((0,y.assertCondition)(!s.moved,"King hasn't been moved"),(0,y.assertNonNullish)(u,"king destination hex"),(0,y.assertCondition)(null==this.hasPiece(u),"empty king destination hex"),(0,y.assertCondition)(!this.isThreatened(u,s.color),"Not threated king destination hex"),(0,y.assertNonNullish)(P,"castling rook piece"),(0,y.assertCondition)(J.csPieceTypes.isRook(P),"castling rook"),(0,y.assertCondition)(!P.moved,"castling rook's not been moved"),(0,y.assertCondition)(P.canMoveTo(this,p,!1),"castling rook movement"),{side:n[0][2],col:a,rPos:p,kRook:"K"==r?P.key:void 0,qRook:"D"==r?P.key:void 0});void 0!==c&&(i=this.castlingRookPosition(a,c,"D",h),t=this.getPiece(V.PositionHelper.initialQueenSideRookPosition(o,this.isGrand)),(0,y.assertNonNullish)(t,"double castling queen side rook"),(0,y.assertCondition)(J.csPieceTypes.isRook(t),"castling queen rook"),(0,y.assertCondition)(!t.moved,"castling queen rook's not been moved"),(0,y.assertCondition)(t.canMoveTo(this,i,!1),"castling queen rook movement"),d.r2Pos=i,d.qRook=t.key),this._enpassantCaptureCoordString=null,this.pushMove(d)}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="doCastling"),e}}popMove(){if(1<this._moves.length||0==this._top&&"…"!=this._moves[0].move){(0,y.assertCondition)("…"!=this._moves[this._top].move),this._top--;var e=this._moves.pop();if((0,y.assertCondition)("…"!=e.move),super.nextTurn(),this._draw=!1,this._resigned=!1,this._mate=!1,this._stalemate=!1,this.undoMove(e.move,e.turn),void 0!==e.castlingStatus&&o.csMoves.isMoveInfo(e.move)){var i=q.csConvert.getPieceKeyName(e.move.piece);if("R"===i||"K"===i){var t=this.pieceByKey(e.move.piece);switch(i){case"R":t.setCastlingStatus(e.castlingStatus,this.isGrand);break;case"K":t.castlingStatus=e.castlingStatus}}}void 0===e.specialPawnCapture?this.specialPawnCapture=null:this.specialPawnCapture=n.parse(this,e.specialPawnCapture),this.isAwaitingPromotion&&(o.csMoves.isMoveInfo(e.move)&&"P"==q.csConvert.getPieceKeyName(e.move.piece)||o.csMoves.isPromotionInfo(e.move))&&this.computeAwaitingPromotion("b"==e.turn?"w":"b"),"b"===this.turn&&this._moveNumber--,void 0===e.initHalfMoveClock?this.halfmoveClock--:this.halfmoveClock=0,super.prepareCurrentTurn(),super.computeHeuristic(this.turn,this._moveNumber,!0,this.currentHeuristic)}}*castlingMoves(e,i){}*castlingStrMoves(e,o){var i=V.PositionHelper.initialQueenSideRookPosition(e,this.isGrand),t=V.PositionHelper.initialKingSideRookPosition(e,this.isGrand),n=this.getPiece(i),s=this.getPiece(t);if(null!=s&&!s.moved)for(const h of q.csConvert.orthogonalDirections()){var r=V.PositionHelper.orthogonalStep(o,h);if(null!=r&&s.canMoveTo(this,r,!1)){let s="KRK-"+q.csConvert.columnFromIndex(o[0])+q.csConvert.columnFromIndex(r[0]);if(9==o[0]&&10==r[0]&&(a=r[1]-t[1],s+=2==a||-2==a?"O":"OO"),yield s,null!=n&&!n.moved){let i,t;if(o[0]==r[0]){i=r[0]+1,t=o[1]>r[1]?r[1]+1:o[1]+1;var a=[i,t];let e;(e=n.canMoveTo(this,a,!1))||(a[0]=r[0]-1,e=n.canMoveTo(this,a,!1)),e&&(yield s="KRR-"+q.csConvert.columnFromIndex(o[0])+q.csConvert.columnFromIndex(r[0])+q.csConvert.columnFromIndex(a[0]))}else{i=r[0],t=o[1]>r[1]?r[1]+2:r[1]-2;var l=[i,t];n.canMoveTo(this,l,!1)&&(yield s="KRR-"+q.csConvert.columnFromIndex(o[0])+q.csConvert.columnFromIndex(r[0])+q.csConvert.columnFromIndex(l[0])),l[0]=o[0],l[1]=o[1]>r[1]?o[1]-2:o[1]+2,n.canMoveTo(this,l,!1)&&(yield s="KRR-"+q.csConvert.columnFromIndex(o[0])+q.csConvert.columnFromIndex(r[0])+q.csConvert.columnFromIndex(l[0]))}}}}if(null!=n&&!n.moved)for(const u of q.csConvert.orthogonalDirections()){var c=V.PositionHelper.orthogonalStep(o,u);null!=c&&n.canMoveTo(this,c,!1)&&(yield"KRD-"+q.csConvert.columnFromIndex(o[0])+q.csConvert.columnFromIndex(c[0]))}}castlingKingPosition(e){(0,y.assertCondition)(q.csTypes.isCastlingColumn(e),`Column: ${e} has to be a king castling column`);var i=super.turnKing;return i.moved||(e=k.kingCastlingPosition(i.color,e),null!=this.hasPiece(e))||this.isThreatened(e,i.color)?null:e}castlingRookPosition(e,i,t,s){var o=this.turn,n="K"==t?V.PositionHelper.initialKingSideRookPosition(o,this.isGrand):V.PositionHelper.initialQueenSideRookPosition(o,this.isGrand),r=((0,y.assertCondition)(q.csTypes.isCastlingColumn(e),`King column: ${e} has to be a king castling column`),k.rookCastleMove(e,i,o,t,this.isGrand));let a=V.PositionHelper.orthogonalStep(n,r);if("ColumnUp"==r||"ColumnDown"==r)return a=void 0===s&&!this.isGrand||void 0!==s&&!s?V.PositionHelper.orthogonalStep(a,r):a;for(var l=q.csConvert.toColumnIndex(i);a[0]!=l;)a=V.PositionHelper.orthogonalStep(a,r);return a}playerCastlingPositionStatus(e){var i=super.turnKing;return(0,y.assertCondition)(q.csTypes.isCastlingColumn(e),`Column: ${e} has to be a king castling column`),i.moved?null:(e=("w"==this.turn?k.whiteKingCastlingMove:k.blackKingCastlingMove)[e],[e=V.PositionHelper.knightJump(i.position,e),null!=this.hasPiece(e)?"occupied":this.isThreatened(e,i.color)?"threated":""])}get castlingStatus(){var e=this.wKing.getCastlingStatus(this),i=this.bKing.getCastlingStatus(this).toLowerCase();return"-"==e&&"-"==i?"-":"-"==e?i:"-"==i?e:e+i}playerCastlingStatus(){return super.turnKing.getCastlingStatus(this)}get topHalfMove(){return this._top}moves(e){return Object.freeze(this._moves.slice(e))}strMoves(){return k.movesToString(this._moves)}moveBottom(){for(;1<this._top||1==this._top&&"…"!=this._moves[0].move;){var e=this._moves[this._top--];(0,y.assertCondition)("…"!=e.move),this.undoMove(e.move,e.turn)}}moveBackward(){var e;(1<this._top||1==this._top&&"…"!=this._moves[0].move)&&(e=this._moves[this._top--],(0,y.assertCondition)("…"!=e.move),this.undoMove(e.move,e.turn))}moveForward(){var e;this._top<this._moves.length-1&&(e=this._moves[++this._top],(0,y.assertCondition)("…"!=e.move),this.applyMove(e.move,e.turn))}moveTop(){for(;this._top<this._moves.length-1;){var e=this._moves[++this._top];(0,y.assertCondition)("…"!=e.move),this.applyMove(e.move,e.turn)}}get topMoveId(){return 0<=this._top?o.csMoves.undoStatusId(this._moves[this._top]):""}get movesJSON(){return JSON.stringify(this._moves)}restoreMovesJSON(e){e=JSON.parse(e);this.restoreMoves(e)}restoreMoves(e){for(;0<e.length;){var i=e.shift();(0,y.assertCondition)("…"!=i.move),this.pushMove(i.move)}this.initGame()}get valueTLPD(){return this.piecePositionsTLPD+" "+this.turn+" "+this.castlingStatus+" "+(this.specialPawnCapture?.toString()??"-")+" "+this.halfmoveClock.toString()+" "+(this.fixedNumbering?this._moveNumber.toString():"-")}get piecePositionsTLPD(){let e="/";for(let s=28;0<=s;s--){var o=s%2==0,n=s<=5?7-s:23<=s?s-21:o?1:0,r=s<=5?s+7:23<=s?35-s:o?13:14;let i="",t=0;for(let e=n;e<=r;e+=2){var a=this.getPiece([e,s]);null!=a?(0<t&&(i+=t.toString()),i+=a.uncapitalizedSymbol,t=0):t++}0<i.length&&(e+=s.toString()+":"+i,0<t&&(e+=t.toString()),e+="/")}return e}loadTLPD(e){try{(0,y.assertCondition)(null!=e,"Not empty TLPD"),(0,y.assertCondition)(12<e.trim().length,"Enough TLPD length");var i=e.split(" "),t=((0,y.assertCondition)(2<=i.length,"Piece positions and turn are mandatory"),(0,y.assertCondition)(10<=i[0].length,"Piece positions string"),(0,y.assertCondition)(q.csTypes.isTurn(i[1]),"Correct turn"),i[1]),[s,o]=(super.resetGame(t),this._moves.length=0,this._top=-1,p.splitCastlingStatus(i[2]));if(this.restoreTLPDPositions(i[0],s,o),this.halfmoveClock=q.csTypes.isNumber(Number(i[4]))?Number(i[4]):0,isNaN(Number(i[4]))&&null!=i[4]&&"-"!==i[4])throw new TypeError("Invalid halfmove clock value");if(this._moveNumber=q.csTypes.isNumber(Number(i[5]))?Number(i[5]):1,isNaN(Number(i[5]))){if(null!=i[5]&&"-"!=i[5])throw new TypeError("Invalid move number");this.fixedNumbering=!1}else this.fixedNumbering=!0;super.specialPawnCapture=n.parse(this,i[3]),this.initGame()}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="TLPD"),e}}restoreTLPDPositions(e,i,t){(0,y.assertCondition)(10<=e.length&&"/"==e[0]&&"/"==e[e.length-1],"Valid TLPD string positions: "+e);var s,o=[],n=[],r=[];for(s of e.split("/"))if(0<s.length){if(s.startsWith(":")||s.endsWith(":")||1!=(s.match(/:/g)||[]).length)throw new Error("Incorrect line number issued: "+s);var[a,l]=s.split(":"),c=Number(a);if(!(!isNaN(c)&&0<=c&&c<=28))throw new Error("Incorrect line issued: "+a);{var h=0<=c&&c<6?7+c:c<=22?c%2==0?13:14:35-c;let e=0<=c&&c<6?7-c:c<=22?c%2==0?1:0:c-21;for(const w of l){if(e>h)throw new Error("Incorrect TLPD line content");var u=Number(w);if(isNaN(u)){var p=q.csTypes.isPieceName(w)?w:k.convertPieceAliases(w.toUpperCase()),P=w.toUpperCase()==w?"w":"b";if("K"==p)if("w"==P){if(null!=this.wKing.position)throw new Error("Can't place two White Kings");if(this.wKing.setPositionTo([e,c]),null!=this.hasPiece(this.wKing.position))throw new Error("Can't place White King on the place used by another piece");this.addPiece(this.wKing)}else{if(null!=this.bKing.position)throw new Error("Can't place two Black Kings");if(this.bKing.setPositionTo([e,c]),null!=this.hasPiece(this.bKing.position))throw new Error("Can't place Black King on the place used by another piece");this.addPiece(this.bKing)}else{p=super.createPiece(p,P,q.csConvert.columnFromIndex(e),c);J.csPieceTypes.isRook(p)?o.push(p):J.csPieceTypes.isPawn(p)&&null!=p.awaitingPromotion&&super.setAwaitingPromotion(p.color),("w"==P?n:r).push(p)}e+=2}else e+=u<<1}}}if(null==this.wKing.position)throw new Error("There must be a White King");if(null==this.bKing.position)throw new Error("There must be a Black King");var d,g=(e,t)=>e.reduce((e,i)=>i.symbol===t?e+1:e,0);for(d of["w","b"]){var v="w"==d?n:r;let e=g(v,"D");if(1<e)throw new Error(`Too many ${d} Queens`);if(0==e&&this.addRegainablePiece(new b.Queen(d)),1<(e=g(v,"V")))throw new Error(`Too many ${d} Wyverns`);if(0==e&&this.addRegainablePiece(new b.Wyvern(d)),2<(e=g(v,"R")))throw new Error(`Too many ${d} Rooks`);for(;e<2;)this.addRegainablePiece(new b.Rook(d,this.isGrand,e)),e++;if(2<(e=g(v,"G")))throw new Error(`Too many ${d} Pegasus`);for(;e<2;)this.addRegainablePiece(new b.Pegasus(d,e)),e++;if(e=g(v,"N"),!this.isGrand&&2<e||this.isGrand&&4<e)throw new Error(`Too many ${d} Knights`);for(;e<2;)this.addRegainablePiece(new b.Knight(d,e)),e++;if(3<(e=g(v,"J")))throw new Error(`Too many ${d} Bishops`);var m={White:0,Black:0,Color:0};for(const f of v.filter(e=>J.csPieceTypes.isBishop(e)))m[f.hexesColor]+=1;if(1<m.White||1<m.Black||1<m.Color)throw new Error(`Too many ${d} Bishops on same color hexes`);0==m.White&&this.addRegainablePiece(new b.Bishop(d,"White")),0==m.Black&&this.addRegainablePiece(new b.Bishop(d,"Black")),0==m.Color&&this.addRegainablePiece(new b.Bishop(d,"Color"))}this.wKing.castlingStatus=i,this.bKing.castlingStatus=t;for(const C of o)C.setCastlingStatus("w"==C.color?i:t,this.isGrand)}applyMoveSq(e){try{(0,y.assertCondition)(this._top==this._moves.length-1,"push the moves over the last one");var i="1"!=(e=e.replaceAll(" ","").replace(/\n\n+/g,"\n").replace(/^[\s\n]+|[\s\n]+$/gm,""))[0]||"?"!=e[1],t=(e=e.replace(/^1\?/,"1.").replace(/^1....,/,"1.…"),new RegExp(/^(\d+\..*\n)+\d+\..*$/)),s=((0,y.assertCondition)(t.test(e),"numbered lines"),e.split(/\r?\n/)),o=this._moveNumber;this.fixedNumbering=this.fixedNumbering&&1!=o||i;for(let e=0;e<s.length;e++){var n=s[e].split(/[.,]\s?/),r=parseInt(n[0]);(0,y.assertCondition)(r.toString()==n[0],`Line number of "${s[e]}"`),(0,y.assertCondition)(this._moveNumber==(i?r:o+r-1),`Expected move number ${this._moveNumber} on move `+e),1==r?((0,y.assertCondition)(3==n.length,"first move must be a numbered pair of moves; white move can be an ellipsis: "+s[0]),"…"==n[1]?(0,y.assertCondition)("b"==this.turn,"It begins on black's turn"):((0,y.assertCondition)("w"==this.turn,"It begins on white's turn"),this.applyStringMove(n[1])),this.applyStringMove(n[2])):e==s.length-1?((0,y.assertCondition)(2<=n.length&&n.length<=3,"last move "+s[e]),this.applyStringMove(n[1]),3==n.length&&this.applyStringMove(n[2])):((0,y.assertCondition)(3==n.length,"numbered pair of moves: "+s[e]),this.applyStringMove(n[1]),this.applyStringMove(n[2]))}}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="Move seq"),e}}applyStringMove(e){var i,t,s,o,n,r=(e,i=0)=>{let t=i;for(;t<e.length;){var s=e.charCodeAt(t);if(!(48<=s&&s<58||65<=s&&s<91||97<=s&&s<123))return t;t++}return t},a=e=>V.PositionHelper.isValidPosition(V.PositionHelper.parse(e));(0,y.assertCondition)(this._top==this._moves.length-1,"push the move over the last one"),(0,y.assertCondition)(4<=e.length,"Moviment length must be at least of 4 chars"),e.startsWith("KR")&&"-"==e[3]||"–"==e[3]?(o="–"==e[3]?e.replace("–","-"):e,this.isGrand?(0,y.assertCondition)(q.csTypes.isGrandCastlingString(o),"grand castling move: "+o):(0,y.assertCondition)(q.csTypes.isCastlingString(o),"castling move: "+o),this.doCastling(o)):(o=r(e=e.replace("x","×")),i=q.csTypes.isPieceName(e[0])&&q.csTypes.isColumn(e[1])?e[0]:"P",t=e.slice("P"==i?0:1,o),(0,y.assertCondition)(o<e.length-1,"Moviment divided into parts"),(0,y.assertCondition)(a(t),"Initial hex"),s="@"==e.charAt(o)&&"@"==e.charAt(o+1)?"@@":e.charAt(o),(0,y.assertCondition)(["-","–","×","@","@@","="].includes(s),`valid origin&destiny separator "${s}"`),"="==s?(n=e[o+1],(0,y.assertCondition)("P"==i,"Promoting a pawn"),this.doPromotePawn(t,t,n)):((0,y.assertCondition)(o<e.length-2,"Movement destination"),r=r(e,n=o+s.length),o=q.csTypes.isPieceName(e[n])&&q.csTypes.isColumn(e[n+1])?e[n]:void 0,n=e.slice(void 0===o?n:n+1,r),(0,y.assertCondition)(a(n),"Destination hex"),(0,y.assertCondition)(void 0===o||"-"!=s&&"–"!=s,"Captured piece"),r<e.length&&"="==e[r]?(a=e[r+1],(0,y.assertCondition)("P"==i,"Promoting a pawn"),this.doPromotePawn(t,n,a)):this.doMove(t,n,i)))}pushMove(e){var i={n:this._moveNumber,turn:this.turn,move:e,fixedNumbering:1!=this._moveNumber||this.fixedNumbering?void 0:"?",initHalfMoveClock:0==this.halfmoveClock?"1":void 0,specialPawnCapture:null==this.specialPawnCapture?void 0:this.specialPawnCapture.toString(),castlingStatus:o.csMoves.isMoveInfo(e)&&0<=["K","R"].indexOf(q.csConvert.getPieceKeyName(e.piece))?this.playerCastlingStatus():void 0},e=(this.applyMove(e,this.turn),super.nextTurn(),"w"===this.turn&&this._moveNumber++,o.csMoves.isMoveInfo(e)&&["P","M"].includes(q.csConvert.getPieceKeyName(e.piece))||o.csMoves.isCaptureInfo(e)||o.csMoves.isPromotionInfo(e)?this.halfmoveClock=0:this.halfmoveClock++,super.prepareCurrentTurn(),super.isMoveableTurn());let t=void 0,s=void 0;if(e){if(200<=this.halfmoveClock||super.insuficientMaterial())this._draw=!0,t="draw";else if(this.checked)if(this.isKnightOrCloseCheck)s="^+";else if(this.isSingleCheck)s="+";else{if(!this.isDoubleCheck)throw new Error("never: exhaused check options");s="++"}}else t=this.checked?(this._mate=!0,"mate"):(this._stalemate=!0,"stalemate");this._top<0&&"b"==i.turn&&(this._moves.push({n:i.n,turn:"w",move:"…"}),this._top++);i=o.csMoves.promoteUndoStatus(i,t,s);this._moves.push(i),this._top++,super.computeHeuristic(this.turn,this._moveNumber,e,this.currentHeuristic)}applyMove(e,i){var t;o.csMoves.isCastlingInfo(e)?this.applyCastling(e,i):(i=this.pieceByKey(e.piece),o.csMoves.isMoveInfo(e)&&(t=e.moveTo,o.csMoves.isCaptureInfo(e)&&super.capturePiece(this.pieceByKey(e.captured)),super.movePiece(i,t[0],t[1]),!o.csMoves.isPromotionInfo(e))||super.promotePawn(i,this.pieceByKey(e.promoted)))}applyCastling(e,i){var i="w"==i?this.wKing:this.bKing,t=k.kingCastlingPosition(i.color,e.col);switch(e.side){case"K":super.movePiece(this.pieceByKey(e.kRook),e.rPos[0],e.rPos[1]);break;case"D":super.movePiece(this.pieceByKey(e.qRook),e.rPos[0],e.rPos[1]);break;case"R":super.movePiece(this.pieceByKey(e.kRook),e.rPos[0],e.rPos[1]),super.movePiece(this.pieceByKey(e.qRook),e.r2Pos[0],e.r2Pos[1])}super.movePiece(i,t[0],t[1])}undoMove(e,i){var t;o.csMoves.isCastlingInfo(e)?this.undoCastling(e,i):(i=this.pieceByKey(e.piece),o.csMoves.isMoveInfo(e)?(o.csMoves.isPromotionInfo(e)&&super.undoPromotePawn(i,this.pieceByKey(e.promoted)),super.undoPieceMove(i,e.pos[0],e.pos[1]),o.csMoves.isCaptureInfo(e)&&(t=void 0===e.special?e.moveTo:e.special,super.undoCapturePiece(this.pieceByKey(e.captured),t[0],t[1]))):super.undoPromotePawn(i,this.pieceByKey(e.promoted)))}undoCastling(e,i){var t=this.isGrand,s="w"==i?this.wKing:this.bKing,o="w"==i?V.PositionHelper.whiteKingInitPosition:V.PositionHelper.blackKingInitPosition,n="D"==e.side?V.PositionHelper.initialQueenSideRookPosition(i,t):V.PositionHelper.initialKingSideRookPosition(i,t),r=this.pieceByKey("D"==e.side?e.qRook:e.kRook);console.log(e),(0,y.assertNonNullish)(r),super.undoPieceMove(s,o[0],o[1]),super.undoPieceMove(r,n[0],n[1]),s.castlingStatus="RKR",r.setCastlingStatus("RKR",t),"R"==e.side&&(o=this.pieceByKey(e.qRook),n=V.PositionHelper.initialQueenSideRookPosition(i,t),super.undoPieceMove(o,n[0],n[1]),o.setCastlingStatus("RKR",t))}fillDefaultPositions(){this.wKing.setToInitialPosition(),this.addPiece(this.wKing),this.bKing.setToInitialPosition(),this.addPiece(this.bKing),super.createPiece("D","w","E",1),super.createPiece("V","w","F",0),super.createPiece("G","w","D",2),super.createPiece("J","w","F",2),super.createPiece("G","w","H",2),this.isGrand?(super.createPiece("P","w","B",6),super.createPiece("R","w","B",4),super.createPiece("N","w","C",3),super.createPiece("N","w","I",3),super.createPiece("R","w","K",4),super.createPiece("P","w","K",6),super.createPiece("P","w","P",7),super.createPiece("P","w","T",8),super.createPiece("P","w","X",8),super.createPiece("P","w","Z",7),super.createPiece("M","w","C",7),super.createPiece("M","w","A",7),super.createPiece("M","w","L",7),super.createPiece("M","w","I",7)):(super.createPiece("P","w","B",4),super.createPiece("R","w","C",3),super.createPiece("R","w","I",3),super.createPiece("P","w","K",4)),super.createPiece("N","w","E",3),super.createPiece("N","w","G",3),super.createPiece("E","w","D",4),super.createPiece("J","w","F",4),super.createPiece("E","w","H",4),super.createPiece("P","w","A",5),super.createPiece("P","w","C",5),super.createPiece("E","w","E",5),super.createPiece("E","w","G",5),super.createPiece("P","w","I",5),super.createPiece("P","w","L",5),super.createPiece("P","w","D",6),super.createPiece("J","w","F",6),super.createPiece("P","w","H",6),super.createPiece("P","w","E",7),super.createPiece("P","w","F",8),super.createPiece("P","w","G",7),super.createPiece("D","b","E",27),super.createPiece("V","b","F",28),super.createPiece("G","b","D",26),super.createPiece("J","b","F",26),super.createPiece("G","b","H",26),this.isGrand?(super.createPiece("P","b","B",22),super.createPiece("R","b","B",24),super.createPiece("N","b","C",25),super.createPiece("N","b","I",25),super.createPiece("R","b","K",24),super.createPiece("P","b","K",22),super.createPiece("P","b","P",21),super.createPiece("P","b","T",20),super.createPiece("P","b","X",20),super.createPiece("P","b","Z",21),super.createPiece("M","b","C",21),super.createPiece("M","b","A",21),super.createPiece("M","b","I",21),super.createPiece("M","b","L",21)):(super.createPiece("P","b","B",24),super.createPiece("R","b","C",25),super.createPiece("R","b","I",25),super.createPiece("P","b","K",24)),super.createPiece("N","b","E",25),super.createPiece("N","b","G",25),super.createPiece("E","b","D",24),super.createPiece("J","b","F",24),super.createPiece("E","b","H",24),super.createPiece("P","b","A",23),super.createPiece("P","b","C",23),super.createPiece("E","b","E",23),super.createPiece("E","b","G",23),super.createPiece("P","b","I",23),super.createPiece("P","b","L",23),super.createPiece("P","b","D",22),super.createPiece("J","b","F",22),super.createPiece("P","b","H",22),super.createPiece("P","b","E",21),super.createPiece("P","b","F",20),super.createPiece("P","b","G",21)}initGame(){super.prepareGame(),this._mate=!1,this._stalemate=!1,this._resigned=!1,this._draw=!1;var e=super.isMoveableTurn();e?200<=this.halfmoveClock&&(this._draw=!0):this.checked?this._mate=!0:this._stalemate=!0,super.computeHeuristic(this.turn,this._moveNumber,e,this.currentHeuristic)}}(t.Game=k).whiteKingCastlingMove={I:"LineUp-FileUp",H:"LineUp-ColumnUp",F:"LineInvUp-ColumnUp",E:"LineInvUp-FileInvUp",D:"TransversalLineDec-FileInvUp"},k.blackKingCastlingMove={I:"LineDown-FileDown",H:"LineDown-ColumnDown",F:"LineInvDown-ColumnDown",E:"LineInvDown-FileInvDown",D:"TransversalLineDec-FileInvDown"}},{"./cescacs.moves":2,"./cescacs.piece":3,"./cescacs.positionHelper":4,"./cescacs.types":5,"./ts.general":6}],2:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csMoves=t.undoStatusArrayEquals=t.undoStatusEquals=t.isUndoStatus=void 0;const o=e("./cescacs.types"),n=e("./cescacs.positionHelper");function s(e,i){return e.n==i.n&&e.turn==i.turn&&("…"==e.move&&"…"==i.move||"…"!=e.move&&"…"!=i.move&&r.equals(e.move,i.move))&&e.initHalfMoveClock==i.initHalfMoveClock&&e.castlingStatus==i.castlingStatus&&e.specialPawnCapture==i.specialPawnCapture&&e.fixedNumbering==i.fixedNumbering&&e.end==i.end&&e.check==i.check}var r,a;function l(e){return"string"==typeof e&&("K"===e||"D"===e||"R"===e)}function c(e){return void 0!==e.side&&l(e.side)&&void 0!==e.col&&o.csTypes.isCastlingColumn(e.col)&&void 0!==e.rPos&&o.csTypes.isPosition(e.rPos)&&("D"===e.side||void 0!==e.kRook&&"R"==o.csConvert.getPieceKeyName(e.kRook))&&("K"===e.side||void 0!==e.qRook&&"R"==o.csConvert.getPieceKeyName(e.qRook))&&("R"!=e.side||void 0!==e.r2Pos&&o.csTypes.isPosition(e.r2Pos))}function h(e){return void 0!==e.piece&&void 0!==e.prPos&&o.csTypes.isPosition(e.prPos)&&void 0!==e.promoted}function u(e){return void 0!==e.piece&&void 0!==e.pos&&o.csTypes.isPosition(e.pos)&&void 0!==e.moveTo&&o.csTypes.isPosition(e.moveTo)}function p(e){return void 0!==e.captured&&(void 0===e.special||o.csTypes.isPosition(e.special))}t.isUndoStatus=function(e){return void 0!==e.n&&"number"==typeof e.n&&void 0!==e.turn&&o.csTypes.isTurn(e.turn)&&void 0!==e.move&&("…"==e.move||r.isMoveInfo(e.move)||r.isCastlingInfo(e.move)||r.isPromotionInfo(e.move))&&(void 0===e.initHalfMoveClock||"1"==e.initHalfMoveClock)&&(void 0===e.castlingStatus||o.csTypes.isCastlingStatus(e.castlingStatus))&&(void 0===e.specialPawnCapture||"string"==typeof e.specialPawnCapture&&0<e.specialPawnCapture.indexOf("@"))&&(void 0===e.fixedNumbering||"?"==e.fixedNumbering)},t.undoStatusEquals=s,t.undoStatusArrayEquals=function(e,t){return e.every((e,i)=>s(e,t[i]))},(a=r=t.csMoves||(t.csMoves={})).promoteUndoStatus=function(e,i,t){return void 0!==i&&(e.end=i),void 0!==t&&(e.check=t),e},a.isCastlingSide=l,a.isCastlingInfo=c,a.isPromotionInfo=h,a.isMoveInfo=u,a.isCaptureInfo=p,a.fullMoveNotation=function(e,i=!0){var t,i=i&&"w"==e.turn?e.n+(void 0===e.fixedNumbering?". ":"? "):"";return"…"==e.move?i+"…":(t=e.check??("mate"==e.end?"#":""),i+a.moveNotation(e.move)+t)},a.endText=function(e,i){if(void 0===e.end)return"";switch(e.end){case"mate":case"resigned":return"b"==i?"3 - 0":"0 - 3";case"stalemate":return"b"==i?"2 - 1":"1 - 2";case"draw":return"1 - 1";default:var t=e.end;throw new Error(t)}},a.undoStatusId=function(e){return"…"==e.move?"":e.turn+e.n},a.moveNotation=function(i){if(a.isCastlingInfo(i))return t=void 0!==i.r2Pos?o.csConvert.columnFromIndex(i.r2Pos[0]):"K"==i.side&&"H"==i.col&&10==i.rPos[0]?5==i.rPos[1]||23==i.rPos[1]?"O":7==i.rPos[1]||21==i.rPos[1]?"OO":"":"","KR"+i.side+"-"+i.col+o.csConvert.columnFromIndex(i.rPos[0])+t;if(a.isMoveInfo(i)){var t=o.csConvert.getPieceKeyName(i.piece),t=("P"==t?"":t)+n.PositionHelper.toString(i.pos),s=h(i)?"="+o.csConvert.getPieceKeyName(i.promoted):"";let e;return t+(e=p(i)?void 0!==i.special?n.PositionHelper.equals(i.moveTo,i.special)||Math.abs(i.special[1]-i.moveTo[1])<=2?"@":"@@":"P"==(t=o.csConvert.getPieceKeyName(i.captured))?"×":"×"+t:"-")+n.PositionHelper.toString(i.moveTo)+s}if(a.isPromotionInfo(i))return n.PositionHelper.toString(i.prPos)+"="+o.csConvert.getPieceKeyName(i.promoted);throw new TypeError("must be a move notation")},a.equals=function(e,i){return u(e)&&u(i)?e.piece==i.piece&&n.PositionHelper.equals(e.pos,i.pos)&&n.PositionHelper.equals(e.moveTo,i.moveTo):h(e)&&h(i)?e.piece==i.piece&&e.promoted==i.promoted&&n.PositionHelper.equals(e.prPos,i.prPos):!(!c(e)||!c(i))&&e.side==i.side&&e.col==i.col&&n.PositionHelper.equals(e.rPos,i.rPos)&&e.kRook==i.kRook&&e.qRook==i.qRook}},{"./cescacs.positionHelper":4,"./cescacs.types":5}],3:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csPieceTypes=t.Pawn=t.Almogaver=t.Elephant=t.Bishop=t.Knight=t.Pegasus=t.Rook=t.Wyvern=t.Queen=t.King=t.Piece=void 0;const g=e("./cescacs.types"),v=e("./cescacs.positionHelper"),l=e("./ts.general"),u=e("./cescacs");class s{static pieceValue(e){switch(e){case"K":return 256;case"D":return 15;case"V":return 14;case"R":return 11;case"G":return 8;case"N":return 4;case"J":return 3;case"E":case"M":return 2;case"P":return 1;default:throw new Error(e)}}static isRegainablePiece(e){switch(e){case"D":case"V":case"R":case"G":case"N":case"J":return!0;default:return!1}}constructor(e){this.color=e}get position(){return this._position}setPositionTo(e){if(null!=this._position)throw new Error("Piece can't be reassigned to a new position");this._position=e}moveTo(e,i){null!=this._position&&(this._position[0]=e,this._position[1]=i)}get pin(){return this._pin}set pin(e){this._pin=e}get hasOrthogonalAttack(){return"R"==this.symbol||"V"==this.symbol||"D"==this.symbol}get hasDiagonalAttack(){return"J"==this.symbol||"G"==this.symbol||"D"==this.symbol}get hasKnightJumpAttack(){return"N"==this.symbol||"V"==this.symbol||"G"==this.symbol}get hasOnlyCloseAttack(){return"P"==this.symbol||"E"==this.symbol||"M"==this.symbol||"K"==this.symbol}get isRegainable(){return s.isRegainablePiece(this.symbol)}toString(){return this.uncapitalizedSymbol+this.position?.toString()}get uncapitalizedSymbol(){return"w"==this.color?this.symbol:this.symbol.toLowerCase()}get symbolPositionString(){return this.symbol+(null==this.position?"":v.PositionHelper.toString(this.position))}get uncapitalizedSymbolPositionString(){return this.uncapitalizedSymbol+(null==this.position?"":v.PositionHelper.toString(this.position))}canMoveTo(e,i){return v.PositionHelper.positionIteratorIncludes(this.moves(e),i)}canCaptureOn(e,i){return this.canMoveTo(e,i)}captured(){(0,l.assertNonNullish)(this._position,"Don't capture again the piece"),this._position=null}*blockThreat(e,i){yield*v.PositionHelper.positionIteratorIntersection(this.moves(e),i)}*knightMoves(e,i=!1){if(null!=this._position&&null==this.pin)for(const s of v.PositionHelper.knightMoves(this._position)){var t;!i&&null!=(t=e.hasPiece(s))&&t===this.color||(yield s)}}*orthogonalMoves(i,t=!1){if(null!=this._position)for(const n of(null==this.pin?null:g.csTypes.isOrthogonalOrientation(this.pin)?this.pin:[])??g.csConvert.orthogonalDirections()){var s=v.PositionHelper.orthogonalRide(this._position,n);let e=s.next();for(;0==e.done;){var o=i.hasPiece(e.value);e=null==o?(yield e.value,s.next()):(!t&&o===this.color||(yield e.value),s.return())}}}*diagonalMoves(i,t=!1){if(null!=this._position)for(const n of(null==this.pin?null:g.csTypes.isDiagonalOrientation(this.pin)?this.pin:[])??g.csConvert.diagonalDirections()){var s=v.PositionHelper.diagonalRide(this._position,n);let e=s.next();for(;!e.done;){var o=i.hasPiece(e.value);e=null==o?(yield e.value,s.next()):(!t&&o===this.color||(yield e.value),s.return())}}}orthogonalStep(e,i,t=!0,s=!1){return null!=this._position&&(null!=this.pin&&g.csTypes.isOrthogonalOrientation(this.pin)&&this.pin,null==this._pin||this._pin.includes(i))&&null!=(i=v.PositionHelper.orthogonalStep(this._position,i))&&(e=e.hasPiece(i),s||null==e||t&&e!==this.color)?i:null}diagonalStep(e,i,t=!0,s=!1){return null!=this._position&&(null==this._pin||this._pin.includes(i))&&null!=(i=v.PositionHelper.diagonalStep(this._position,i))&&(e=e.hasPiece(i),s||null==e||t&&e!==this.color)?i:null}canMoveOrthogonallyTo(e,i,t=!0){if(null!=this.position){var s=v.PositionHelper.isOrthogonally(this.position,i);if(null!=s&&(null==this._pin||this._pin.includes(s))){var o=e.hasPiece(i);if(null==o||t&&o!=this.color)for(const n of v.PositionHelper.orthogonalRide(this.position,s)){if(v.PositionHelper.equals(i,n))return!0;if(null!=e.hasPiece(n))return!1}}}return!1}canMoveDiagonallyTo(e,i,t=!0){if(null!=this.position){var s=v.PositionHelper.isDiagonally(this.position,i);if(null!=s&&(null==this._pin||this._pin.includes(s))){var o=e.hasPiece(i);if(null==o||t&&o!=this.color)for(const n of v.PositionHelper.diagonalRide(this.position,s)){if(v.PositionHelper.equals(i,n))return!0;if(null!=e.hasPiece(n))return!1}}}return!1}}class o extends(t.Piece=s){constructor(e){super(e),this.symbol="K",this.value=0,this._moved=!1,this.checkPosition=null,this.key=e+this.symbol}setPositionTo(e){super.setPositionTo(e),this._moved=!this.isInitialPosition}setToInitialPosition(){super.setPositionTo(this.initialPosiition),this._moved=!1}get checked(){return null!=this.checkPosition}get moved(){return this._moved}set castlingStatus(e){this._moved=this.isInitialPosition&&"-"==e}getCastlingStatus(e){var i;return this._moved?"-":(i=e.getPiece(v.PositionHelper.initialKingSideRookPosition(this.color,e.isGrand)),e=e.getPiece(v.PositionHelper.initialQueenSideRookPosition(this.color,e.isGrand)),null!=i&&i.color==this.color&&w.isRook(i)&&!i.moved?null!=e&&e.color==this.color&&w.isRook(e)&&!e.moved?"RKR":"KR":null!=e&&e.color==this.color&&w.isRook(e)&&!e.moved?"KR":"K")}moveTo(e,i){super.moveTo(e,i),this._moved=!0}*moves(e){if(this.checked){(0,l.assertNonNullish)(this.position),(0,l.assertNonNullish)(this.checkPosition);for(const n of g.csConvert.orthogonalDirections()){var i,t=v.PositionHelper.orthogonalStep(this.position,n);null==t||null!=this.pin&&this.pin.includes(n)&&!g.csTypes.isCheckAttackPos(this.checkPosition,t)||null!=(i=e.hasPiece(t))&&i==this.color||e.isThreatened(t,this.color)||(yield t)}for(const r of g.csConvert.diagonalDirections()){var s,o=v.PositionHelper.diagonalStep(this.position,r);null==o||null!=this.pin&&this.pin.includes(r)&&!g.csTypes.isCheckAttackPos(this.checkPosition,o)||null!=(s=e.hasPiece(o))&&s==this.color||e.isThreatened(o,this.color)||(yield o)}}else for(const a of this.attemptMoves(e))e.isThreatened(a,this.color)||(yield a)}markThreats(e){for(const i of this.attemptMoves(e,!0))e.setThreat(i,this.color)}computeCheckAndPins(t){this.checkPosition=null,console.log(`Compute ${this.color} pins`);for(const i of v.PositionHelper.knightMoves(this.position)){var e=t.getPiece(i);null!=e&&e.color!=this.color&&e.hasKnightJumpAttack&&this.setKnightOrCloseAttack(i)}for(const P of g.csConvert.orthogonalDirections()){var s=v.PositionHelper.orthogonalRide(this.position,P);let e=s.next(),i=!0;for(;!e.done;){var o=e.value,n=t.getPiece(o);if(null==n)i=!1,e=s.next();else{if(n.color!=this.color)i?n.hasOrthogonalAttack?this.setKnightOrCloseAttack(o,P):n.hasOnlyCloseAttack&&n.canCaptureOn(t,this.position)&&this.setKnightOrCloseAttack(o):n.hasOrthogonalAttack&&this.setOrthogonalAtack(o,P);else{var r=v.PositionHelper.orthogonalRide(o,P);let e=r.next();for(;!e.done;){var a=e.value,a=t.getPiece(a);e=null==a?r.next():(a.color!=this.color&&a.hasOrthogonalAttack&&(n.pin=g.csConvert.getOrthogonalOrientation(P)),r.return())}}e=s.return()}}}for(const d of g.csConvert.diagonalDirections()){var l=v.PositionHelper.diagonalRide(this.position,d);let e=l.next(),i=!0;for(;!e.done;){var c=e.value,h=t.getPiece(c);if(null==h)i=!1,e=l.next();else{if(h.color!=this.color)i?h.hasDiagonalAttack?this.setKnightOrCloseAttack(c,d):h.hasOnlyCloseAttack&&h.canCaptureOn(t,this.position)&&this.setKnightOrCloseAttack(c):h.hasDiagonalAttack&&this.setDiagonalAtack(c,d);else{var u=v.PositionHelper.diagonalRide(c,d);let e=u.next();for(;!e.done;){var p=e.value,p=t.getPiece(p);e=null==p?u.next():(p.color!=this.color&&p.hasDiagonalAttack&&(h.pin=g.csConvert.getDiagonalOrientation(d)),u.return())}}e=l.return()}}}}isKnightOrCloseCheck(){return null!=this.checkPosition&&g.csTypes.isPosition(this.checkPosition)}isSingleCheck(){return null!=this.checkPosition&&g.csTypes.isSingleCheck(this.checkPosition)}isDoubleCheck(){return null!=this.checkPosition&&!g.csTypes.isPosition(this.checkPosition)&&!g.csTypes.isSingleCheck(this.checkPosition)}get checkThreat(){return null!=this.checkPosition?g.csTypes.isPosition(this.checkPosition)?this.checkPosition:g.csTypes.isSingleCheck(this.checkPosition)?this.checkPosition.p:null:null}getSingleCheckBlockingPositions(e){var i=[];if((0,l.assertNonNullish)(this.position),g.csTypes.isSingleCheck(this.checkPosition)){var t=this.checkPosition.d;if(g.csTypes.isDiagonalDirection(t))for(const s of v.PositionHelper.diagonalRide(this.position,t)){if(null!=e.hasPiece(s))break;i.push(s)}else if(g.csTypes.isOrthogonalDirection(t))for(const o of v.PositionHelper.orthogonalRide(this.position,t)){if(null!=e.hasPiece(o))break;i.push(o)}}return i}setOrthogonalAtack(e,i){if(null!=this.checkPosition)if(g.csTypes.isPosition(this.checkPosition))this.checkPosition=[this.checkPosition,e,null],this.pin=g.csConvert.getOrthogonalOrientation(i);else{if(!g.csTypes.isSingleCheck(this.checkPosition))throw new Error("Triple check situation can't be achieved in the course of a game");this.checkPosition=[this.checkPosition.p,e,g.csConvert.getOrthogonalOrientation(i)]}else this.checkPosition={p:e,d:i},this.pin=g.csConvert.getOrthogonalOrientation(i)}setDiagonalAtack(e,i){if(null!=this.checkPosition)if(g.csTypes.isPosition(this.checkPosition))this.checkPosition=[this.checkPosition,e,null],this.pin=g.csConvert.getDiagonalOrientation(i);else{if(!g.csTypes.isSingleCheck(this.checkPosition))throw new Error("Triple check situation can't be achieved in the course of a game");this.checkPosition=[this.checkPosition.p,e,g.csConvert.getDiagonalOrientation(i)]}else this.checkPosition={p:e,d:i},this.pin=g.csConvert.getDiagonalOrientation(i)}setKnightOrCloseAttack(e,i){if(null!=this.checkPosition){if(g.csTypes.isPosition(this.checkPosition))throw new Error("Double knight or close check situation can't be achieved in the course of a game");if(!g.csTypes.isSingleCheck(this.checkPosition))throw new Error("Triple check situation can't be reached along a game");null==i?this.checkPosition=[this.checkPosition.p,e,null]:g.csTypes.isOrthogonalDirection(i)?this.checkPosition=[this.checkPosition.p,e,g.csConvert.getOrthogonalOrientation(i)]:this.checkPosition=[this.checkPosition.p,e,g.csConvert.getDiagonalOrientation(i)]}else this.checkPosition=e,null!=i&&(this.pin=g.csTypes.isOrthogonalDirection(i)?g.csConvert.getOrthogonalOrientation(i):g.csConvert.getDiagonalOrientation(i))}*orthogonalStepList(e,i){(0,l.assertNonNullish)(this.position);for(const o of g.csConvert.orthogonalDirections()){var t,s=v.PositionHelper.orthogonalStep(this.position,o);null==s||!i&&null!=(t=e.hasPiece(s))&&t===this.color||(yield s)}}*diagonalStepList(e,i){(0,l.assertNonNullish)(this.position);for(const o of g.csConvert.diagonalDirections()){var t,s=v.PositionHelper.diagonalStep(this.position,o);null==s||!i&&null!=(t=e.hasPiece(s))&&t===this.color||(yield s)}}*attemptMoves(e,i=!1){yield*this.orthogonalStepList(e,i),yield*this.diagonalStepList(e,i),this._moved||this.checked||(yield*this.knightMoves(e))}get initialPosiition(){return"w"==this.color?v.PositionHelper.whiteKingInitPosition:v.PositionHelper.blackKingInitPosition}get isInitialPosition(){return null!=this.position&&8==this.position[0]&&("w"==this.color&&1==this.position[1]||"b"==this.color&&27==this.position[1])}}t.King=o;class n extends s{constructor(e,i,t){super(e),this.symbol="D",this.value=15,this.key=e+this.symbol,void 0!==i&&((0,l.assertCondition)(g.csTypes.isColumn(i)),(0,l.assertNonNullish)(t,"line of the column"),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)))}*moves(e){yield*this.orthogonalMoves(e),yield*this.diagonalMoves(e)}canMoveTo(e,i){return super.canMoveOrthogonallyTo(e,i)||super.canMoveDiagonallyTo(e,i)}markThreats(e){for(const i of this.orthogonalMoves(e,!0))e.setThreat(i,this.color);for(const t of this.diagonalMoves(e,!0))e.setThreat(t,this.color)}}t.Queen=n;class r extends s{constructor(e,i,t){super(e),this.symbol="V",this.value=14,this.key=e+this.symbol,void 0!==i&&((0,l.assertCondition)(g.csTypes.isColumn(i)),(0,l.assertNonNullish)(t,"line of the column"),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)))}*moves(e){yield*this.orthogonalMoves(e),yield*this.knightMoves(e)}canMoveTo(e,i){return super.canMoveOrthogonallyTo(e,i)||v.PositionHelper.positionIteratorIncludes(this.knightMoves(e),i)}markThreats(e){for(const i of this.orthogonalMoves(e,!0))e.setThreat(i,this.color);for(const t of this.knightMoves(e,!0))e.setThreat(t,this.color)}}t.Wyvern=r;class a extends s{constructor(e,i,t,s){super(e),this.symbol="R",this.value=11,void 0!==s?((0,l.assertCondition)(g.csTypes.isColumn(t)),super.setPositionTo(v.PositionHelper.fromBoardPosition(t,s,!0)),this.key=e+this.symbol+(this.isKingSide(i)?"k":this.isQueenSide(i)?"q":t+s),this._moved=!this.isKingSide(i)&&!this.isQueenSide(i)):((0,l.assertCondition)("number"==typeof t,"instance number of piece "+this.symbol),this.key=e+this.symbol+t,this._moved=!1)}setPositionTo(e){super.setPositionTo(e),this._moved=!(this.isQueenSide(!1)||this.isKingSide(!1)||this.isQueenSide(!0)||this.isKingSide(!0))}isQueenSide(e){return null!=this.position&&(e?3==this.position[0]&&("w"==this.color?4==this.position[1]:24==this.position[1]):4==this.position[0]&&("w"==this.color?3==this.position[1]:25==this.position[1]))}isKingSide(e){return null!=this.position&&(e?11==this.position[0]&&("w"==this.color?4==this.position[1]:24==this.position[1]):10==this.position[0]&&("w"==this.color?3==this.position[1]:25==this.position[1]))}*moves(e){yield*this.orthogonalMoves(e)}moveTo(e,i){super.moveTo(e,i),this._moved=!0}canMoveTo(e,i,t=!0){return super.canMoveOrthogonallyTo(e,i,t)}markThreats(e){for(const i of this.orthogonalMoves(e,!0))e.setThreat(i,this.color)}setCastlingStatus(e,i){this._moved=this.isQueenSide(i)?!e.startsWith("R"):!this.isKingSide(i)||!e.endsWith("R")}get moved(){return this._moved}}t.Rook=a;class c extends s{constructor(e,i,t){super(e),this.symbol="G",this.value=8,void 0!==t?((0,l.assertCondition)(g.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t):((0,l.assertCondition)("number"==typeof i,"instance number of piece "+this.symbol),this.key=e+this.symbol+i)}*moves(e){yield*this.diagonalMoves(e),yield*this.knightMoves(e)}canMoveTo(e,i){return super.canMoveDiagonallyTo(e,i)||v.PositionHelper.positionIteratorIncludes(this.knightMoves(e),i)}markThreats(e){for(const i of this.diagonalMoves(e,!0))e.setThreat(i,this.color);for(const t of this.knightMoves(e,!0))e.setThreat(t,this.color)}}t.Pegasus=c;class h extends s{constructor(e,i,t){super(e),this.symbol="N",this.value=4,void 0!==t?((0,l.assertCondition)(g.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t):((0,l.assertCondition)("number"==typeof i,"instance number of piece "+this.symbol),this.key=e+this.symbol+i)}*moves(e){if(yield*this.knightMoves(e),null!=this.position&&null==this.pin)for(const t of g.csConvert.knightDirections()){var i=v.PositionHelper.knightJump(this.position,t);null!=i&&null==e.hasPiece(i)&&null!=(i=v.PositionHelper.knightJump(i,t))&&null==e.hasPiece(i)&&(yield i)}}canCaptureOn(e,i){return v.PositionHelper.positionIteratorIncludes(this.knightMoves(e),i)}markThreats(e){for(const i of this.knightMoves(e,!0))e.setThreat(i,this.color)}}t.Knight=h;class p extends s{constructor(e,i,t){if(super(e),this.symbol="J",this.value=3,void 0!==t)(0,l.assertCondition)(g.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.hexesColor=v.PositionHelper.hexColor(this.position);else{if(!g.csTypes.isHexColor(i))throw new TypeError("Bishop constructor error");this.hexesColor=i}this.key=e+this.symbol+this.hexesColor}*moves(e){yield*super.diagonalMoves(e)}canMoveTo(e,i){return super.canMoveDiagonallyTo(e,i)}markThreats(e){for(const i of super.diagonalMoves(e,!0))e.setThreat(i,this.color)}}t.Bishop=p;class P extends s{constructor(e,i,t){super(e),this.symbol="E",this.value=2,(0,l.assertCondition)(g.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t}*moves(e,i=!1){var t=this.position;if(null!=t){var s,o,n,r,a,l,c=this.pin;(null==c||"ColumnUp"==c[0]&&"ColumnDown"==c[1])&&null!=(s=v.PositionHelper.orthogonalStep(t,this.ownOrthogonalDirection))&&(null==(o=e.hasPiece(s))?(yield s,null==(r=v.PositionHelper.orthogonalStep(s,this.ownOrthogonalDirection))||null!=(n=e.hasPiece(r))&&!i&&n==this.color||(yield r)):o!=this.color?(yield s,i&&(n=e.getPiece(s),u.cspty.isKing(n))&&null!=(r=v.PositionHelper.orthogonalStep(s,this.ownOrthogonalDirection))&&null==e.hasPiece(r)&&(yield r)):i&&(yield s));for(const h of["LineUp","LineInvUp","LineDown","LineInvDown"])null!=c&&!c.includes(h)||null==(a=v.PositionHelper.diagonalStep(t,h))||null!=(l=e.hasPiece(a))&&!i&&l==this.color||(yield a)}}markThreats(e){for(const i of this.moves(e,!0))e.setThreat(i,this.color)}get ownOrthogonalDirection(){return"w"===this.color?"ColumnUp":"ColumnDown"}}t.Elephant=P;class d extends s{constructor(e,i,t){super(e),this.symbol="M",this.value=2,(0,l.assertCondition)(g.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t}*moves(e,i=!1){var t=this.position;if(null!=t){var s,o,n,r,a=this.pin;if(!i)for(const l of g.csConvert.orthogonalDirections())null!=a&&!a.includes(l)||null==(s=v.PositionHelper.orthogonalStep(t,l))||null!=e.hasPiece(s)||null==(s=v.PositionHelper.orthogonalStep(s,l))||null!=e.hasPiece(s)||(yield s);for(const c of g.csConvert.diagonalDirections())null!=a&&!a.includes(c)||null==(o=v.PositionHelper.diagonalStep(t,c))||(null==(n=e.hasPiece(o))?null!=(r=e.specialPawnCapture)&&r.isEnPassantCapturable()&&r.isEnPassantCapture(o)&&(yield o):n!==this.color&&(yield o))}}canCaptureOn(e,i){return v.PositionHelper.positionIteratorIncludes(this.moves(e,!0),i)}markThreats(e){var i=this.position;if(null!=i){var t,s=this.pin;for(const o of g.csConvert.diagonalDirections())null!=s&&!s.includes(o)||null==(t=v.PositionHelper.diagonalStep(i,o))||e.setThreat(t,this.color)}}}t.Almogaver=d;class m extends s{constructor(e,i,t){super(e),this.symbol="P",this.value=1,(0,l.assertCondition)(g.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t}*moves(e,i=!1){var t=this.position;if(null!=t){var s=this.pin;if(!i){var o,n,i=this.ownOrthogonalStraightDirection;(null==s||"ColumnUp"==s[0]&&"ColumnDown"==s[1])&&null!=(o=v.PositionHelper.orthogonalStep(t,i))&&null==e.hasPiece(o)&&(yield o,null!=(o=v.PositionHelper.orthogonalStep(o,i)))&&null==e.hasPiece(o)&&(yield o,this.hasTripleStep(e.isGrand))&&null!=(o=v.PositionHelper.orthogonalStep(o,i))&&null==e.hasPiece(o)&&(yield o);for(const c of this.ownOrthogonalAlternateDirections)null!=s&&!s.includes(c)||null==(n=v.PositionHelper.orthogonalStep(t,c))||null!=e.hasPiece(n)||(yield n)}var r,a,l=e.specialPawnCapture;null!=l&&l.isScornfulCapturable()&&l.isScorned(this)&&(null==this.pin||null!=(i=v.PositionHelper.isOrthogonally(t,l.capturablePiece.position))&&this.pin.includes(i))&&(yield l.capturablePiece.position);for(const h of this.ownCaptureDirections)null!=s&&!s.includes(h)||null==(r=v.PositionHelper.diagonalStep(t,h))||(null!=(a=e.hasPiece(r))?a!=this.color&&(yield r):null!=l&&l.isEnPassantCapturable()&&l.isEnPassantCapture(r)&&(yield r))}}canCaptureOn(e,i){return v.PositionHelper.positionIteratorIncludes(this.moves(e,!0),i)}markThreats(e){var i=this.position;if(null!=i){var t,s=this.pin;for(const o of this.ownCaptureDirections)null!=s&&!s.includes(o)||null==(t=v.PositionHelper.diagonalStep(i,o))||e.setThreat(t,this.color)}}hasTripleStep(e){var i,t=this.position;return null!=t&&(3<(i=t[0])&&i<7||3==i&&!e?t[1]==("w"==this.color?i+1:27-i):7<i&&i<11||11==i&&!e?t[1]==("w"==this.color?15-i:13+i):!!e&&(2==i||12==i?t[1]==("w"==this.color?5:23):(3==i||11==i)&&t[1]==("w"==this.color?6:22)))}promoteTo(e){(0,l.assertNonNullish)(this.position,"Pawn to promote is not captured"),(0,l.assertCondition)(v.PositionHelper.isPromotionHex(this.position,this.color),"Promotion hex "+v.PositionHelper.toString(this.position)),e.setPositionTo(this.position),this.captured()}get awaitingPromotion(){return null!=this.position&&v.PositionHelper.isPromotionHex(this.position,this.color)?v.PositionHelper.lineHexColor(this.position[1]):null}get ownOrthogonalStraightDirection(){return"w"===this.color?"ColumnUp":"ColumnDown"}get ownOrthogonalAlternateDirections(){return"w"===this.color?["FileUp","FileInvUp"]:["FileDown","FileInvDown"]}get ownCaptureDirections(){return"w"==this.color?["LineUp","LineInvUp"]:["LineDown","LineInvDown"]}}var w;t.Pawn=m,(e=w=t.csPieceTypes||(t.csPieceTypes={})).isKing=function(e){return"K"==e.symbol},e.isQueen=function(e){return"D"==e.symbol},e.isWyvern=function(e){return"V"==e.symbol},e.isRook=function(e){return"R"==e.symbol},e.isPegasus=function(e){return"G"==e.symbol},e.isKnight=function(e){return"N"==e.symbol},e.isBishop=function(e){return"J"==e.symbol},e.isElephant=function(e){return"E"==e.symbol},e.isPawn=function(e){return"P"==e.symbol},e.isAlmogaver=function(e){return"M"==e.symbol},e.isMajorPiece=function(e){return["D","V","R"].includes(e.symbol)},e.isMinorPiece=function(e){return"J"==e.symbol||"N"==e.symbol},e.isMediumPiece=function(e){return"G"==e.symbol},e.isTroup=function(e){return["P","E","M"].includes(e.symbol)}},{"./cescacs":1,"./cescacs.positionHelper":4,"./cescacs.types":5,"./ts.general":6}],4:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PositionHelper=void 0;const o=e("./cescacs.types");class n{static equals(e,i){return e[0]===i[0]&&e[1]===i[1]}static toString(e){return o.csConvert.columnFromIndex(e[0])+e[1].toString()}static compactPosToString(e){return o.csConvert.getColumnFromCompact(e)+o.csConvert.getLineFromCompact(e).toString()}static positionKey(e){return e[0].toString()+"-"+e[1].toString()}static parse(e){if(e){var e=e.trim().toUpperCase(),i=e.length;if(2<=i&&i<=3){i=e[0];if(o.csTypes.isColumn(i)){var t=parseInt(e.slice(1));if(o.csTypes.isLine(t))return[o.csConvert.toColumnIndex(i),t];throw new RangeError("Invalid line value: "+t)}throw new RangeError("Invalid column: "+i)}throw new RangeError("Invalid coordinates leght: "+e)}throw new RangeError("Empty string for coordinates value")}static fromBoardPosition(e,i,t=!1){e=[e=o.csTypes.isColumn(e)?o.csConvert.toColumnIndex(e):e,i];if(t&&!n.isValidPosition(e))throw new RangeError("Invalid position: "+e);return e}static isValidPosition(e){return o.csTypes.isPosition(e)&&n.isEvenLinesColumnIndex(e[0])==(e[1]%2==0)&&n.isOnBoard(e[0],e[1])}static get whiteKingInitPosition(){return[8,1]}static get blackKingInitPosition(){return[8,27]}static initialQueenSideRookPosition(e,i){return i?"w"==e?[3,4]:[3,24]:"w"==e?[4,3]:[4,25]}static initialKingSideRookPosition(e,i){return i?"w"==e?[11,4]:[11,24]:"w"==e?[10,3]:[10,25]}static isPromotionPos(e,i,t){return i==(e<=7?"w"==t?21+e:7-e:"w"==t?35-e:e-7)}static isPromotionHex(e,i){var t=e[0];return e[1]==(t<=7?"w"==i?21+t:7-t:"w"==i?35-t:t-7)}static promotionDistance(e,i){var t=e[0];return"w"==i?(t<=7?21+t:35-t)-e[1]:e[1]-(t<=7?7-t:t-7)}static hexColor(e){return n.lineHexColor(e[1])}static lineHexColor(e){switch(e%3){case 0:return"Black";case 1:return"White";case 2:return"Color";default:throw new Error}}static isOrthogonally(e,i){i=[i[0]-e[0],i[1]-e[1]];return 0==i[0]?0!=i[1]&&i[1]%2==0?0<i[1]?"ColumnUp":"ColumnDown":null:0<i[0]?i[0]==i[1]?"FileUp":i[0]==-i[1]?"FileDown":null:i[0]==i[1]?"FileInvDown":i[0]==-i[1]?"FileInvUp":null}static isDiagonally(e,i,t=!1){i=[i[0]-e[0],i[1]-e[1]];return 0==i[1]?0==i[0]||t||i[0]%2!=0?null:0<i[0]?"TransversalLineInc":"TransversalLineDec":(e=(i[0]<<1)+i[0],0<i[0]?e==i[1]?"LineUp":e==-i[1]?"LineDown":null:e==i[1]?"LineInvDown":e==-i[1]?"LineInvUp":null)}static orthogonalStep(e,i){i=n._ORTHOGONAL_MOVES[o.csConvert.toOrthogonalDirectionIndex(i)];return n.addOffset(e,i)}static diagonalStep(e,i){i=n._DIAGONAL_MOVES[o.csConvert.toDiagonalDirectionIndex(i)];return n.addOffset(e,i)}static*orthogonalRide(e,i){var t=n._ORTHOGONAL_MOVES[o.csConvert.toOrthogonalDirectionIndex(i)];let s=n.addOffset(e,t);for(;null!=s;)yield s,s=n.addOffset(s,t)}static*diagonalRide(e,i){var t=n._DIAGONAL_MOVES[o.csConvert.toDiagonalDirectionIndex(i)];let s=n.addOffset(e,t);for(;null!=s;)yield s,s=n.addOffset(s,t)}static*orthogonalMoves(i){for(const t of n._ORTHOGONAL_MOVES){let e=this.addOffset(i,t);for(;null!=e;)yield e,e=n.addOffset(e,t)}}static*diagonalMoves(i){for(const t of n._DIAGONAL_MOVES){let e=this.addOffset(i,t);for(;null!=e;)yield e,e=n.addOffset(e,t)}}static knightJump(e,i){i=n._KNIGHT_MOVES[o.csConvert.toKnightDirectionIndex(i)];return n.addOffset(e,i)}static*knightMoves(e){for(const t of n._KNIGHT_MOVES){var i=this.addOffset(e,t);null!=i&&(yield i)}}static positionIteratorIncludes(e,i){for(const t of e)if(t[0]===i[0]&&t[1]===i[1])return!0;return!1}static*positionIteratorIntersection(e,i){for(const t of e)i.some(e=>t[0]===e[0]&&t[1]===e[1])&&(yield t)}static isOnBoard(e,i){return 0<=e&&e<=14&&(e<=7?7-e<=i&&i<=21+e:e-7<=i&&i<=35-e)}static addOffset(e,i){var t=e[0]+i[0],e=e[1]+i[1];return n.isOnBoard(t,e)?[t,e]:null}}(t.PositionHelper=n)._ORTHOGONAL_MOVES=[[0,2],[0,-2],[1,1],[1,-1],[-1,1],[-1,-1]],n._DIAGONAL_MOVES=[[2,0],[-2,0],[1,3],[1,-3],[-1,3],[-1,-3]],n._KNIGHT_MOVES=[[3,1],[3,-1],[-3,1],[-3,-1],[2,4],[1,5],[2,-4],[1,-5],[-2,4],[-1,5],[-2,-4],[-1,-5]],n.isEvenLinesColumnIndex=e=>e%2!=0},{"./cescacs.types":5}],5:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csConvert=t.csTypes=void 0;const s=e("./ts.general"),o=["P","T","A","B","C","D","E","F","G","H","I","K","L","X","Z"],n=["D","E","F","H","I"],r=["ColumnUp","ColumnDown","FileUp","FileDown","FileInvUp","FileInvDown"],a=["TransversalLineInc","TransversalLineDec","LineUp","LineDown","LineInvUp","LineInvDown"],l=["TransversalLineInc-FileUp","TransversalLineInc-FileDown","TransversalLineDec-FileInvUp","TransversalLineDec-FileInvDown","LineUp-FileUp","LineUp-ColumnUp","LineDown-FileDown","LineDown-ColumnDown","LineInvUp-FileInvUp","LineInvUp-ColumnUp","LineInvDown-FileInvDown","LineInvDown-ColumnDown"],c=[["ColumnUp","ColumnDown"],["FileUp","FileInvDown"],["FileInvUp","FileDown"]],h=[["TransversalLineInc","TransversalLineDec"],["LineUp","LineInvDown"],["LineInvUp","LineDown"]],u=["Black","White","Color"],p=["w","b"],P=["K","D","V","R","G","N","J","E","M","P"],d=["RKR","RK","KR","K","-"],g=["KRK-II","KRK-IK","KRK-IH","KRK-HIO","KRK-HIOO","KRK-HH","KRK-HG","KRK-FG","KRK-FE","KRK-EF","KRK-EE","KRD-DD","KRD-DE","KRD-HH","KRD-HG","KRD-FG","KRD-FE","KRD-EF","KRD-ED","KRR-HIH","KRR-HGG","KRR-FGG","KRR-FEE","KRR-EEF"],v=["KRK-FF","KRK-FG","KRK-HG","KRK-HI","KRD-DE","KRD-DC","KRD-ED","KRD-EE","KRD-FE","KRD-FF","KRR-FFE","KRR-FGF"];var m,w,f;(w=m=t.csTypes||(t.csTypes={})).isNumber=e=>"number"==typeof e&&!isNaN(e),w.isColumn=e=>o.includes(e),w.isColumnIndex=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=14,w.isLine=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=28,w.isPosition=e=>Array.isArray(e)&&2==e.length&&w.isColumnIndex(e[0])&&w.isLine(e[1]),w.isCompactPosition=e=>"number"==typeof e&&w.isColumnIndex(e>>5)&&w.isLine(31&e),w.isOrthogonalDirection=e=>r.includes(e),w.isDiagonalDirection=e=>a.includes(e),w.isKnightDirection=e=>l.includes(e),w.isCastlingColumn=e=>n.includes(e),w.isDirectionMoveRange=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=5,w.isDirectionFullMoveRange=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=11,w.isOrthogonalOrientation=i=>Array.isArray(i)&&c.some(e=>e[0]==i[0]&&e[1]==i[1]),w.isDiagonalOrientation=i=>Array.isArray(i)&&h.some(e=>e[0]==i[0]&&e[1]==i[1]),w.isHexColor=e=>u.includes(e),w.isPieceName=e=>P.includes(e),w.isTurn=e=>p.includes(e),w.isSide=e=>"K"===e||"D"===e,w.isCastlingStatus=e=>d.includes(e),w.isCastlingString=e=>g.includes(e),w.isGrandCastlingString=e=>v.includes(e),w.isSingleCheck=e=>Object.prototype.hasOwnProperty.call(e,"d")&&Object.prototype.hasOwnProperty.call(e,"p"),w.isDoubleCheck=e=>Array.isArray(e)&&3==length&&w.isPosition(e[0])&&w.isPosition(e[1])&&(null==e[2]||w.isOrthogonalOrientation(e[2])||w.isDiagonalOrientation(e[2])),w.hasDoubleCheckPin=e=>Array.isArray(e)&&3==length&&w.isPosition(e[0])&&w.isPosition(e[1])&&null!=e[2]&&(w.isOrthogonalOrientation(e[2])||w.isDiagonalOrientation(e[2])),w.isCheckAttackPos=(e,i)=>w.isPosition(e)?i[0]==e[0]&&i[1]==e[1]:w.isSingleCheck(e)?e.p[0]==i[0]&&e.p[1]==i[1]:e[0][0]==i[0]&&e[0][1]==i[1]||e[1][0]==i[0]&&e[1][1]==i[1],(f=t.csConvert||(t.csConvert={})).columnFromIndex=e=>o[e],f.toColumnIndex=e=>o.indexOf(e),f.toCompactPosition=(e,i)=>e<<5+i,f.toCompactFromPosition=e=>f.toCompactPosition(e[0],e[1]),f.toPositionFromCompact=e=>[e>>5,31&e],f.getColumnFromCompact=e=>o[e>>5],f.getColumnIndexFromCompact=e=>e>>5,f.getLineFromCompact=e=>31&e,f.toOrthogonalDirectionIndex=e=>r.indexOf(e),f.orthogonalDirectionFromIndex=e=>r[e],f.toDiagonalDirectionIndex=e=>a.indexOf(e),f.diagonalDirectionFromIndex=e=>a[e],f.toKnightDirectionIndex=e=>l.indexOf(e),f.knightDirectionFromIndex=e=>l[e],f.getOrthogonalOrientation=function(e){switch(e){case"ColumnUp":case"ColumnDown":return["ColumnUp","ColumnDown"];case"FileUp":case"FileInvDown":return["FileUp","FileInvDown"];case"FileInvUp":case"FileDown":return["FileInvUp","FileDown"];default:throw new Error(e)}},f.getDiagonalOrientation=function(e){switch(e){case"TransversalLineInc":case"TransversalLineDec":return["TransversalLineInc","TransversalLineDec"];case"LineUp":case"LineInvDown":return["LineUp","LineInvDown"];case"LineInvUp":case"LineDown":return["LineInvUp","LineDown"];default:throw new Error(e)}},f.otherSide=function(e){return"w"==e?"b":"w"},f.getPieceKeyColor=function(e){return(0,s.assertCondition)(m.isTurn(e[0]),"key 1st char must have piece color"),e[0]},f.getPieceKeyName=function(e){return(0,s.assertCondition)(m.isPieceName(e[1]),"key 2nd char must be piece symbol "+e),e[1]},f.getBishopKeyHexColor=function(e){return"J"!==e[1]?null:e.slice(2)},f.getRookKeySide=function(e){return"R"===e[1]&&m.isSide(e[2])?e[2]:null},f.orthogonalDirections=function*(){for(const e of r)yield e},f.diagonalDirections=function*(){for(const e of a)yield e},f.knightDirections=function*(){for(const e of l)yield e}},{"./ts.general":6}],6:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timeout=t.round2hundredths=t.isNotNullNorWhitespace=t.isNotNullNorEmpty=t.assertCondition=t.assertNonNullish=void 0,t.assertNonNullish=function(e,i){if(null==e)throw console.log("NonNullish assertion fail: "+i??"-"),new TypeError(`Unexpected ${e} value`+(null==i)?"":": "+i)},t.assertCondition=function(e,i){if(!e)throw console.log("Condition assertion fail: "+i??"-"),new Error("")},t.isNotNullNorEmpty=function(e){return null!=e&&0<e.length},t.isNotNullNorWhitespace=function(e){return null!=e&&0<e.length&&0<e.trim().length},t.round2hundredths=function(e){return Math.round(100*(e+Number.EPSILON))/100};t.Timeout=class{constructor(){this.set=(s,o)=>new Promise((e,i)=>{const t=setTimeout(()=>{void 0===o?e():i(o),this.clear(t)},s);this.ids.push(t)}),this.wrap=(e,i,t)=>Promise.race([e,this.set(i,t)]),this.clearAll=()=>{this.clear(...this.ids)},this.clear=(...i)=>{this.ids=this.ids.filter(e=>!i.includes(e)||(clearTimeout(e),!1))},this.ids=[]}}},{}]},{},[1])(1)});