!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).cescacs=e()}(function(){return function s(o,n,r){function a(i,e){if(!n[i]){if(!o[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(l)return l(i,!0);throw(e=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",e}t=n[i]={exports:{}},o[i][0].call(t.exports,function(e){return a(o[i][1][e]||e)},t,t.exports,s,o,n,r)}return n[i].exports}for(var l="function"==typeof require&&require,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.Board=t.EnPassantCapturable=t.ScornfulCapturable=t.PawnSpecialCaptureStatus=t.round2hundredths=t.csmv=t.cspty=t.PositionHelper=void 0;const C=e("./ts.general"),J=(Object.defineProperty(t,"round2hundredths",{enumerable:!0,get:function(){return C.round2hundredths}}),e("./cescacs.types")),V=e("./cescacs.piece"),q=(Object.defineProperty(t,"cspty",{enumerable:!0,get:function(){return V.csPieceTypes}}),e("./cescacs.positionHelper")),y=(Object.defineProperty(t,"PositionHelper",{enumerable:!0,get:function(){return q.PositionHelper}}),e("./cescacs.piece")),o=e("./cescacs.moves");Object.defineProperty(t,"csmv",{enumerable:!0,get:function(){return o.csMoves}});class n{constructor(e){this._capturablePiece=e}static parse(e,i){if(null!=i&&0<i.length&&"-"!=i){if(4<=i.length){const n=i.split("@");n.length=2;var t=q.PositionHelper.parse(n[0]);if(n[1].includes(",")||!isNaN(Number(n[1]))){i=e.getPiece(t);if(null==i)throw new Error(q.PositionHelper.toString(t)+" doesn't have a pawn");var s=n[1].split(",");if(1<=s.length&&s.length<=2){let e=[];for(const r of s){var o=Number(r);if(isNaN(o)||!J.csTypes.isLine(o))throw new TypeError("Invalid en passant capture line value");e.push(q.PositionHelper.fromBoardPosition(t[0],o,!0))}return new h(i,e)}throw new TypeError("Missing or invalid en passant capture lines")}s=q.PositionHelper.parse(n[1]),i=e.getPiece(s);if(null!=i)return new c(i,t);throw new Error(q.PositionHelper.toString(s)+" doesn't have a pawn")}throw new TypeError("Too short special pawn capture status string")}return null}isScornfulCapturable(){return"scornful"==this.specialCaptureType}isEnPassantCapturable(){return"enPassant"==this.specialCaptureType}get capturablePiece(){return this._capturablePiece}get capturablePawn(){return(0,C.assertCondition)(V.csPieceTypes.isPawn(this._capturablePiece)),this._capturablePiece}}class c extends(t.PawnSpecialCaptureStatus=n){constructor(e,i){super(e),this.specialCaptureType="scornful",this._capturerPawnPos=i}static promoteCapturablePawn(e,i){return new c(i,e._capturerPawnPos)}isScorned(e,i){e=null!=e.position&&q.PositionHelper.equals(e.position,this._capturerPawnPos);return null==i?e:e&&q.PositionHelper.equals(i,this.capturablePiece.position)}get scornfulCaptureDirection(){var e=this._capturerPawnPos[0],i=this.capturablePiece.position,t=i[0];return i[1]>this._capturerPawnPos[1]?e<t?"FileUp":"FileInvUp":e<t?"FileDown":"FileInvDown"}toString(){return q.PositionHelper.toString(this._capturerPawnPos)+"@"+q.PositionHelper.toString(this.capturablePiece.position)}}t.ScornfulCapturable=c;class h extends n{constructor(e,i){super(e),this.specialCaptureType="enPassant",this._captureTo=i}static promoteCapturablePawn(e,i){return new h(i,e._captureTo)}isEnPassantCapture(i,e){var t=this._captureTo.some(e=>q.PositionHelper.equals(e,i));return null==e?t:!(!t||null==e.position)&&(t=e.position,V.csPieceTypes.isPawn(e)?1==Math.abs(i[0]-t[0])&&("w"==e.color?i[1]-t[1]==3:t[1]-i[1]==3):null!=q.PositionHelper.isDiagonally(i,t))}toString(){return q.PositionHelper.toString(this.capturablePiece.position)+"@"+this.captureLines()}captureLines(){const i=this._captureTo;if(0<i.length&&i.length<=2){let e=i[0][1].toString();return 1<i.length&&(e+=","+i[1][1].toString()),e}throw new Error("Invalid en passant capture positions set")}}t.EnPassantCapturable=h;class u{constructor(e,i){this.isGrand=e,this.wPositions=[0,0,0,0,0,0,0,0],this.bPositions=[0,0,0,0,0,0,0,0],this.wThreats=[0,0,0,0,0,0,0,0],this.bThreats=[0,0,0,0,0,0,0,0],this.pieces=new Map,this.wPieces=new Map,this.bPieces=new Map,this._regainablePieces=[],this.wKing=new y.King("w"),this.bKing=new y.King("b"),this._specialPawnCapture=null,this._currentHeuristic=u.newHeuristic(),this._wAwaitingPromotion=!1,this._bAwaitingPromotion=!1,this._turn=i??"w",this.pieces.set(this.wKing.key,this.wKing),this.pieces.set(this.bKing.key,this.bKing)}static newHeuristic(){return{pieces:[0,0],space:[0,0],positioning:0,mobility:0,king:0}}static splitCastlingStatus(s){if(null!=s&&0<s.length){let e,i,t=0;for(;t<s.length&&s[t].toUpperCase()==s[t];)t++;if(i=(i=0==t?(e="-",s):t==s.length?(e=s,"-"):(e=s.slice(0,t),s.slice(t))).toUpperCase(),J.csTypes.isCastlingStatus(e)&&J.csTypes.isCastlingStatus(i))return[e,i];throw new TypeError("Invalid TLPD issued castling status "+s)}return["RKR","RKR"]}static lineMask(e){return 1<<e}get turn(){return this._turn}get turnKing(){return"w"===this.turn?this.wKing:this.bKing}get checked(){return this.turnKing.checked}get isKnightOrCloseCheck(){return this.turnKing.isKnightOrCloseCheck()}get isSingleCheck(){return this.turnKing.isSingleCheck()}get isDoubleCheck(){return this.turnKing.isDoubleCheck()}pieceByKey(e){e=this.pieces.get(e);return(0,C.assertNonNullish)(e,"piece from unique key"),e}get specialPawnCapture(){return this._specialPawnCapture}set specialPawnCapture(e){this._specialPawnCapture=e}get isAwaitingPromotion(){return"w"==this._turn?this._wAwaitingPromotion:this._bAwaitingPromotion}setAwaitingPromotion(e){"w"==e?this._wAwaitingPromotion=!0:this._bAwaitingPromotion=!0}computeAwaitingPromotion(e){let i=!1;for(const t of("w"==e?this.wPieces:this.bPieces).values())if(V.csPieceTypes.isPawn(t)&&t.awaitingPromotion){i=!0;break}"w"==e?this._wAwaitingPromotion=i:this._bAwaitingPromotion=i}get currentHeuristic(){return this._currentHeuristic}getHeuristicValue(e){return(0,C.round2hundredths)(e.pieces[0]-e.pieces[1]+e.space[0]-e.space[1]+e.positioning+e.mobility+e.king)}createPiece(e,i,t,s){let o;switch(e){case"K":throw new Error("King must be created before setting it on the board");case"D":o=new y.Queen(i,t,s);break;case"V":o=new y.Wyvern(i,t,s);break;case"R":o=new y.Rook(i,this.isGrand,t,s);break;case"G":o=new y.Pegasus(i,t,s);break;case"N":o=new y.Knight(i,t,s);break;case"J":o=new y.Bishop(i,t,s);break;case"E":o=new y.Elephant(i,t,s);break;case"M":o=new y.Almogaver(i,t,s);break;case"P":o=new y.Pawn(i,t,s);break;default:throw new Error(e)}if(null!=this.hasPiece(o.position))throw new Error(`You cannot put a ${i} ${o.symbol} there`+", because the hex is already in use; There may be a repeated line in the TLPD");return this.pieces.set(o.key,o),this.addPiece(o),o}addPiece(e){(0,C.assertNonNullish)(e.position,e.symbol+" position");var i=e.position;const t="w"==e.color?this.wPieces:this.bPieces;t.set(q.PositionHelper.positionKey(i),e);var s=i[0]+1>>>1,i=u.lineMask(i[1]);const o="w"==e.color?this.wPositions:this.bPositions;o[s]|=i}hasPiece(e){var i=e[0]+1>>>1,e=u.lineMask(e[1]);return 0!=(this.wPositions[i]&e)?"w":0!=(this.bPositions[i]&e)?"b":null}getPiece(e){var i=this.hasPiece(e);return null==i?null:("w"==i?this.wPieces:this.bPieces).get(q.PositionHelper.positionKey(e))}hasThreat(e,i){var t=e[0]+1>>>1;return 0!=(("w"==i?this.wThreats:this.bThreats)[t]&u.lineMask(e[1]))}isThreatened(e,i){var t=e[0]+1>>>1;return 0!=(("w"==i?this.bThreats:this.wThreats)[t]&u.lineMask(e[1]))}setThreat(e,i){var t=e[0]+1>>>1;("w"==i?this.wThreats:this.bThreats)[t]|=u.lineMask(e[1])}addRegainablePiece(e){null==e.position&&(this._regainablePieces.push(e),this.pieces.set(e.key,e))}hasRegainablePieces(t){const s=this._turn;return this._regainablePieces.reduce((e,i)=>e||i.color==s&&(!V.csPieceTypes.isBishop(i)||i.hexesColor==t),!1)}hasAwaitingRegainablePieces(){const t=this._turn;if(this._regainablePieces.reduce((e,i)=>e||i.color==t&&"J"!=i.symbol,!1))return!0;{const e=this._regainablePieces.filter(e=>e.color==t&&"J"==e.symbol);if(0==e.length)return!1;{const i="w"==this._turn?this.wPieces:this.bPieces;for(const s of i.values())if(V.csPieceTypes.isPawn(s)){const o=s.awaitingPromotion;if(null!=o&&e.some(e=>e.hexesColor==o))return!0}return!1}}}findRegeinablePiece(i,t,s){var e=this._regainablePieces.find(e=>e.color==i&&e.symbol==t&&(!V.csPieceTypes.isBishop(e)||e.hexesColor==s));return(0,C.assertNonNullish)(e,"retrieve the promoted piece"),e}currentRegainablePieceNames(t){const s=this._turn;return this._regainablePieces.reduce((e,i)=>i.color!=s||V.csPieceTypes.isBishop(i)&&i.hexesColor!=t?e:e.add(i.symbol),new Set)}maxRegainablePiecesValue(t){const s=this._turn;return this._regainablePieces.reduce((e,i)=>i.value>e&&i.color==s&&(!V.csPieceTypes.isBishop(i)||i.hexesColor==t)?i.value:e,0)}*whitePieces(){for(const e of this.wPieces.values())yield e}*blackPieces(){for(const e of this.bPieces.values())yield e}*whitePiecePositions(){for(const e of this.wPieces.values())yield e.position}*blackPiecePositions(){for(const e of this.bPieces.values())yield e.position}*pieceMoves(e){const i=this.turnKing;var t;!i.checked||"K"==e.symbol?yield*e.moves(this):(null!=(t=i.checkThreat)&&e.canCaptureOn(this,t)&&(yield t),i.isSingleCheck()&&(yield*e.blockThreat(this,i.getSingleCheckBlockingPositions(this))))}movePiece(t,s,o){(0,C.assertNonNullish)(t.position,t.symbol+" position");var e=t.position,i=e[0]+1>>>1,n=u.lineMask(e[1]);const r="w"==t.color?this.wPieces:this.bPieces;if(V.csPieceTypes.isPawn(t)){let e=null,i=null;t.position[0]!=s?null!=(a=this.getPiece([t.position[0],o>t.position[1]?t.position[1]+2:t.position[1]-2]))&&V.csPieceTypes.isPawn(a)&&(e=a):2<Math.abs(o-t.position[1])&&(i=[],o>t.position[1]?(i.push([s,t.position[1]+2]),o>t.position[1]+4&&i.push([s,t.position[1]+4])):(i.push([s,t.position[1]-2]),o<t.position[1]-4&&i.push([s,t.position[1]-4]))),null!=e?this._specialPawnCapture=new c(t,e.position):null!=i?this._specialPawnCapture=new h(t,i):this._specialPawnCapture=null,q.PositionHelper.isPromotionPos(s,o,t.color)&&("w"==t.color?this._wAwaitingPromotion=!0:this._bAwaitingPromotion=!0)}else this._specialPawnCapture=null;r.delete(q.PositionHelper.positionKey(e)),t.moveTo(s,o),r.set(q.PositionHelper.positionKey(e),t);var a=e[0]+1>>>1,s=u.lineMask(e[1]);const l="w"==t.color?this.wPositions:this.bPositions;l[i]&=~n,l[a]|=s}undoPieceMove(e,i,t){const s="w"==e.color?this.wPieces:this.bPieces;var o=e.position,n=o[0]+1>>>1,r=u.lineMask(o[1]),i=(s.delete(q.PositionHelper.positionKey(o)),e.moveTo(i,t),s.set(q.PositionHelper.positionKey(o),e),o[0]+1>>>1),t=u.lineMask(o[1]);const a="w"==e.color?this.wPositions:this.bPositions;a[n]&=~r,a[i]|=t}capturePiece(e){(0,C.assertNonNullish)(e.position,e.symbol+" position");var i=e.position,t=i[0]+1>>>1,s=u.lineMask(i[1]);const o="w"==e.color?this.wPositions:this.bPositions,n=(o[t]&=~s,"w"==e.color?this.wPieces:this.bPieces);n.delete(q.PositionHelper.positionKey(i)),e.captured(),e.isRegainable&&this._regainablePieces.push(e)}undoCapturePiece(e,i,t){var s;y.Piece.isRegainablePiece(e.symbol)&&(s=this._regainablePieces.indexOf(e),(0,C.assertCondition)(0<=s,"Captured piece found in the regainable pieces bag"),this._regainablePieces.splice(s,1)),e.setPositionTo([i,t]),this.addPiece(e)}promotePawn(e,i){if(this._regainablePieces.includes(i)){const t="w"==i.color?this.wPieces:this.bPieces;t.delete(q.PositionHelper.positionKey(e.position)),e.promoteTo(i),t.set(q.PositionHelper.positionKey(i.position),i),null!=this._specialPawnCapture&&this._specialPawnCapture.capturablePawn==e&&(this._specialPawnCapture.isScornfulCapturable()?this._specialPawnCapture=c.promoteCapturablePawn(this._specialPawnCapture,i):this._specialPawnCapture.isEnPassantCapturable()&&(this._specialPawnCapture=h.promoteCapturablePawn(this._specialPawnCapture,i)));e=this._regainablePieces.indexOf(i);this._regainablePieces.splice(e,1),"w"==i.color?this._wAwaitingPromotion=!1:this._bAwaitingPromotion=!1}}undoPromotePawn(e,i){const t="w"==i.color?this.wPieces:this.bPieces;t.delete(q.PositionHelper.positionKey(i.position)),e.setPositionTo([i.position[0],i.position[1]]),i.captured(),this._regainablePieces.push(i),t.set(q.PositionHelper.positionKey(e.position),e)}nextTurn(){this._turn="w"===this._turn?"b":"w"}prepareTurn(e){var i=e.color;{const t="w"==i?this.bThreats:this.wThreats;for(let e=0;e<=7;e++)t[e]=0}for(const s of("w"==i?this.bPieces:this.wPieces).values())s.markThreats(this);for(const o of("w"==i?this.wPieces:this.bPieces).values())o.pin=null;e.computeCheckAndPins(this)}prepareCurrentTurn(){this.prepareTurn(this.turnKing)}isMoveableTurn(){for(const e of("w"===this.turn?this.wPieces:this.bPieces).values()){const i=this.pieceMoves(e);if(!i.next().done)return!0}return!1}prepareGame(){"w"==this._turn?this.prepareTurn(this.bKing):this.prepareTurn(this.wKing),this.prepareCurrentTurn()}resetGame(e){for(let e=0;e<8;e++)this.wPositions[e]=0,this.bPositions[e]=0,this.wThreats[e]=0,this.bThreats[e]=0;this.pieces.clear(),this.wPieces.clear(),this.bPieces.clear(),null!=this.wKing.position&&this.wKing.captured(),null!=this.bKing.position&&this.bKing.captured(),this._regainablePieces.length=0,this._specialPawnCapture=null,this._turn=e,this.pieces.set(this.wKing.key,this.wKing),this.pieces.set(this.bKing.key,this.bKing)}computeHeuristic(g,d,e,v){function m(e){let i=0;for(;0<e;)i+=1&e,e>>>=1;return i}function w(e){let i=0;for(e>>>=1;0<e;)i+=1&e,e>>>=2;return i}const f=this.turnKing;if(v.pieces[0]=0,v.pieces[1]=0,v.positioning=0,v.mobility=0,e){var C=g;f.checked?f.isDoubleCheck()?v.king=-15:f.isKnightOrCloseCheck()?v.king=-12:v.king=-10:f.moved?v.king=0:v.king=.1;for(const F of f.attemptMoves(this,!0)){var y=this.hasPiece(F);f.checked?this.isThreatened(F,C)?v.king-=2:null==y?v.king+=.5:y==C&&(v.king-=.5):this.isThreatened(F,C)?v.king-=this.hasThreat(F,C)?.25:.5:null==y?v.king-=.01:y==C&&(v.king+=.05)}const E="w"==g?this.wPieces:this.bPieces,x="w"==g?this.bPieces:this.wPieces;var b="w"==g?this.wThreats:this.bThreats,k="w"==g?this.bThreats:this.wThreats,T="w"==g?31:31<<24,K="w"==g?31<<24:31,_="w"==g?this.bPositions:this.wPositions;let s=0,o=0,i=0,t=0,e=0,n=0,r=0,a=0,l=0;{const L="w"==C?this.wThreats:this.bThreats;for(let e=0;e<=7;e++)L[e]=0;for(const A of E.values())A.markThreats(this)}let c=0,h=0,u=0,p=0,P=0;var D,S=(e,i)=>"w"==i?8<e[1]:e[1]<20,H=(e,i)=>"w"==i?e[1]>(7==e[0]?6:3):e[1]<(7==e[0]?22:25);for(const G of E.values())if(null!=G.position){var I=this.hasThreat(G.position,C);if(v.pieces[0]+=G.value,"J"===G.symbol&&e++,this.isThreatened(G.position,C)?a-=I?.75*G.value:G.value:I&&(a+=1-.0625*G.value),null==G.pin){for(const U of this.pieceMoves(G))v.mobility+=.01;if(G.hasOrthogonalAttack){for(var[M,R]of function*(t,e,s){for(const r of J.csConvert.orthogonalDirections()){const a=q.PositionHelper.orthogonalRide(e,r);let i=a.next();for(;0==i.done;){var o=t.getPiece(i.value);if(null==o)i=a.next();else{const l=q.PositionHelper.orthogonalRide(i.value,r);let e=l.next();for(;0==e.done;){var n=t.getPiece(e.value);e=null==n?a.next():(n.color!=s&&(yield[o,n]),l.return())}i=a.return()}}}}(this,G.position,C))M.color==C?M.value<=G.value&&G.value<R.value&&(M.hasOrthogonalAttack?a+=.25*(R.value-M.value):!I&&R.hasOrthogonalAttack||(a+=.0625*R.value)):M.value>G.value?a+=.25*(M.value-G.value):M.value<R.value&&!M.hasOrthogonalAttack&&R.value>G.value&&(a+=.25*M.value);H(G.position,C)&&(p+=G.value)}if(G.hasDiagonalAttack){for(var[N,O]of function*(t,e,s){for(const r of J.csConvert.diagonalDirections()){const a=q.PositionHelper.diagonalRide(e,r);let i=a.next();for(;0==i.done;){var o=t.getPiece(i.value);if(null==o)i=a.next();else{const l=q.PositionHelper.diagonalRide(i.value,r);let e=l.next();for(;0==e.done;){var n=t.getPiece(e.value);e=null==n?a.next():(n.color!=s&&(yield[o,n]),l.return())}i=a.return()}}}}(this,G.position,C))N.color==C?N.value<=G.value&&G.value<O.value&&(N.hasDiagonalAttack?a+=.25*(O.value-N.value):!I&&O.hasDiagonalAttack||(a+=.0625*O.value)):N.value>G.value?a+=.25*(N.value-G.value):N.value<O.value&&!N.hasDiagonalAttack&&O.value>G.value&&(a+=.25*N.value);H(G.position,C)&&(p+=G.value)}else V.csPieceTypes.isElephant(G)||V.csPieceTypes.isAlmogaver(G)?(h+=G.value,S(G.position,C)&&(u+=G.value)):V.csPieceTypes.isPawn(G)&&(h+=G.value,G.hasTripleStep(this.isGrand)?v.mobility+=.01:S(G.position,C)&&(u++,I&&(u++,q.PositionHelper.promotionDistance(G.position,C)<14&&(P+=14-q.PositionHelper.promotionDistance(G.position,C)<<1))))}else l-=G.value,v.king-=I?.2:.4}d<=12&&h-u>>1>u&&(c=u-p);for(const B of x.values())null!=B.position&&(v.pieces[1]+=B.value,"J"===B.symbol&&n++,this.hasThreat(B.position,C)&&(a+=B.value),null!=B.pin&&(l+=B.value));for(let t=0;t<=7;t++){let e=_[t]&b[t]&~k[t],i=0;for(;0!=e;)1==(1&e)&&(D=(t<<1)-(i+1)%2,D=this.getPiece([D,i]),r+=D.value),e>>>=1,i++;s+=m(b[t]),o+=m(k[t])}i+=w(b[2]&~k[2]&T),t+=w(k[2]&~b[2]&K);for(let e=3;e<=5;e++)i+=m(b[e]&~k[e]&T),t+=m(k[e]&~b[e]&K);2<=e&&(v.pieces[0]+=3==e?1:.5),2<=n&&(v.pieces[1]+=3==n?1:.5),v.space[0]=.01*s,v.space[1]=.01*o,v.positioning=.01*(i-t+a+l+c+P)+.125*r}else f.checked?v.king=-120:v.king=-6,v.space[0]=0,v.space[0]=0;return v}}class b extends(t.Board=u){constructor(e=!1,i){var t=i?.split(" ");if(super(e,null==t?.[1]||"w"!=t[1]&&"b"!=t[1]?"w":t[1]),this._moves=[],this._top=-1,this.fixedNumbering=!0,this._mate=!1,this._stalemate=!1,this._draw=!1,this._resigned=!1,this._enpassantCaptureCoordString=null,void 0===i)this.fillDefaultPositions(),this.halfmoveClock=0,this.moveNumber=1,this.fixedNumbering=!0;else{if(!(null!=t&&2<=t.length&&J.csTypes.isTurn(t[1])))throw new Error("Piece positions and turn are mandatory parts of the TLPD string");var[e,i]=u.splitCastlingStatus(t[2]);if(this.restoreTLPDPositions(t[0],e,i),this.halfmoveClock=J.csTypes.isNumber(Number(t[4]))?Number(t[4]):0,isNaN(Number(t[4]))&&null!=t[4]&&"-"!==t[4])throw new TypeError("Invalid halfmove clock value");if(this.moveNumber=J.csTypes.isNumber(Number(t[5]))?Number(t[5]):1,isNaN(Number(t[5]))){if(null!=t[5]&&"-"!=t[5])throw new TypeError("Invalid move number");this.fixedNumbering=!1}else this.fixedNumbering=!0;super.specialPawnCapture=n.parse(this,t[3])}this.initGame()}static kingCastlingPosition(e,i){var t="w"==e?q.PositionHelper.whiteKingInitPosition:q.PositionHelper.blackKingInitPosition,e=("w"==e?b.whiteKingCastlingMove:b.blackKingCastlingMove)[i];return q.PositionHelper.knightJump(t,e)}static convertPieceAliases(e){switch(e){case"Q":return"D";case"W":return"V";case"T":return"R";case"C":case"S":return"N";case"A":case"B":case"F":case"L":return"J";default:if(J.csTypes.isPieceName(e))return e;throw new TypeError("Invalid piece symbol "+e)}}static rookCastleMove(e,i,t,s,o){return"K"==s?"K"==i?o?"w"==t?"ColumnUp":"ColumnDown":"w"==t?"FileUp":"FileDown":"I"==i?o?"w"==t?"FileInvDown":"FileInvUp":"w"==t?"ColumnUp":"ColumnDown":"w"==t?"FileInvUp":"FileInvDown":"E"==i&&"D"==e?"w"==t?"FileDown":"FileUp":"w"==t?"FileUp":"FileDown"}get gameEnd(){return this._mate||this._stalemate||this._draw||this._resigned}get mate(){return this._mate}get stalemate(){return this._stalemate}set draw(e){this._draw=e}get draw(){return this._draw}set resign(e){this._resigned=e}get resigned(){return this._resigned}getHexPiece(e){e=q.PositionHelper.parse(e);return null!=e&&q.PositionHelper.isValidPosition(e)?this.getPiece(e):null}get lastMove(){return 0<=this._top?o.csMoves.fullMoveNotation(this._moves[this._top],!1):null}get resultString(){if(this.gameEnd){if(this._mate||this._resigned)return"w"==this.turn?"0 - 3":"3 - 0";if(this._stalemate)return"w"==this.turn?"1 - 2":"2 - 1";if(this._draw)return"1 - 1";throw new Error("End game exhaustiveCheck fail")}return null}set resultString(e){if(null!=e&&0<e.length)if(this.gameEnd){if(e!=this.resultString)throw new Error(`Incorrect end game value issued: ${e} correct value `+this.resultString)}else switch(e){case"0 - 3":if("w"!=this.turn)throw new Error("Incorrect resign turn: "+e);this.resign=!0;break;case"3 - 0":if("b"!=this.turn)throw new Error("Incorrect resign turn: "+e);this.resign=!0;break;case"1 - 1":this.draw=!0;break;case"null":break;default:throw new Error("Incorrect end game value issued: "+e)}}get enPassantCaptureCoordString(){return this._enpassantCaptureCoordString}get preMoveHeuristic(){return this.currentHeuristic}doMove(e,i,t){try{(0,C.assertCondition)(this._top==this._moves.length-1,"push the moves over the last one");var s=q.PositionHelper.parse(e);const a=q.PositionHelper.parse(i),l=this.getPiece(s),c=((0,C.assertCondition)(null!=l,`piece on ${e} position`),(0,C.assertCondition)(null==t||l.symbol==t,t+" is the piece on "+s),(0,C.assertCondition)(l.canMoveTo(this,a),`Piece ${l.symbol} at ${l.position?.toString()} move to `+a.toString()),{piece:l.key,pos:s,moveTo:a});var o,n,r=this.getPiece(a);null!=r?((0,C.assertCondition)(l.color!=r.color&&l.canCaptureOn(this,a),`Piece ${l.symbol} at ${l.position?.toString()} capture on `+a.toString()),o=V.csPieceTypes.isPawn(l)&&null!=this.specialPawnCapture&&this.specialPawnCapture.isScornfulCapturable()&&this.specialPawnCapture.isScorned(l,a),c.captured=r.key,c.special=o?a:void 0,this._enpassantCaptureCoordString=null):null!=this.specialPawnCapture&&(V.csPieceTypes.isPawn(l)||V.csPieceTypes.isAlmogaver(l))&&this.specialPawnCapture.isEnPassantCapturable()&&this.specialPawnCapture.isEnPassantCapture(a,l)?(n=this.specialPawnCapture.capturablePiece,c.captured=n.key,c.special=[n.position[0],n.position[1]],this._enpassantCaptureCoordString=q.PositionHelper.toString(c.special)):this._enpassantCaptureCoordString=null,this.pushMove(c)}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="DoMove"),e}}doPromotePawn(e,i,t){try{(0,C.assertCondition)(this._top==this._moves.length-1,"push the moves over the last one");var s=q.PositionHelper.parse(e);const l=q.PositionHelper.parse(i),c=this.getPiece(s);(0,C.assertCondition)(null!=c&&V.csPieceTypes.isPawn(c),`pawn on ${e} position`),(0,C.assertCondition)(q.PositionHelper.isPromotionHex(l,c.color),"Promotion hex");var o,n,r,a=q.PositionHelper.hexColor(l);const h=super.findRegeinablePiece(c.color,t,a),u={piece:c.key,prPos:l,promoted:h};q.PositionHelper.equals(s,l)||(u.pos=s,u.moveTo=l,null!=(o=this.getPiece(l))?((0,C.assertCondition)(c.color!=o.color&&c.canCaptureOn(this,l),`Pawn at ${h.position?.toString()} capture on `+l.toString()),n=V.csPieceTypes.isPawn(h)&&null!=this.specialPawnCapture&&this.specialPawnCapture.isScornfulCapturable()&&this.specialPawnCapture.isScorned(h,l),u.captured=o.key,u.special=n?l:void 0,this._enpassantCaptureCoordString=null):null!=this.specialPawnCapture&&this.specialPawnCapture.isEnPassantCapturable()&&this.specialPawnCapture.isEnPassantCapture(l,c)?(r=this.specialPawnCapture.capturablePiece,u.captured=r.key,u.special=[r.position[0],r.position[1]],this._enpassantCaptureCoordString=q.PositionHelper.toString(u.special)):this._enpassantCaptureCoordString=null),this.pushMove(u)}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="DoPromotePawn"),e}}doCastling(e){try{this.isGrand?(0,C.assertCondition)(J.csTypes.isGrandCastlingString(e),"castling move string"):(0,C.assertCondition)(J.csTypes.isCastlingString(e),"castling move string");var i=super.turnKing,t=this.turn,s=e.split("-"),o="R"==s[0][2]?"K":s[0][2],n=s[1][0],r=s[1][1],a=3==s[1].length&&"O"!=s[1][2]?s[1][2]:void 0,l=!(3<s[1].length)&&(3==s[1].length&&"O"==s[1][2]||void 0),c=b.kingCastlingPosition(i.color,n),h=((0,C.assertCondition)("K"==o||"D"==o,o+" must be King (K) side or Queen (D) side"),this.castlingRookPosition(n,r,o,l));const p=this.getPiece("K"==o?q.PositionHelper.initialKingSideRookPosition(t,this.isGrand):q.PositionHelper.initialQueenSideRookPosition(t,this.isGrand)),P=((0,C.assertCondition)(!i.moved,"King hasn't been moved"),(0,C.assertNonNullish)(c,"king destination hex"),(0,C.assertCondition)(null==this.hasPiece(c),"empty king destination hex"),(0,C.assertCondition)(!this.isThreatened(c,i.color),"Not threated king destination hex"),(0,C.assertNonNullish)(p,"castling rook piece"),(0,C.assertCondition)(V.csPieceTypes.isRook(p),"castling rook"),(0,C.assertCondition)(!p.moved,"castling rook's not been moved"),(0,C.assertCondition)(p.canMoveTo(this,h,!1),"castling rook movement"),{side:s[0][2],col:n,rPos:h,kRook:"K"==o?p.key:void 0,qRook:"D"==o?p.key:void 0});if(void 0!==a){var u=this.castlingRookPosition(n,a,"D",l);const g=this.getPiece(q.PositionHelper.initialQueenSideRookPosition(t,this.isGrand));(0,C.assertNonNullish)(g,"double castling queen side rook"),(0,C.assertCondition)(V.csPieceTypes.isRook(g),"castling queen rook"),(0,C.assertCondition)(!g.moved,"castling queen rook's not been moved"),(0,C.assertCondition)(g.canMoveTo(this,u,!1),"castling queen rook movement"),P.r2Pos=u,P.qRook=g.key}this._enpassantCaptureCoordString=null,this.pushMove(P)}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="doCastling"),e}}popMove(){if(1<this._moves.length||0==this._top&&"…"!=this._moves[0].move){(0,C.assertCondition)("…"!=this._moves[this._top].move),this._top--;var e=this._moves.pop();if((0,C.assertCondition)("…"!=e.move),super.nextTurn(),this._draw=!1,this._resigned=!1,this._mate=!1,this._stalemate=!1,this.undoMove(e.move,e.turn),void 0!==e.castlingStatus&&o.csMoves.isMoveInfo(e.move)){var i=J.csConvert.getPieceKeyName(e.move.piece);if("R"===i||"K"===i){const t=this.pieceByKey(e.move.piece);switch(i){case"R":t.setCastlingStatus(e.castlingStatus,this.isGrand);break;case"K":t.castlingStatus=e.castlingStatus}}}void 0===e.specialPawnCapture?this.specialPawnCapture=null:this.specialPawnCapture=n.parse(this,e.specialPawnCapture),this.isAwaitingPromotion&&(o.csMoves.isMoveInfo(e.move)&&"P"==J.csConvert.getPieceKeyName(e.move.piece)||o.csMoves.isPromotionInfo(e.move))&&this.computeAwaitingPromotion("b"==e.turn?"w":"b"),"b"===this.turn&&this.moveNumber--,void 0===e.initHalfMoveClock?this.halfmoveClock--:this.halfmoveClock=0,super.prepareCurrentTurn(),super.computeHeuristic(this.turn,this.moveNumber,!0,this.currentHeuristic)}}*castlingMoves(e,i){}*castlingStrMoves(e,o){var i=q.PositionHelper.initialQueenSideRookPosition(e,this.isGrand),t=q.PositionHelper.initialKingSideRookPosition(e,this.isGrand);const n=this.getPiece(i),s=this.getPiece(t);if(null!=s&&!s.moved)for(const c of J.csConvert.orthogonalDirections()){var r,a=q.PositionHelper.orthogonalStep(o,c);if(null!=a&&s.canMoveTo(this,a,!1)){let s="KRK-"+J.csConvert.columnFromIndex(o[0])+J.csConvert.columnFromIndex(a[0]);if(9==o[0]&&10==a[0]&&(r=a[1]-t[1],s+=2==r||-2==r?"O":"OO"),yield s,null!=n&&!n.moved){let i,t;if(o[0]==a[0]){i=a[0]+1,t=o[1]>a[1]?a[1]+1:o[1]+1;const h=[i,t];let e;(e=n.canMoveTo(this,h,!1))||(h[0]=a[0]-1,e=n.canMoveTo(this,h,!1)),e&&(yield s="KRR-"+J.csConvert.columnFromIndex(o[0])+J.csConvert.columnFromIndex(a[0])+J.csConvert.columnFromIndex(h[0]))}else{i=a[0],t=o[1]>a[1]?a[1]+2:a[1]-2;const u=[i,t];n.canMoveTo(this,u,!1)&&(yield s="KRR-"+J.csConvert.columnFromIndex(o[0])+J.csConvert.columnFromIndex(a[0])+J.csConvert.columnFromIndex(u[0])),u[0]=o[0],u[1]=o[1]>a[1]?o[1]-2:o[1]+2,n.canMoveTo(this,u,!1)&&(yield s="KRR-"+J.csConvert.columnFromIndex(o[0])+J.csConvert.columnFromIndex(a[0])+J.csConvert.columnFromIndex(u[0]))}}}}if(null!=n&&!n.moved)for(const p of J.csConvert.orthogonalDirections()){var l=q.PositionHelper.orthogonalStep(o,p);null!=l&&n.canMoveTo(this,l,!1)&&(yield"KRD-"+J.csConvert.columnFromIndex(o[0])+J.csConvert.columnFromIndex(l[0]))}}castlingKingPosition(e){(0,C.assertCondition)(J.csTypes.isCastlingColumn(e),`Column: ${e} has to be a king castling column`);var i=super.turnKing;return i.moved?null:(e=b.kingCastlingPosition(i.color,e),null!=this.hasPiece(e)||this.isThreatened(e,i.color)?null:e)}castlingRookPosition(e,i,t,s){var o=this.turn,n="K"==t?q.PositionHelper.initialKingSideRookPosition(o,this.isGrand):q.PositionHelper.initialQueenSideRookPosition(o,this.isGrand),r=((0,C.assertCondition)(J.csTypes.isCastlingColumn(e),`King column: ${e} has to be a king castling column`),b.rookCastleMove(e,i,o,t,this.isGrand));let a=q.PositionHelper.orthogonalStep(n,r);if("ColumnUp"==r||"ColumnDown"==r)return a=void 0===s&&!this.isGrand||void 0!==s&&!s?q.PositionHelper.orthogonalStep(a,r):a;for(var l=J.csConvert.toColumnIndex(i);a[0]!=l;)a=q.PositionHelper.orthogonalStep(a,r);return a}playerCastlingPositionStatus(e){var i=super.turnKing;return(0,C.assertCondition)(J.csTypes.isCastlingColumn(e),`Column: ${e} has to be a king castling column`),i.moved?null:(e=("w"==this.turn?b.whiteKingCastlingMove:b.blackKingCastlingMove)[e],[e=q.PositionHelper.knightJump(i.position,e),null!=this.hasPiece(e)?"occupied":this.isThreatened(e,i.color)?"threated":""])}get castlingStatus(){var e=this.wKing.getCastlingStatus(this),i=this.bKing.getCastlingStatus(this).toLowerCase();return"-"==e&&"-"==i?"-":"-"==e?i:"-"==i?e:e+i}playerCastlingStatus(){return super.turnKing.getCastlingStatus(this)}moves(e){return Object.freeze(this._moves.slice(e))}strMoves(){let t=[];if(0<this._moves.length){let e;for(let i=e="b"==this._moves[0].turn?(t.push(this._moves[0].n+". …, "+o.csMoves.fullMoveNotation(this._moves[0])),1):0;i<=this._top;i+=2){let e=o.csMoves.fullMoveNotation(this._moves[i]);i<this._top&&(e+=", "+o.csMoves.fullMoveNotation(this._moves[i+1])),t.push(e)}}return t.join("\n")}moveBottom(){for(;1<this._top||1==this._top&&"…"!=this._moves[0].move;){var e=this._moves[this._top--];(0,C.assertCondition)("…"!=e.move),this.undoMove(e.move,e.turn)}}moveBackward(){var e;(1<this._top||1==this._top&&"…"!=this._moves[0].move)&&(e=this._moves[this._top--],(0,C.assertCondition)("…"!=e.move),this.undoMove(e.move,e.turn))}moveForward(){var e;this._top<this._moves.length-1&&(e=this._moves[++this._top],(0,C.assertCondition)("…"!=e.move),this.applyMove(e.move,e.turn))}moveTop(){for(;this._top<this._moves.length-1;){var e=this._moves[++this._top];(0,C.assertCondition)("…"!=e.move),this.applyMove(e.move,e.turn)}}get topMoveId(){return 0<=this._top?o.csMoves.undoStatusId(this._moves[this._top]):""}get movesJSON(){return JSON.stringify(this._moves)}restoreMovesJSON(e){this._moves=JSON.parse(e),this._top=this._moves.length-1}get valueTLPD(){return this.piecePositionsTLPD+" "+this.turn+" "+this.castlingStatus+" "+(this.specialPawnCapture?.toString()??"-")+" "+this.halfmoveClock.toString()+" "+(this.fixedNumbering?this.moveNumber.toString():"-")}get piecePositionsTLPD(){let e="/";for(let s=28;0<=s;s--){var o=s%2==0,n=s<=5?7-s:23<=s?s-21:o?1:0,r=s<=5?s+7:23<=s?35-s:o?13:14;let i="",t=0;for(let e=n;e<=r;e+=2){var a=this.getPiece([e,s]);null!=a?(0<t&&(i+=t.toString()),i+=a.uncapitalizedSymbol,t=0):t++}0<i.length&&(e+=s.toString()+":"+i,0<t&&(e+=t.toString()),e+="/")}return e}loadTLPD(e){try{(0,C.assertCondition)(null!=e,"Not empty TLPD"),(0,C.assertCondition)(12<e.trim().length,"Enough TLPD length");var i=e.split(" "),t=((0,C.assertCondition)(2<=i.length,"Piece positions and turn are mandatory"),(0,C.assertCondition)(10<=i[0].length,"Piece positions string"),(0,C.assertCondition)(J.csTypes.isTurn(i[1]),"Correct turn"),i[1]),[s,o]=(super.resetGame(t),this._moves.length=0,this._top=-1,u.splitCastlingStatus(i[2]));if(this.restoreTLPDPositions(i[0],s,o),this.halfmoveClock=J.csTypes.isNumber(Number(i[4]))?Number(i[4]):0,isNaN(Number(i[4]))&&null!=i[4]&&"-"!==i[4])throw new TypeError("Invalid halfmove clock value");if(this.moveNumber=J.csTypes.isNumber(Number(i[5]))?Number(i[5]):1,isNaN(Number(i[5]))){if(null!=i[5]&&"-"!=i[5])throw new TypeError("Invalid move number");this.fixedNumbering=!1}else this.fixedNumbering=!0;super.specialPawnCapture=n.parse(this,i[3]),this.initGame()}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="TLPD"),e}}restoreTLPDPositions(e,i,t){(0,C.assertCondition)(10<=e.length&&"/"==e[0]&&"/"==e[e.length-1],"Valid TLPD string positions: "+e);const s=[],o=[],n=[];var r;for(r of e.split("/"))if(0<r.length){if(r.startsWith(":")||r.endsWith(":")||1!=(r.match(/:/g)||[]).length)throw new Error("Incorrect line number issued: "+r);var[a,l]=r.split(":"),c=Number(a);if(!(!isNaN(c)&&0<=c&&c<=28))throw new Error("Incorrect line issued: "+a);{var h=0<=c&&c<6?7+c:c<=22?c%2==0?13:14:35-c;let e=0<=c&&c<6?7-c:c<=22?c%2==0?1:0:c-21;for(const v of l){if(e>h)throw new Error("Incorrect TLPD line content");var u=Number(v);if(isNaN(u)){var p=J.csTypes.isPieceName(v)?v:b.convertPieceAliases(v.toUpperCase()),P=v.toUpperCase()==v?"w":"b";if("K"==p)if("w"==P){if(null!=this.wKing.position)throw new Error("Can't place two White Kings");if(this.wKing.setPositionTo([e,c]),null!=this.hasPiece(this.wKing.position))throw new Error("Can't place White King on the place used by another piece");this.addPiece(this.wKing)}else{if(null!=this.bKing.position)throw new Error("Can't place two Black Kings");if(this.bKing.setPositionTo([e,c]),null!=this.hasPiece(this.bKing.position))throw new Error("Can't place Black King on the place used by another piece");this.addPiece(this.bKing)}else{p=super.createPiece(p,P,J.csConvert.columnFromIndex(e),c);V.csPieceTypes.isRook(p)?s.push(p):V.csPieceTypes.isPawn(p)&&null!=p.awaitingPromotion&&super.setAwaitingPromotion(p.color),("w"==P?o:n).push(p)}e+=2}else e+=u<<1}}}if(null==this.wKing.position)throw new Error("There must be a White King");if(null==this.bKing.position)throw new Error("There must be a Black King");var g,d=(e,t)=>e.reduce((e,i)=>i.symbol===t?e+1:e,0);for(g of["w","b"]){const m="w"==g?o:n;let e=d(m,"D");if(1<e)throw new Error(`Too many ${g} Queens`);if(0==e&&this.addRegainablePiece(new y.Queen(g)),1<(e=d(m,"V")))throw new Error(`Too many ${g} Wyverns`);if(0==e&&this.addRegainablePiece(new y.Wyvern(g)),2<(e=d(m,"R")))throw new Error(`Too many ${g} Rooks`);for(;e<2;)this.addRegainablePiece(new y.Rook(g,this.isGrand,e)),e++;if(2<(e=d(m,"G")))throw new Error(`Too many ${g} Pegasus`);for(;e<2;)this.addRegainablePiece(new y.Pegasus(g,e)),e++;if(e=d(m,"N"),!this.isGrand&&2<e||this.isGrand&&4<e)throw new Error(`Too many ${g} Knights`);for(;e<2;)this.addRegainablePiece(new y.Knight(g,e)),e++;if(3<(e=d(m,"J")))throw new Error(`Too many ${g} Bishops`);{let e={White:0,Black:0,Color:0};for(const w of m.filter(e=>V.csPieceTypes.isBishop(e)))e[w.hexesColor]+=1;if(1<e.White||1<e.Black||1<e.Color)throw new Error(`Too many ${g} Bishops on same color hexes`);0==e.White&&this.addRegainablePiece(new y.Bishop(g,"White")),0==e.Black&&this.addRegainablePiece(new y.Bishop(g,"Black")),0==e.Color&&this.addRegainablePiece(new y.Bishop(g,"Color"))}}this.wKing.castlingStatus=i,this.bKing.castlingStatus=t;for(const f of s)f.setCastlingStatus("w"==f.color?i:t,this.isGrand)}applyMoveSq(e){try{(0,C.assertCondition)(this._top==this._moves.length-1,"push the moves over the last one");var i="1"!=(e=e.replaceAll(" ","").replace(/\n\n+/g,"\n").replace(/^[\s\n]+|[\s\n]+$/gm,""))[0]||"?"!=e[1];e=e.replace(/^1\?/,"1.").replace(/^1....,/,"1.…");const o=new RegExp(/^(\d+\..*\n)+\d+\..*$/),n=((0,C.assertCondition)(o.test(e),"numbered lines"),e.split(/\r?\n/));var t=this.moveNumber;this.fixedNumbering=this.fixedNumbering&&1!=t||i;for(let e=0;e<n.length;e++){var s=n[e].split(/[.,]\s?/);const r=parseInt(s[0]);(0,C.assertCondition)(r.toString()==s[0],`Line number of "${n[e]}"`),(0,C.assertCondition)(this.moveNumber==(i?r:t+r-1),`Expected move number ${this.moveNumber} on move `+e),1==r?((0,C.assertCondition)(3==s.length,"first move must be a numbered pair of moves; white move can be an ellipsis: "+n[0]),"…"==s[1]?(0,C.assertCondition)("b"==this.turn,"It begins on black's turn"):((0,C.assertCondition)("w"==this.turn,"It begins on white's turn"),this.applyStringMove(s[1])),this.applyStringMove(s[2])):e==n.length-1?((0,C.assertCondition)(2<=s.length&&s.length<=3,"last move "+n[e]),this.applyStringMove(s[1]),3==s.length&&this.applyStringMove(s[2])):((0,C.assertCondition)(3==s.length,"numbered pair of moves: "+n[e]),this.applyStringMove(s[1]),this.applyStringMove(s[2]))}}catch(e){throw e instanceof Error&&"Error"==e.name&&(e.name="Move seq"),e}}applyStringMove(e){var i,t,s,o,n,r=(e,i=0)=>{let t=i;for(;t<e.length;){var s=e.charCodeAt(t);if(!(48<=s&&s<58||65<=s&&s<91||97<=s&&s<123))return t;t++}return t},a=e=>q.PositionHelper.isValidPosition(q.PositionHelper.parse(e));(0,C.assertCondition)(this._top==this._moves.length-1,"push the move over the last one"),(0,C.assertCondition)(4<=e.length,"Moviment length must be at least of 4 chars"),e.startsWith("KR")&&"-"==e[3]||"–"==e[3]?(o="–"==e[3]?e.replace("–","-"):e,this.isGrand?(0,C.assertCondition)(J.csTypes.isGrandCastlingString(o),"grand castling move: "+o):(0,C.assertCondition)(J.csTypes.isCastlingString(o),"castling move: "+o),this.doCastling(o)):(o=r(e=e.replace("x","×")),i=J.csTypes.isPieceName(e[0])&&J.csTypes.isColumn(e[1])?e[0]:"P",t=e.slice("P"==i?0:1,o),(0,C.assertCondition)(o<e.length-1,"Moviment divided into parts"),(0,C.assertCondition)(a(t),"Initial hex"),s="@"==e.charAt(o)&&"@"==e.charAt(o+1)?"@@":e.charAt(o),(0,C.assertCondition)(["-","–","×","@","@@","="].includes(s),`valid origin&destiny separator "${s}"`),"="==s?(n=e[o+1],(0,C.assertCondition)("P"==i,"Promoting a pawn"),this.doPromotePawn(t,t,n)):((0,C.assertCondition)(o<e.length-2,"Movement destination"),r=r(e,n=o+s.length),o=J.csTypes.isPieceName(e[n])&&J.csTypes.isColumn(e[n+1])?e[n]:void 0,n=e.slice(void 0===o?n:n+1,r),(0,C.assertCondition)(a(n),"Destination hex"),(0,C.assertCondition)(void 0===o||"-"!=s&&"–"!=s,"Captured piece"),r<e.length&&"="==e[r]?(a=e[r+1],(0,C.assertCondition)("P"==i,"Promoting a pawn"),this.doPromotePawn(t,n,a)):this.doMove(t,n,i)))}*pieceList(){for(const e of this.whitePieces())yield e.uncapitalizedSymbolPositionString;for(const i of this.blackPieces())yield i.uncapitalizedSymbolPositionString}*threatenedPieceStringPositions(){var e="w"==this.turn?this.whitePiecePositions():this.blackPiecePositions(),i=this.turn;for(const t of e)this.isThreatened(t,i)&&(yield q.PositionHelper.toString(t))}*ownThreatsPieceStringPositions(){var e="w"==this.turn?this.blackPiecePositions():this.whitePiecePositions(),i=this.turn;for(const s of e)this.hasThreat(s,i)&&(yield q.PositionHelper.toString(s));const t=this.specialPawnCapture;null!=t&&(t.isScornfulCapturable()?yield q.PositionHelper.toString(t.capturablePiece.position):t.isEnPassantCapturable()&&(e=t.capturablePiece.position,this.isThreatened(e,i)&&(yield q.PositionHelper.toString(e))))}pushMove(e){var i={n:this.moveNumber,turn:this.turn,move:e,fixedNumbering:1!=this.moveNumber||this.fixedNumbering?void 0:"?",initHalfMoveClock:0==this.halfmoveClock?"1":void 0,specialPawnCapture:null==this.specialPawnCapture?void 0:this.specialPawnCapture.toString(),castlingStatus:o.csMoves.isMoveInfo(e)&&0<=["K","R"].indexOf(J.csConvert.getPieceKeyName(e.piece))?this.playerCastlingStatus():void 0},e=(this.applyMove(e,this.turn),super.nextTurn(),"w"===this.turn&&this.moveNumber++,o.csMoves.isMoveInfo(e)&&"P"==J.csConvert.getPieceKeyName(e.piece)||o.csMoves.isCaptureInfo(e)||o.csMoves.isPromotionInfo(e)?this.halfmoveClock=0:this.halfmoveClock++,super.prepareCurrentTurn(),super.isMoveableTurn());let t=void 0,s=void 0;if(e){if(200<=this.halfmoveClock)this._draw=!0,t="draw";else if(this.checked)if(this.isKnightOrCloseCheck)s="^+";else if(this.isSingleCheck)s="+";else{if(!this.isDoubleCheck)throw new Error("never: exhaused check options");s="++"}}else t=this.checked?(this._mate=!0,"mate"):(this._stalemate=!0,"stalemate");this._top<0&&"b"==i.turn&&(this._moves.push({n:i.n,turn:"w",move:"…"}),this._top++);i=o.csMoves.promoteUndoStatus(i,t,s);this._moves.push(i),this._top++,super.computeHeuristic(this.turn,this.moveNumber,e,this.currentHeuristic)}applyMove(e,i){var t;o.csMoves.isCastlingInfo(e)?this.applyCastling(e,i):(i=this.pieceByKey(e.piece),o.csMoves.isMoveInfo(e)?(t=e.moveTo,o.csMoves.isCaptureInfo(e)&&super.capturePiece(this.pieceByKey(e.captured)),super.movePiece(i,t[0],t[1]),o.csMoves.isPromotionInfo(e)&&super.promotePawn(i,this.pieceByKey(e.promoted))):super.promotePawn(i,this.pieceByKey(e.promoted)))}applyCastling(e,i){var i="w"==i?this.wKing:this.bKing,t=b.kingCastlingPosition(i.color,e.col);switch(e.side){case"K":super.movePiece(this.pieceByKey(e.kRook),e.rPos[0],e.rPos[1]);break;case"D":super.movePiece(this.pieceByKey(e.qRook),e.rPos[0],e.rPos[1]);break;case"R":super.movePiece(this.pieceByKey(e.kRook),e.rPos[0],e.rPos[1]),super.movePiece(this.pieceByKey(e.qRook),e.r2Pos[0],e.r2Pos[1])}super.movePiece(i,t[0],t[1])}undoMove(e,i){var t;o.csMoves.isCastlingInfo(e)?this.undoCastling(e,i):(i=this.pieceByKey(e.piece),o.csMoves.isMoveInfo(e)?(o.csMoves.isPromotionInfo(e)&&super.undoPromotePawn(i,this.pieceByKey(e.promoted)),super.undoPieceMove(i,e.pos[0],e.pos[1]),o.csMoves.isCaptureInfo(e)&&(t=void 0===e.special?e.moveTo:e.special,super.undoCapturePiece(this.pieceByKey(e.captured),t[0],t[1]))):super.undoPromotePawn(i,this.pieceByKey(e.promoted)))}undoCastling(e,i){var t=this.isGrand;const s="w"==i?this.wKing:this.bKing;var o="w"==i?q.PositionHelper.whiteKingInitPosition:q.PositionHelper.blackKingInitPosition,n="D"==e.side?q.PositionHelper.initialQueenSideRookPosition(i,t):q.PositionHelper.initialKingSideRookPosition(i,t);const r=this.pieceByKey("D"==e.side?e.qRook:e.kRook);if(console.log(e),(0,C.assertNonNullish)(r),super.undoPieceMove(s,o[0],o[1]),super.undoPieceMove(r,n[0],n[1]),s.castlingStatus="RKR",r.setCastlingStatus("RKR",t),"R"==e.side){const a=this.pieceByKey(e.qRook);o=q.PositionHelper.initialQueenSideRookPosition(i,t);super.undoPieceMove(a,o[0],o[1]),a.setCastlingStatus("RKR",t)}}fillDefaultPositions(){this.wKing.setToInitialPosition(),this.addPiece(this.wKing),this.bKing.setToInitialPosition(),this.addPiece(this.bKing),super.createPiece("D","w","E",1),super.createPiece("V","w","F",0),super.createPiece("G","w","D",2),super.createPiece("J","w","F",2),super.createPiece("G","w","H",2),this.isGrand?(super.createPiece("P","w","B",6),super.createPiece("R","w","B",4),super.createPiece("N","w","C",3),super.createPiece("N","w","I",3),super.createPiece("R","w","K",4),super.createPiece("P","w","K",6),super.createPiece("P","w","P",7),super.createPiece("P","w","T",8),super.createPiece("P","w","X",8),super.createPiece("P","w","Z",7),super.createPiece("M","w","C",7),super.createPiece("M","w","A",7),super.createPiece("M","w","L",7),super.createPiece("M","w","I",7)):(super.createPiece("P","w","B",4),super.createPiece("R","w","C",3),super.createPiece("R","w","I",3),super.createPiece("P","w","K",4)),super.createPiece("N","w","E",3),super.createPiece("N","w","G",3),super.createPiece("E","w","D",4),super.createPiece("J","w","F",4),super.createPiece("E","w","H",4),super.createPiece("P","w","A",5),super.createPiece("P","w","C",5),super.createPiece("E","w","E",5),super.createPiece("E","w","G",5),super.createPiece("P","w","I",5),super.createPiece("P","w","L",5),super.createPiece("P","w","D",6),super.createPiece("J","w","F",6),super.createPiece("P","w","H",6),super.createPiece("P","w","E",7),super.createPiece("P","w","F",8),super.createPiece("P","w","G",7),super.createPiece("D","b","E",27),super.createPiece("V","b","F",28),super.createPiece("G","b","D",26),super.createPiece("J","b","F",26),super.createPiece("G","b","H",26),this.isGrand?(super.createPiece("P","b","B",22),super.createPiece("R","b","B",24),super.createPiece("N","b","C",25),super.createPiece("N","b","I",25),super.createPiece("R","b","K",24),super.createPiece("P","b","K",22),super.createPiece("P","b","P",21),super.createPiece("P","b","T",20),super.createPiece("P","b","X",20),super.createPiece("P","b","Z",21),super.createPiece("M","b","C",21),super.createPiece("M","b","A",21),super.createPiece("M","b","I",21),super.createPiece("M","b","L",21)):(super.createPiece("P","b","B",24),super.createPiece("R","b","C",25),super.createPiece("R","b","I",25),super.createPiece("P","b","K",24)),super.createPiece("N","b","E",25),super.createPiece("N","b","G",25),super.createPiece("E","b","D",24),super.createPiece("J","b","F",24),super.createPiece("E","b","H",24),super.createPiece("P","b","A",23),super.createPiece("P","b","C",23),super.createPiece("E","b","E",23),super.createPiece("E","b","G",23),super.createPiece("P","b","I",23),super.createPiece("P","b","L",23),super.createPiece("P","b","D",22),super.createPiece("J","b","F",22),super.createPiece("P","b","H",22),super.createPiece("P","b","E",21),super.createPiece("P","b","F",20),super.createPiece("P","b","G",21)}initGame(){super.prepareGame(),this._mate=!1,this._stalemate=!1,this._resigned=!1,this._draw=!1;var e=super.isMoveableTurn();e?100<=this.halfmoveClock&&(this._draw=!0):this.checked?this._mate=!0:this._stalemate=!0,super.computeHeuristic(this.turn,this.moveNumber,e,this.currentHeuristic)}}(t.Game=b).whiteKingCastlingMove={I:"LineUp-FileUp",H:"LineUp-ColumnUp",F:"LineInvUp-ColumnUp",E:"LineInvUp-FileInvUp",D:"TransversalLineDec-FileInvUp"},b.blackKingCastlingMove={I:"LineDown-FileDown",H:"LineDown-ColumnDown",F:"LineInvDown-ColumnDown",E:"LineInvDown-FileInvDown",D:"TransversalLineDec-FileInvDown"}},{"./cescacs.moves":2,"./cescacs.piece":3,"./cescacs.positionHelper":4,"./cescacs.types":5,"./ts.general":6}],2:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csMoves=void 0;const o=e("./cescacs.types"),n=e("./cescacs.positionHelper");var r;function s(e){return"string"==typeof e&&("K"===e||"D"===e||"R"===e)}function a(e){return void 0!==e.piece&&void 0!==e.prPos&&o.csTypes.isPosition(e.prPos)&&void 0!==e.promoted}function l(e){return void 0!==e.captured&&(void 0===e.special||o.csTypes.isPosition(e.special))}(r=t.csMoves||(t.csMoves={})).promoteUndoStatus=function(e,i,t){const s=e;return void 0!==i&&(s.end=i),void 0!==t&&(s.check=t),s},r.isCastlingSide=s,r.isCastlingInfo=function(e){return void 0!==e.side&&s(e.side)&&void 0!==e.col&&o.csTypes.isCastlingColumn(e.col)&&void 0!==e.rPos&&o.csTypes.isPosition(e.rPos)&&("D"===e.side||void 0!==e.kRook&&"R"==o.csConvert.getPieceKeyName(e.kRook))&&("K"===e.side||void 0!==e.qRook&&"R"==o.csConvert.getPieceKeyName(e.qRook))&&("R"!=e.side||void 0!==e.r2Pos&&o.csTypes.isPosition(e.r2Pos))},r.isPromotionInfo=a,r.isMoveInfo=function(e){return void 0!==e.piece&&void 0!==e.pos&&o.csTypes.isPosition(e.pos)&&void 0!==e.moveTo&&o.csTypes.isPosition(e.moveTo)},r.isCaptureInfo=l,r.fullMoveNotation=function(e,i=!0){var t,i=i&&"w"==e.turn?e.n+(void 0===e.fixedNumbering?". ":"? "):"";return"…"==e.move?i+"…":(t=e.check??("mate"==e.end?"#":""),i+r.moveNotation(e.move)+t)},r.endText=function(e,i){if(void 0===e.end)return"";switch(e.end){case"mate":case"resigned":return"b"==i?"3 - 0":"0 - 3";case"stalemate":return"b"==i?"2 - 1":"1 - 2";case"draw":return"1 - 1";default:var t=e.end;throw new Error(t)}},r.undoStatusId=function(e){return"…"==e.move?"":e.turn+e.n},r.moveNotation=function(i){if(r.isCastlingInfo(i))return t=void 0!==i.r2Pos?o.csConvert.columnFromIndex(i.r2Pos[0]):"K"==i.side&&"H"==i.col&&10==i.rPos[0]?5==i.rPos[1]||23==i.rPos[1]?"O":7==i.rPos[1]||21==i.rPos[1]?"OO":"":"","KR"+i.side+"-"+i.col+o.csConvert.columnFromIndex(i.rPos[0])+t;if(r.isMoveInfo(i)){var t=o.csConvert.getPieceKeyName(i.piece),t=("P"==t?"":t)+n.PositionHelper.toString(i.pos),s=a(i)?"="+o.csConvert.getPieceKeyName(i.promoted):"";let e;return t+(e=l(i)?void 0!==i.special?n.PositionHelper.equals(i.moveTo,i.special)||2==Math.abs(i.special[1]-i.moveTo[1])?"@":"@@":"P"==(t=o.csConvert.getPieceKeyName(i.captured))?"×":"×"+t:"-")+n.PositionHelper.toString(i.moveTo)+s}if(r.isPromotionInfo(i))return n.PositionHelper.toString(i.prPos)+"="+o.csConvert.getPieceKeyName(i.promoted);throw new TypeError("must be a move notation")}},{"./cescacs.positionHelper":4,"./cescacs.types":5}],3:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csPieceTypes=t.Pawn=t.Almogaver=t.Elephant=t.Bishop=t.Knight=t.Pegasus=t.Rook=t.Wyvern=t.Queen=t.King=t.Piece=void 0;const d=e("./cescacs.types"),v=e("./cescacs.positionHelper"),l=e("./ts.general"),u=e("./cescacs");class s{constructor(e){this.color=e}static isRegainablePiece(e){switch(e){case"D":case"V":case"R":case"G":case"N":case"J":return!0;default:return!1}}get position(){return this._position}setPositionTo(e){if(null!=this._position)throw new Error("Piece can't be reassigned to a new position");this._position=e}moveTo(e,i){null!=this._position&&(this._position[0]=e,this._position[1]=i)}get pin(){return this._pin}set pin(e){this._pin=e}get hasOrthogonalAttack(){return"R"==this.symbol||"V"==this.symbol||"D"==this.symbol}get hasDiagonalAttack(){return"J"==this.symbol||"G"==this.symbol||"D"==this.symbol}get hasKnightJumpAttack(){return"N"==this.symbol||"V"==this.symbol||"G"==this.symbol}get hasOnlyCloseAttack(){return"P"==this.symbol||"E"==this.symbol||"M"==this.symbol||"K"==this.symbol}get isRegainable(){return s.isRegainablePiece(this.symbol)}toString(){return this.uncapitalizedSymbol+this.position?.toString()}get uncapitalizedSymbol(){return"w"==this.color?this.symbol:this.symbol.toLowerCase()}get symbolPositionString(){return this.symbol+(null==this.position?"":v.PositionHelper.toString(this.position))}get uncapitalizedSymbolPositionString(){return this.uncapitalizedSymbol+(null==this.position?"":v.PositionHelper.toString(this.position))}canMoveTo(e,i){return v.PositionHelper.positionIteratorIncludes(this.moves(e),i)}canCaptureOn(e,i){return this.canMoveTo(e,i)}captured(){(0,l.assertNonNullish)(this._position,"Don't capture again the piece"),this._position=null}*blockThreat(e,i){yield*v.PositionHelper.positionIteratorIntersection(this.moves(e),i)}*knightMoves(e,i=!1){if(null!=this._position&&null==this.pin)for(const s of v.PositionHelper.knightMoves(this._position)){var t;!i&&null!=(t=e.hasPiece(s))&&t===this.color||(yield s)}}*orthogonalMoves(i,t=!1){if(null!=this._position)for(const o of(null==this.pin?null:d.csTypes.isOrthogonalOrientation(this.pin)?this.pin:[])??d.csConvert.orthogonalDirections()){const n=v.PositionHelper.orthogonalRide(this._position,o);let e=n.next();for(;0==e.done;){var s=i.hasPiece(e.value);e=null==s?(yield e.value,n.next()):(!t&&s===this.color||(yield e.value),n.return())}}}*diagonalMoves(i,t=!1){if(null!=this._position)for(const o of(null==this.pin?null:d.csTypes.isDiagonalOrientation(this.pin)?this.pin:[])??d.csConvert.diagonalDirections()){const n=v.PositionHelper.diagonalRide(this._position,o);let e=n.next();for(;!e.done;){var s=i.hasPiece(e.value);e=null==s?(yield e.value,n.next()):(!t&&s===this.color||(yield e.value),n.return())}}}orthogonalStep(e,i,t=!0,s=!1){return null!=this._position?(null!=this.pin&&d.csTypes.isOrthogonalOrientation(this.pin)&&this.pin,(null==this._pin||this._pin.includes(i))&&null!=(i=v.PositionHelper.orthogonalStep(this._position,i))?(e=e.hasPiece(i),s||null==e||t&&e!==this.color?i:null):null):null}diagonalStep(e,i,t=!0,s=!1){return null!=this._position&&(null==this._pin||this._pin.includes(i))&&null!=(i=v.PositionHelper.diagonalStep(this._position,i))?(e=e.hasPiece(i),s||null==e||t&&e!==this.color?i:null):null}canMoveOrthogonallyTo(e,i,t=!0){if(null!=this.position){var s=v.PositionHelper.isOrthogonally(this.position,i);if(null!=s&&(null==this._pin||this._pin.includes(s))){var o=e.hasPiece(i);if(null==o||t&&o!=this.color)for(const n of v.PositionHelper.orthogonalRide(this.position,s)){if(v.PositionHelper.equals(i,n))return!0;if(null!=e.hasPiece(n))return!1}}}return!1}canMoveDiagonallyTo(e,i,t=!0){if(null!=this.position){var s=v.PositionHelper.isDiagonally(this.position,i);if(null!=s&&(null==this._pin||this._pin.includes(s))){var o=e.hasPiece(i);if(null==o||t&&o!=this.color)for(const n of v.PositionHelper.diagonalRide(this.position,s)){if(v.PositionHelper.equals(i,n))return!0;if(null!=e.hasPiece(n))return!1}}}return!1}}class o extends(t.Piece=s){constructor(e){super(e),this.symbol="K",this.value=0,this._moved=!1,this.checkPosition=null,this.key=e+this.symbol}setPositionTo(e){super.setPositionTo(e),this._moved=!this.isInitialPosition}setToInitialPosition(){super.setPositionTo(this.initialPosiition),this._moved=!1}get checked(){return null!=this.checkPosition}get moved(){return this._moved}set castlingStatus(e){this._moved=this._moved||"-"==e}getCastlingStatus(e){var i;return this._moved?"-":(i=e.getPiece(v.PositionHelper.initialKingSideRookPosition(this.color,e.isGrand)),e=e.getPiece(v.PositionHelper.initialQueenSideRookPosition(this.color,e.isGrand)),null!=i&&i.color==this.color&&w.isRook(i)&&!i.moved?null!=e&&e.color==this.color&&w.isRook(e)&&!e.moved?"RKR":"KR":null!=e&&e.color==this.color&&w.isRook(e)&&!e.moved?"KR":"K")}moveTo(e,i){super.moveTo(e,i),this._moved=!0}*moves(e){if(this.checked){(0,l.assertNonNullish)(this.position),(0,l.assertNonNullish)(this.checkPosition);for(const n of d.csConvert.orthogonalDirections()){var i,t=v.PositionHelper.orthogonalStep(this.position,n);null==t||null!=this.pin&&this.pin.includes(n)&&!d.csTypes.isCheckAttackPos(this.checkPosition,t)||null!=(i=e.hasPiece(t))&&i==this.color||e.isThreatened(t,this.color)||(yield t)}for(const r of d.csConvert.diagonalDirections()){var s,o=v.PositionHelper.diagonalStep(this.position,r);null==o||null!=this.pin&&this.pin.includes(r)&&!d.csTypes.isCheckAttackPos(this.checkPosition,o)||null!=(s=e.hasPiece(o))&&s==this.color||e.isThreatened(o,this.color)||(yield o)}}else for(const a of this.attemptMoves(e))e.isThreatened(a,this.color)||(yield a)}markThreats(e){for(const i of this.attemptMoves(e,!0))e.setThreat(i,this.color)}computeCheckAndPins(t){this.checkPosition=null,console.log(`Compute ${this.color} pins`);for(const i of v.PositionHelper.knightMoves(this.position)){var e=t.getPiece(i);null!=e&&e.color!=this.color&&e.hasKnightJumpAttack&&this.setKnightOrCloseAttack(i)}for(const a of d.csConvert.orthogonalDirections()){const l=v.PositionHelper.orthogonalRide(this.position,a);let e=l.next(),i=!0;for(;!e.done;){var s=e.value;const c=t.getPiece(s);if(null==c)i=!1,e=l.next();else{if(c.color!=this.color)i?c.hasOrthogonalAttack?this.setKnightOrCloseAttack(s,a):c.hasOnlyCloseAttack&&c.canCaptureOn(t,this.position)&&this.setKnightOrCloseAttack(s):c.hasOrthogonalAttack&&this.setOrthogonalAtack(s,a);else{const h=v.PositionHelper.orthogonalRide(s,a);let e=h.next();for(;!e.done;){var o=e.value,o=t.getPiece(o);e=null==o?h.next():(o.color!=this.color&&o.hasOrthogonalAttack&&(c.pin=d.csConvert.getOrthogonalOrientation(a)),h.return())}}e=l.return()}}}for(const u of d.csConvert.diagonalDirections()){const p=v.PositionHelper.diagonalRide(this.position,u);let e=p.next(),i=!0;for(;!e.done;){var n=e.value;const P=t.getPiece(n);if(null==P)i=!1,e=p.next();else{if(P.color!=this.color)i?P.hasDiagonalAttack?this.setKnightOrCloseAttack(n,u):P.hasOnlyCloseAttack&&P.canCaptureOn(t,this.position)&&this.setKnightOrCloseAttack(n):P.hasDiagonalAttack&&this.setDiagonalAtack(n,u);else{const g=v.PositionHelper.diagonalRide(n,u);let e=g.next();for(;!e.done;){var r=e.value,r=t.getPiece(r);e=null==r?g.next():(r.color!=this.color&&r.hasDiagonalAttack&&(P.pin=d.csConvert.getDiagonalOrientation(u)),g.return())}}e=p.return()}}}}isKnightOrCloseCheck(){return null!=this.checkPosition&&d.csTypes.isPosition(this.checkPosition)}isSingleCheck(){return null!=this.checkPosition&&d.csTypes.isSingleCheck(this.checkPosition)}isDoubleCheck(){return null!=this.checkPosition&&!d.csTypes.isPosition(this.checkPosition)&&!d.csTypes.isSingleCheck(this.checkPosition)}get checkThreat(){return null!=this.checkPosition?d.csTypes.isPosition(this.checkPosition)?this.checkPosition:d.csTypes.isSingleCheck(this.checkPosition)?this.checkPosition.p:null:null}getSingleCheckBlockingPositions(e){const i=[];if((0,l.assertNonNullish)(this.position),d.csTypes.isSingleCheck(this.checkPosition)){var t=this.checkPosition.d;if(d.csTypes.isDiagonalDirection(t))for(const s of v.PositionHelper.diagonalRide(this.position,t)){if(null!=e.hasPiece(s))break;i.push(s)}else if(d.csTypes.isOrthogonalDirection(t))for(const o of v.PositionHelper.orthogonalRide(this.position,t)){if(null!=e.hasPiece(o))break;i.push(o)}}return i}setOrthogonalAtack(e,i){if(null!=this.checkPosition)if(d.csTypes.isPosition(this.checkPosition))this.checkPosition=[this.checkPosition,e,null],this.pin=d.csConvert.getOrthogonalOrientation(i);else{if(!d.csTypes.isSingleCheck(this.checkPosition))throw new Error("Triple check situation can't be achieved in the course of a game");this.checkPosition=[this.checkPosition.p,e,d.csConvert.getOrthogonalOrientation(i)]}else this.checkPosition={p:e,d:i},this.pin=d.csConvert.getOrthogonalOrientation(i)}setDiagonalAtack(e,i){if(null!=this.checkPosition)if(d.csTypes.isPosition(this.checkPosition))this.checkPosition=[this.checkPosition,e,null],this.pin=d.csConvert.getDiagonalOrientation(i);else{if(!d.csTypes.isSingleCheck(this.checkPosition))throw new Error("Triple check situation can't be achieved in the course of a game");this.checkPosition=[this.checkPosition.p,e,d.csConvert.getDiagonalOrientation(i)]}else this.checkPosition={p:e,d:i},this.pin=d.csConvert.getDiagonalOrientation(i)}setKnightOrCloseAttack(e,i){if(null!=this.checkPosition){if(d.csTypes.isPosition(this.checkPosition))throw new Error("Double knight or close check situation can't be achieved in the course of a game");if(!d.csTypes.isSingleCheck(this.checkPosition))throw new Error("Triple check situation can't be reached along a game");null==i?this.checkPosition=[this.checkPosition.p,e,null]:d.csTypes.isOrthogonalDirection(i)?this.checkPosition=[this.checkPosition.p,e,d.csConvert.getOrthogonalOrientation(i)]:this.checkPosition=[this.checkPosition.p,e,d.csConvert.getDiagonalOrientation(i)]}else this.checkPosition=e,null!=i&&(this.pin=d.csTypes.isOrthogonalDirection(i)?d.csConvert.getOrthogonalOrientation(i):d.csConvert.getDiagonalOrientation(i))}*orthogonalStepList(e,i){(0,l.assertNonNullish)(this.position);for(const o of d.csConvert.orthogonalDirections()){var t,s=v.PositionHelper.orthogonalStep(this.position,o);null==s||!i&&null!=(t=e.hasPiece(s))&&t===this.color||(yield s)}}*diagonalStepList(e,i){(0,l.assertNonNullish)(this.position);for(const o of d.csConvert.diagonalDirections()){var t,s=v.PositionHelper.diagonalStep(this.position,o);null==s||!i&&null!=(t=e.hasPiece(s))&&t===this.color||(yield s)}}*attemptMoves(e,i=!1){yield*this.orthogonalStepList(e,i),yield*this.diagonalStepList(e,i),this._moved||this.checked||(yield*this.knightMoves(e))}get initialPosiition(){return"w"==this.color?v.PositionHelper.whiteKingInitPosition:v.PositionHelper.blackKingInitPosition}get isInitialPosition(){return null!=this.position&&(8==this.position[0]&&("w"==this.color&&1==this.position[1]||"b"==this.color&&27==this.position[1]))}}t.King=o;class n extends s{constructor(e,i,t){super(e),this.symbol="D",this.value=15,this.key=e+this.symbol,void 0!==i&&((0,l.assertCondition)(d.csTypes.isColumn(i)),(0,l.assertNonNullish)(t,"line of the column"),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)))}*moves(e){yield*this.orthogonalMoves(e),yield*this.diagonalMoves(e)}canMoveTo(e,i){return super.canMoveOrthogonallyTo(e,i)||super.canMoveDiagonallyTo(e,i)}markThreats(e){for(const i of this.orthogonalMoves(e,!0))e.setThreat(i,this.color);for(const t of this.diagonalMoves(e,!0))e.setThreat(t,this.color)}}t.Queen=n;class r extends s{constructor(e,i,t){super(e),this.symbol="V",this.value=14,this.key=e+this.symbol,void 0!==i&&((0,l.assertCondition)(d.csTypes.isColumn(i)),(0,l.assertNonNullish)(t,"line of the column"),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)))}*moves(e){yield*this.orthogonalMoves(e),yield*this.knightMoves(e)}canMoveTo(e,i){return super.canMoveOrthogonallyTo(e,i)||v.PositionHelper.positionIteratorIncludes(this.knightMoves(e),i)}markThreats(e){for(const i of this.orthogonalMoves(e,!0))e.setThreat(i,this.color);for(const t of this.knightMoves(e,!0))e.setThreat(t,this.color)}}t.Wyvern=r;class a extends s{constructor(e,i,t,s){super(e),this.symbol="R",this.value=11,void 0!==s?((0,l.assertCondition)(d.csTypes.isColumn(t)),super.setPositionTo(v.PositionHelper.fromBoardPosition(t,s,!0)),this.key=e+this.symbol+(this.isKingSide(i)?"k":this.isQueenSide(i)?"q":t+s),this._moved=!this.isKingSide(i)&&!this.isQueenSide(i)):((0,l.assertCondition)("number"==typeof t,"instance number of piece "+this.symbol),this.key=e+this.symbol+t,this._moved=!1)}setPositionTo(e){super.setPositionTo(e),this._moved=!(this.isQueenSide(!1)||this.isKingSide(!1)||this.isQueenSide(!0)||this.isKingSide(!0))}isQueenSide(e){return null!=this.position&&(e?3==this.position[0]&&("w"==this.color?4==this.position[1]:24==this.position[1]):4==this.position[0]&&("w"==this.color?3==this.position[1]:25==this.position[1]))}isKingSide(e){return null!=this.position&&(e?11==this.position[0]&&("w"==this.color?4==this.position[1]:24==this.position[1]):10==this.position[0]&&("w"==this.color?3==this.position[1]:25==this.position[1]))}*moves(e){yield*this.orthogonalMoves(e)}moveTo(e,i){super.moveTo(e,i),this._moved=!0}canMoveTo(e,i,t=!0){return super.canMoveOrthogonallyTo(e,i,t)}markThreats(e){for(const i of this.orthogonalMoves(e,!0))e.setThreat(i,this.color)}setCastlingStatus(e,i){this._moved=this.isQueenSide(i)?!e.startsWith("R"):!this.isKingSide(i)||!e.endsWith("R")}get moved(){return this._moved}}t.Rook=a;class c extends s{constructor(e,i,t){super(e),this.symbol="G",this.value=8,void 0!==t?((0,l.assertCondition)(d.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t):((0,l.assertCondition)("number"==typeof i,"instance number of piece "+this.symbol),this.key=e+this.symbol+i)}*moves(e){yield*this.diagonalMoves(e),yield*this.knightMoves(e)}canMoveTo(e,i){return super.canMoveDiagonallyTo(e,i)||v.PositionHelper.positionIteratorIncludes(this.knightMoves(e),i)}markThreats(e){for(const i of this.diagonalMoves(e,!0))e.setThreat(i,this.color);for(const t of this.knightMoves(e,!0))e.setThreat(t,this.color)}}t.Pegasus=c;class h extends s{constructor(e,i,t){super(e),this.symbol="N",this.value=4,void 0!==t?((0,l.assertCondition)(d.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t):((0,l.assertCondition)("number"==typeof i,"instance number of piece "+this.symbol),this.key=e+this.symbol+i)}*moves(e){if(yield*this.knightMoves(e),null!=this.position&&null==this.pin)for(const t of d.csConvert.knightDirections()){var i=v.PositionHelper.knightJump(this.position,t);null==i||null!=e.hasPiece(i)||null!=(i=v.PositionHelper.knightJump(i,t))&&null==e.hasPiece(i)&&(yield i)}}canCaptureOn(e,i){return v.PositionHelper.positionIteratorIncludes(this.knightMoves(e),i)}markThreats(e){for(const i of this.knightMoves(e,!0))e.setThreat(i,this.color)}}t.Knight=h;class p extends s{constructor(e,i,t){if(super(e),this.symbol="J",this.value=3,void 0!==t)(0,l.assertCondition)(d.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.hexesColor=v.PositionHelper.hexColor(this.position);else{if(!d.csTypes.isHexColor(i))throw new TypeError("Bishop constructor error");this.hexesColor=i}this.key=e+this.symbol+this.hexesColor}*moves(e){yield*super.diagonalMoves(e)}canMoveTo(e,i){return super.canMoveDiagonallyTo(e,i)}markThreats(e){for(const i of super.diagonalMoves(e,!0))e.setThreat(i,this.color)}}t.Bishop=p;class P extends s{constructor(e,i,t){super(e),this.symbol="E",this.value=2,(0,l.assertCondition)(d.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t}*moves(e,i=!1){var t,s,o,n,r,a,l=this.position;if(null!=l){const c=this.pin;null!=c&&("ColumnUp"!=c[0]||"ColumnDown"!=c[1])||null!=(t=v.PositionHelper.orthogonalStep(l,this.ownOrthogonalDirection))&&(null==(s=e.hasPiece(t))?(yield t,null==(n=v.PositionHelper.orthogonalStep(t,this.ownOrthogonalDirection))||null!=(o=e.hasPiece(n))&&!i&&o==this.color||(yield n)):s!=this.color?(yield t,i&&(o=e.getPiece(t),u.cspty.isKing(o)&&null!=(n=v.PositionHelper.orthogonalStep(t,this.ownOrthogonalDirection))&&null==e.hasPiece(n)&&(yield n))):i&&(yield t));for(const h of["LineUp","LineInvUp","LineDown","LineInvDown"])null!=c&&!c.includes(h)||null==(r=v.PositionHelper.diagonalStep(l,h))||null!=(a=e.hasPiece(r))&&!i&&a==this.color||(yield r)}}markThreats(e){for(const i of this.moves(e,!0))e.setThreat(i,this.color)}get ownOrthogonalDirection(){return"w"===this.color?"ColumnUp":"ColumnDown"}}t.Elephant=P;class g extends s{constructor(e,i,t){super(e),this.symbol="M",this.value=2,(0,l.assertCondition)(d.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t}*moves(e,i=!1){var t,s=this.position;if(null!=s){const r=this.pin;if(!i)for(const a of d.csConvert.orthogonalDirections())null!=r&&!r.includes(a)||null!=(t=v.PositionHelper.orthogonalStep(s,a))&&null==e.hasPiece(t)&&null!=(t=v.PositionHelper.orthogonalStep(t,a))&&null==e.hasPiece(t)&&(yield t);for(const l of d.csConvert.diagonalDirections())if(null==r||r.includes(l)){var o=v.PositionHelper.diagonalStep(s,l);if(null!=o){var n=e.hasPiece(o);if(null!=n)n!==this.color&&(yield o);else{const c=e.specialPawnCapture;null!=c&&c.isEnPassantCapturable()&&c.isEnPassantCapture(o)&&(yield o)}}}}}canCaptureOn(e,i){return v.PositionHelper.positionIteratorIncludes(this.moves(e,!0),i)}markThreats(e){var i,t=this.position;if(null!=t){const s=this.pin;for(const o of d.csConvert.diagonalDirections())null!=s&&!s.includes(o)||null!=(i=v.PositionHelper.diagonalStep(t,o))&&e.setThreat(i,this.color)}}}t.Almogaver=g;class m extends s{constructor(e,i,t){super(e),this.symbol="P",this.value=1,(0,l.assertCondition)(d.csTypes.isColumn(i)),super.setPositionTo(v.PositionHelper.fromBoardPosition(i,t,!0)),this.key=e+this.symbol+i+t}*moves(e,i=!1){var t,s,o=this.position;if(null!=o){const a=this.pin;if(!i){var n,r,i=this.ownOrthogonalStraightDirection;null!=a&&("ColumnUp"!=a[0]||"ColumnDown"!=a[1])||null!=(n=v.PositionHelper.orthogonalStep(o,i))&&null==e.hasPiece(n)&&(yield n,null!=(n=v.PositionHelper.orthogonalStep(n,i))&&null==e.hasPiece(n)&&(yield n,this.hasTripleStep(e.isGrand)&&null!=(n=v.PositionHelper.orthogonalStep(n,i))&&null==e.hasPiece(n)&&(yield n)));for(const c of this.ownOrthogonalAlternateDirections)null!=a&&!a.includes(c)||null!=(r=v.PositionHelper.orthogonalStep(o,c))&&null==e.hasPiece(r)&&(yield r)}const l=e.specialPawnCapture;null!=l&&l.isScornfulCapturable()&&l.isScorned(this)&&(null==this.pin||null!=(i=v.PositionHelper.isOrthogonally(o,l.capturablePiece.position))&&this.pin.includes(i))&&(yield l.capturablePiece.position);for(const h of this.ownCaptureDirections)null!=a&&!a.includes(h)||null!=(t=v.PositionHelper.diagonalStep(o,h))&&(null!=(s=e.hasPiece(t))?s!=this.color&&(yield t):null!=l&&l.isEnPassantCapturable()&&l.isEnPassantCapture(t)&&(yield t))}}canCaptureOn(e,i){return v.PositionHelper.positionIteratorIncludes(this.moves(e,!0),i)}markThreats(e){var i,t=this.position;if(null!=t){const s=this.pin;for(const o of this.ownCaptureDirections)null!=s&&!s.includes(o)||null!=(i=v.PositionHelper.diagonalStep(t,o))&&e.setThreat(i,this.color)}}hasTripleStep(e){var i,t=this.position;return null!=t&&(3<(i=t[0])&&i<7||3==i&&!e?t[1]==("w"==this.color?i+1:27-i):7<i&&i<11||11==i&&!e?t[1]==("w"==this.color?15-i:13+i):!!e&&(2==i||12==i?t[1]==("w"==this.color?5:23):(3==i||11==i)&&t[1]==("w"==this.color?6:22)))}promoteTo(e){(0,l.assertNonNullish)(this.position,"Pawn to promote is not captured"),(0,l.assertCondition)(v.PositionHelper.isPromotionHex(this.position,this.color),"Promotion hex "+v.PositionHelper.toString(this.position)),e.setPositionTo(this.position),this.captured()}get awaitingPromotion(){return null!=this.position&&v.PositionHelper.isPromotionHex(this.position,this.color)?v.PositionHelper.lineHexColor(this.position[1]):null}get ownOrthogonalStraightDirection(){return"w"===this.color?"ColumnUp":"ColumnDown"}get ownOrthogonalAlternateDirections(){return"w"===this.color?["FileUp","FileInvUp"]:["FileDown","FileInvDown"]}get ownCaptureDirections(){return"w"==this.color?["LineUp","LineInvUp"]:["LineDown","LineInvDown"]}}var w;t.Pawn=m,(e=w=t.csPieceTypes||(t.csPieceTypes={})).isKing=function(e){return"K"==e.symbol},e.isQueen=function(e){return"D"==e.symbol},e.isWyvern=function(e){return"V"==e.symbol},e.isRook=function(e){return"R"==e.symbol},e.isPegasus=function(e){return"G"==e.symbol},e.isKnight=function(e){return"N"==e.symbol},e.isBishop=function(e){return"J"==e.symbol},e.isElephant=function(e){return"E"==e.symbol},e.isPawn=function(e){return"P"==e.symbol},e.isAlmogaver=function(e){return"M"==e.symbol}},{"./cescacs":1,"./cescacs.positionHelper":4,"./cescacs.types":5,"./ts.general":6}],4:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PositionHelper=void 0;const o=e("./cescacs.types");class n{static equals(e,i){return e[0]===i[0]&&e[1]===i[1]}static toString(e){return o.csConvert.columnFromIndex(e[0])+e[1].toString()}static positionKey(e){return e[0].toString()+"-"+e[1].toString()}static parse(e){if(e){const t=e.trim().toUpperCase();e=t.length;if(2<=e&&e<=3){e=t[0];if(o.csTypes.isColumn(e)){var i=parseInt(t.slice(1));if(o.csTypes.isLine(i))return[o.csConvert.toColumnIndex(e),i];throw new RangeError("Invalid line value: "+i)}throw new RangeError("Invalid column: "+e)}throw new RangeError("Invalid coordinates leght: "+t)}throw new RangeError("Empty string for coordinates value")}static fromBoardPosition(e,i,t=!1){e=[e=o.csTypes.isColumn(e)?o.csConvert.toColumnIndex(e):e,i];if(t&&!n.isValidPosition(e))throw new RangeError("Invalid position: "+e);return e}static isValidPosition(e){return o.csTypes.isPosition(e)&&n.isEvenLinesColumnIndex(e[0])==(e[1]%2==0)&&n.isOnBoard(e[0],e[1])}static get whiteKingInitPosition(){return[8,1]}static get blackKingInitPosition(){return[8,27]}static initialQueenSideRookPosition(e,i){return i?"w"==e?[3,4]:[3,24]:"w"==e?[4,3]:[4,25]}static initialKingSideRookPosition(e,i){return i?"w"==e?[11,4]:[11,24]:"w"==e?[10,3]:[10,25]}static isPromotionPos(e,i,t){return i==(e<=7?"w"==t?21+e:7-e:"w"==t?35-e:e-7)}static isPromotionHex(e,i){var t=e[0];return e[1]==(t<=7?"w"==i?21+t:7-t:"w"==i?35-t:t-7)}static promotionDistance(e,i){var t=e[0];return"w"==i?(t<=7?21+t:35-t)-e[1]:e[1]-(t<=7?7-t:t-7)}static hexColor(e){return n.lineHexColor(e[1])}static lineHexColor(e){switch(e%3){case 0:return"Black";case 1:return"White";case 2:return"Color";default:throw new Error}}static isOrthogonally(e,i){i=[i[0]-e[0],i[1]-e[1]];return 0==i[0]?0!=i[1]&&i[1]%2==0?0<i[1]?"ColumnUp":"ColumnDown":null:0<i[0]?i[0]==i[1]?"FileUp":i[0]==-i[1]?"FileDown":null:i[0]==i[1]?"FileInvDown":i[0]==-i[1]?"FileInvUp":null}static isDiagonally(e,i){i=[i[0]-e[0],i[1]-e[1]];return 0==i[1]?0!=i[0]&&i[0]%2==0?0<i[0]?"TransversalLineInc":"TransversalLineDec":null:(e=(i[0]<<1)+i[0],0<i[0]?e==i[1]?"LineUp":e==-i[1]?"LineDown":null:e==i[1]?"LineInvDown":e==-i[1]?"LineInvUp":null)}static orthogonalStep(e,i){i=n._ORTHOGONAL_MOVES[o.csConvert.toOrthogonalDirectionIndex(i)];return n.addOffset(e,i)}static diagonalStep(e,i){i=n._DIAGONAL_MOVES[o.csConvert.toDiagonalDirectionIndex(i)];return n.addOffset(e,i)}static*orthogonalRide(e,i){var t=n._ORTHOGONAL_MOVES[o.csConvert.toOrthogonalDirectionIndex(i)];let s=n.addOffset(e,t);for(;null!=s;)yield s,s=n.addOffset(s,t)}static*diagonalRide(e,i){var t=n._DIAGONAL_MOVES[o.csConvert.toDiagonalDirectionIndex(i)];let s=n.addOffset(e,t);for(;null!=s;)yield s,s=n.addOffset(s,t)}static*orthogonalMoves(i){for(const t of n._ORTHOGONAL_MOVES){let e=this.addOffset(i,t);for(;null!=e;)yield e,e=n.addOffset(e,t)}}static*diagonalMoves(i){for(const t of n._DIAGONAL_MOVES){let e=this.addOffset(i,t);for(;null!=e;)yield e,e=n.addOffset(e,t)}}static knightJump(e,i){i=n._KNIGHT_MOVES[o.csConvert.toKnightDirectionIndex(i)];return n.addOffset(e,i)}static*knightMoves(e){for(const t of n._KNIGHT_MOVES){var i=this.addOffset(e,t);null!=i&&(yield i)}}static positionIteratorIncludes(e,i){for(const t of e)if(t[0]===i[0]&&t[1]===i[1])return!0;return!1}static*positionIteratorIntersection(e,i){for(const t of e)i.some(e=>t[0]===e[0]&&t[1]===e[1])&&(yield t)}static isOnBoard(e,i){return 0<=e&&e<=14&&(e<=7?7-e<=i&&i<=21+e:e-7<=i&&i<=35-e)}static addOffset(e,i){var t=e[0]+i[0],e=e[1]+i[1];return n.isOnBoard(t,e)?[t,e]:null}}(t.PositionHelper=n)._ORTHOGONAL_MOVES=[[0,2],[0,-2],[1,1],[1,-1],[-1,1],[-1,-1]],n._DIAGONAL_MOVES=[[2,0],[-2,0],[1,3],[1,-3],[-1,3],[-1,-3]],n._KNIGHT_MOVES=[[3,1],[3,-1],[-3,1],[-3,-1],[2,4],[1,5],[2,-4],[1,-5],[-2,4],[-1,5],[-2,-4],[-1,-5]],n.isEvenLinesColumnIndex=e=>e%2!=0},{"./cescacs.types":5}],5:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.csConvert=t.csTypes=void 0;const s=e("./ts.general"),o=["P","T","A","B","C","D","E","F","G","H","I","K","L","X","Z"],n=["D","E","F","H","I"],r=["ColumnUp","ColumnDown","FileUp","FileDown","FileInvUp","FileInvDown"],a=["TransversalLineInc","TransversalLineDec","LineUp","LineDown","LineInvUp","LineInvDown"],l=["TransversalLineInc-FileUp","TransversalLineInc-FileDown","TransversalLineDec-FileInvUp","TransversalLineDec-FileInvDown","LineUp-FileUp","LineUp-ColumnUp","LineDown-FileDown","LineDown-ColumnDown","LineInvUp-FileInvUp","LineInvUp-ColumnUp","LineInvDown-FileInvDown","LineInvDown-ColumnDown"],c=[["ColumnUp","ColumnDown"],["FileUp","FileInvDown"],["FileInvUp","FileDown"]],h=[["TransversalLineInc","TransversalLineDec"],["LineUp","LineInvDown"],["LineInvUp","LineDown"]],u=["Black","White","Color"],p=["w","b"],P=["K","D","V","R","G","N","J","E","M","P"],g=["RKR","RK","KR","K","-"],d=["KRK-II","KRK-IK","KRK-IH","KRK-HIO","KRK-HIOO","KRK-HH","KRK-HG","KRK-FG","KRK-FE","KRK-EF","KRK-EE","KRD-DD","KRD-DE","KRD-HH","KRD-HG","KRD-FG","KRD-FE","KRD-EF","KRD-ED","KRR-HIH","KRR-HGG","KRR-FGG","KRR-FEE","KRR-EEF"],v=["KRK-FF","KRK-FG","KRK-HG","KRK-HI","KRD-DE","KRD-DC","KRD-ED","KRD-EE","KRD-FE","KRD-FF","KRR-FFE","KRR-FGF"];var m,w;(w=m=t.csTypes||(t.csTypes={})).isNumber=e=>"number"==typeof e&&!isNaN(e),w.isColumn=e=>o.includes(e),w.isColumnIndex=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=14,w.isLine=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=28,w.isPosition=e=>Array.isArray(e)&&2==e.length&&w.isColumnIndex(e[0])&&w.isLine(e[1]),w.isOrthogonalDirection=e=>r.includes(e),w.isDiagonalDirection=e=>a.includes(e),w.isKnightDirection=e=>l.includes(e),w.isCastlingColumn=e=>n.includes(e),w.isDirectionMoveRange=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=5,w.isDirectionFullMoveRange=e=>w.isNumber(e)&&Number.isInteger(e)&&0<=e&&e<=11,w.isOrthogonalOrientation=i=>Array.isArray(i)&&c.some(e=>e[0]==i[0]&&e[1]==i[1]),w.isDiagonalOrientation=i=>Array.isArray(i)&&h.some(e=>e[0]==i[0]&&e[1]==i[1]),w.isHexColor=e=>u.includes(e),w.isPieceName=e=>P.includes(e),w.isTurn=e=>p.includes(e),w.isSide=e=>"K"===e||"D"===e,w.isCastlingStatus=e=>g.includes(e),w.isCastlingString=e=>d.includes(e),w.isGrandCastlingString=e=>v.includes(e),w.isSingleCheck=e=>Object.prototype.hasOwnProperty.call(e,"d")&&Object.prototype.hasOwnProperty.call(e,"p"),w.isDoubleCheck=e=>Array.isArray(e)&&3==length&&w.isPosition(e[0])&&w.isPosition(e[1])&&(null==e[2]||w.isOrthogonalOrientation(e[2])||w.isDiagonalOrientation(e[2])),w.hasDoubleCheckPin=e=>Array.isArray(e)&&3==length&&w.isPosition(e[0])&&w.isPosition(e[1])&&null!=e[2]&&(w.isOrthogonalOrientation(e[2])||w.isDiagonalOrientation(e[2])),w.isCheckAttackPos=(e,i)=>w.isPosition(e)?i[0]==e[0]&&i[1]==e[1]:w.isSingleCheck(e)?e.p[0]==i[0]&&e.p[1]==i[1]:e[0][0]==i[0]&&e[0][1]==i[1]||e[1][0]==i[0]&&e[1][1]==i[1],(e=t.csConvert||(t.csConvert={})).columnFromIndex=e=>o[e],e.toColumnIndex=e=>o.indexOf(e),e.toOrthogonalDirectionIndex=e=>r.indexOf(e),e.orthogonalDirectionFromIndex=e=>r[e],e.toDiagonalDirectionIndex=e=>a.indexOf(e),e.diagonalDirectionFromIndex=e=>a[e],e.toKnightDirectionIndex=e=>l.indexOf(e),e.knightDirectionFromIndex=e=>l[e],e.getOrthogonalOrientation=function(e){switch(e){case"ColumnUp":case"ColumnDown":return["ColumnUp","ColumnDown"];case"FileUp":case"FileInvDown":return["FileUp","FileInvDown"];case"FileInvUp":case"FileDown":return["FileInvUp","FileDown"];default:throw new Error(e)}},e.getDiagonalOrientation=function(e){switch(e){case"TransversalLineInc":case"TransversalLineDec":return["TransversalLineInc","TransversalLineDec"];case"LineUp":case"LineInvDown":return["LineUp","LineInvDown"];case"LineInvUp":case"LineDown":return["LineInvUp","LineDown"];default:throw new Error(e)}},e.getPieceKeyColor=function(e){return(0,s.assertCondition)(m.isTurn(e[0]),"key 1st char must have piece color"),e[0]},e.getPieceKeyName=function(e){return(0,s.assertCondition)(m.isPieceName(e[1]),"key 2nd char must be piece symbol "+e),e[1]},e.getBishopKeyHexColor=function(e){return"J"!==e[1]?null:e.slice(2)},e.getRookKeySide=function(e){return"R"===e[1]&&m.isSide(e[2])?e[2]:null},e.orthogonalDirections=function*(){for(const e of r)yield e},e.diagonalDirections=function*(){for(const e of a)yield e},e.knightDirections=function*(){for(const e of l)yield e}},{"./ts.general":6}],6:[function(e,i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.round2hundredths=t.isNotNullNorWhitespace=t.isNotNullNorEmpty=t.assertCondition=t.assertNonNullish=void 0,t.assertNonNullish=function(e,i){if(null==e)throw console.log("NonNullish assertion fail: "+i??"-"),new TypeError(`Unexpected ${e} value`+(null==i)?"":": "+i)},t.assertCondition=function(e,i){if(!e)throw console.log("Condition assertion fail: "+i??"-"),new Error("")},t.isNotNullNorEmpty=function(e){return null!=e&&0<e.length},t.isNotNullNorWhitespace=function(e){return null!=e&&0<e.length&&0<e.trim().length},t.round2hundredths=function(e){return Math.round(100*(e+Number.EPSILON))/100}},{}]},{},[1])(1)});